<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\search\cron; use JTL\Shop; use JTL\DB\ReturnType; use Plugin\admorris_pro\LoggerTrait; use Plugin\admorris_pro\search\SearchConfigDTO; class SearchCronAPI { private int $mainLanguage; private array $otherLanguages; private array $allLanguages; private int $now; use LoggerTrait; public function __construct(private SearchConfigDTO $searchConfig) { $this->now = time(); $this->initLogger(); $this->initializeLanguages(); } private function initializeLanguages() : void { $data = Shop::Container()->getDB()->select("\x74\x73\160\162\x61\143\x68\x65", "\x63\123\x74\x61\156\144\x61\x72\x64", "\x79"); $this->mainLanguage = (int) $data->kSprache; $this->otherLanguages = Shop::Container()->getDB()->queryPrepared("\123\105\114\x45\x43\x54\40\x6b\x53\160\x72\141\143\x68\x65\x20\106\122\x4f\115\x20\x74\163\x70\162\141\x63\x68\145\x20\x57\110\x45\x52\x45\40\153\x53\160\x72\x61\143\150\x65\40\x21\x3d\40\72\155\141\x69\x6e\x4c\141\156\x67\165\x61\147\x65", ["\x6d\141\x69\156\114\141\x6e\147\x75\141\x67\x65" => $this->mainLanguage], ReturnType::ARRAY_OF_OBJECTS); $this->allLanguages = Shop::Container()->getDB()->queryPrepared("\x53\x45\x4c\x45\x43\124\40\x6b\x53\160\x72\x61\x63\150\145\x20\106\x52\117\115\40\164\163\160\x72\141\143\150\145", [], ReturnType::ARRAY_OF_OBJECTS); } public function executeSearchCron() : string { $config = $this->searchConfig; if (!($config->suchServer === "\163\163" || $config->suchServer === '' || $config->suchIndex === "\x78" || $config->suchIndex === '' || $config->suchUser === "\170" || $config->suchUser === '' || $config->suchKey === "\170" || $config->suchKey === '')) { goto I9NbX; } return ''; I9NbX: $nowMinus1 = $this->now - 60; $this->processDeleteEntries(); $this->processCreateEntries(); $this->processStuckEntries($nowMinus1); return ''; } private function processDeleteEntries() : void { $data = Shop::Container()->getDB()->queryPrepared("\x53\105\114\105\x43\124\40\151\164\145\155\111\144\x2c\x20\151\x74\145\x6d\x54\x79\160\145\40\106\122\117\x4d\40\x78\160\154\165\147\151\156\137\141\x64\x6d\157\x72\162\x69\x73\137\x70\162\157\137\x73\x65\141\x72\x63\x68\x5f\143\162\x6f\x6e\x20\x57\110\105\122\105\x20\143\x72\x6f\x6e\x53\164\141\164\x75\x73\x20\75\x20\60\40\101\116\x44\40\x69\164\x65\x6d\x44\145\154\x65\x74\x65\x20\75\40\x31\x20\114\111\115\x49\x54\40\x35\x30", [], ReturnType::ARRAY_OF_OBJECTS); if (empty($data)) { goto U6RtS; } $this->setCronStatus($data); $status = $this->postRequest($data, "\x64\x65\154\145\x74\145"); if (!($status === true || $status === false)) { goto X1Cep; } $this->deleteCron($data); X1Cep: U6RtS: } private function processCreateEntries() : void { $data = Shop::Container()->getDB()->queryPrepared("\x53\105\114\105\x43\x54\x20\151\164\x65\x6d\111\144\54\x20\x69\x74\145\x6d\124\x79\160\145\x20\106\122\117\x4d\x20\x78\x70\x6c\165\x67\x69\156\137\141\x64\155\x6f\x72\x72\151\163\137\160\x72\x6f\x5f\163\x65\141\162\x63\x68\x5f\143\x72\x6f\156\x20\127\x48\x45\122\x45\x20\143\162\x6f\156\x53\x74\x61\164\x75\163\x20\x3d\x20\x30\40\x41\116\x44\40\x69\x74\145\x6d\x44\145\154\145\164\145\x20\x3d\40\60\40\x4c\x49\x4d\x49\x54\x20\65\x30", [], ReturnType::ARRAY_OF_OBJECTS); if (empty($data)) { goto ILDQ9; } $this->setCronStatus($data); $status = $this->postRequest($data, "\144\x65\x6c\x65\x74\x65"); if (!($status === true || $status === false)) { goto qs3O3; } $status = $this->postRequest($data, "\143\162\x65\141\x74\145"); if (!($status === true)) { goto N8s2o; } $this->deleteCron($data); N8s2o: qs3O3: ILDQ9: } private function processStuckEntries(int $nowMinus1) : void { $data = Shop::Container()->getDB()->queryPrepared("\123\105\x4c\x45\x43\124\40\x69\x74\x65\155\111\144\40\106\x52\x4f\115\40\x78\x70\154\x75\147\x69\156\137\x61\144\x6d\x6f\162\x72\151\x73\x5f\160\x72\x6f\x5f\x73\145\x61\162\x63\x68\x5f\143\162\x6f\x6e\x20\x57\110\105\122\105\x20\x63\162\157\156\x53\x74\141\x74\x75\163\40\75\x20\x31\40\101\x4e\x44\40\143\162\x6f\156\123\x74\x61\164\x75\x73\124\151\155\145\40\74\40\72\156\157\167\x4d\151\x6e\x75\x73\x31\40\114\x49\x4d\111\124\40\65\x30", ["\x6e\x6f\x77\x4d\x69\x6e\165\x73\x31" => $nowMinus1], ReturnType::ARRAY_OF_OBJECTS); if (!empty($data)) { goto yCyYl; } return; yCyYl: $ids = array_filter(array_map(static fn($row) => (int) $row->itemId, $data), static fn($id) => $id > 0); if (!empty($ids)) { goto V6UCO; } return; V6UCO: $idList = implode("\54", $ids); $db = Shop::Container()->getDB(); $db->query("\x55\120\x44\x41\124\x45\40\170\x70\x6c\165\x67\x69\x6e\x5f\141\x64\155\157\162\x72\151\x73\137\160\162\157\137\163\x65\141\x72\143\150\137\x63\162\x6f\x6e\40\12\40\x20\40\40\40\x20\40\123\105\124\40\143\x72\x6f\156\123\164\141\164\x75\x73\x20\x3d\40\47\x30\47\x2c\40\143\x72\x6f\156\x53\164\141\x74\x75\163\x54\x69\x6d\145\40\75\40\47\47\40\12\40\x20\40\40\x20\40\x20\x57\x48\105\122\105\40\151\x74\145\x6d\111\144\40\111\116\x20\x28{$idList}\51"); } public function postRequest($data, $type) { try { goto b32yW; TBrhG: NjIvg: return "\145\x72\x72\157\162"; goto lc8oZ; b32yW: if ($type == "\x63\162\x65\141\164\145") { goto zBzyl; } if ($type == "\144\x65\154\145\164\145") { goto z42Bz; } goto UBo0_; zBzyl: $postData = $this->getDataCreateItem($data); goto UBo0_; z42Bz: $postData = $this->getDataDeleteItem($data); UBo0_: if (!empty($postData)) { goto AyhOw; } goto B0EtT; y0Vc4: if ($response !== false) { goto zNeeE; } $this->log->error("\x53\x6d\141\162\x74\123\x65\141\x72\x63\150\x20\x43\157\156\x6e\145\143\x74\151\x6f\156\40\x45\162\162\x6f\x72\x3a\40" . print_r(curl_error($curl), true)); goto l6XOt; zNeeE: $this->log->debug("\x53\155\x61\162\164\x53\145\141\162\x63\x68\x20\103\x6f\156\x6e\145\143\164\151\157\x6e\72\x20" . print_r($response, true)); l6XOt: curl_close($curl); $responseArray = json_decode($response, true); if (empty($responseArray["\x65\162\162\157\162"])) { goto Ly8lm; } $this->log->error("\123\x6d\x61\x72\x74\x53\145\x61\x72\x63\x68\x20\x45\162\x72\x6f\x72\72\40" . print_r($responseArray["\145\x72\162\157\162"], true)); goto f0m_b; f0m_b: return "\x65\162\162\157\x72"; Ly8lm: if (!isset($responseArray["\x65\x72\162\157\x72\x73"])) { goto NjIvg; } if (!($responseArray["\145\x72\x72\157\162\163"] === false)) { goto F625B; } return true; F625B: if (!($responseArray["\x65\x72\162\157\x72\163"] === true)) { goto eX4No; } return false; eX4No: return "\x65\x72\162\157\162"; goto TBrhG; B0EtT: return false; AyhOw: $header = ["\x63\157\x6e\x74\145\156\164\55\164\171\x70\x65\x3a\x20\x61\160\160\x6c\x69\143\x61\x74\151\x6f\x6e\57\152\163\x6f\156"]; $curl = curl_init(); curl_setopt($curl, CURLOPT_URL, $this->searchConfig->urlBase . "\x5f\142\165\154\153"); curl_setopt($curl, CURLOPT_HTTPHEADER, $header); curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1); curl_setopt($curl, CURLOPT_POST, true); curl_setopt($curl, CURLOPT_POSTFIELDS, $postData); $response = curl_exec($curl); goto y0Vc4; lc8oZ: } catch (\Throwable $th) { $this->log->error("\x53\155\x61\162\x74\x53\145\x61\x72\143\150\x3a\40" . $th); return "\x65\x72\162\157\x72"; } } private function getDataDeleteItem($data) { $result = ''; foreach ($this->allLanguages as $language) { foreach ($data as $itemId) { $result = $result . "\x7b\x20\x22\x64\x65\154\145\164\x65\42\40\72\40\173\x20\x22\137\151\156\144\145\x78\x22\x20\x3a\40\x22" . $this->searchConfig->suchIndex . "\137" . $language->kSprache . "\x22\x2c\x20\42\x5f\164\171\160\x65\x22\x20\72\x20\42\x69\x74\145\x6d\42\54\x20\42\x5f\151\144\42\40\x3a\40\x22" . $itemId->itemType[0] . $itemId->itemId . "\x22\40\175\x20\175" . "\12"; SfcPi: } BSCte: tFmh2: } kjz1g: return $result; } private function getDataCreateItem($data) { $result = ''; foreach ($data as $itemId) { $getData = $this->getProductDataMainLanguage($itemId->itemId, $itemId->itemType); if (!($getData === false)) { goto DKbuf; } goto FpZpT; DKbuf: $result = $result . "\x7b\x20\42\x63\162\145\141\164\145\x22\40\x3a\40\173\40\x22\137\151\x6e\x64\x65\170\x22\40\x3a\x20\x22" . $this->searchConfig->suchIndex . "\137" . $this->mainLanguage . "\42\x2c\40\x22\x5f\164\171\x70\x65\42\x20\72\40\x22\151\x74\145\155\x22\x2c\40\x22\137\x69\x64\42\x20\x3a\40\x22" . $itemId->itemType[0] . $itemId->itemId . "\x22\x20\175\40\x7d\12" . $getData . "\xa"; FpZpT: } pm_JF: foreach ($this->otherLanguages as $language) { foreach ($data as $itemId) { $getData = $this->getProductDataOtherLanguage($itemId->itemId, $itemId->itemType, $language->kSprache); if (!($getData === false)) { goto azSiL; } goto tRmZ7; azSiL: $result = $result . "\173\x20\42\x63\162\x65\x61\x74\145\42\40\72\x20\x7b\x20\x22\137\x69\x6e\144\x65\x78\42\40\x3a\x20\42" . $this->searchConfig->suchIndex . "\137" . $language->kSprache . "\42\x2c\x20\x22\x5f\x74\171\160\145\42\40\x3a\40\x22\151\164\145\155\x22\54\x20\42\x5f\x69\144\x22\40\x3a\x20\42" . $itemId->itemType[0] . $itemId->itemId . "\x22\x20\175\40\175\12" . $getData . "\12"; tRmZ7: } PTd3U: QPcwT: } fRAIM: return $result; } public function deleteCron($data) { foreach ($data as $itemId) { Shop::Container()->getDB()->queryPrepared("\x44\x45\x4c\x45\124\105\x20\106\122\x4f\115\40\x78\160\x6c\165\x67\151\156\x5f\141\x64\155\x6f\162\162\151\x73\x5f\x70\x72\157\137\x73\x65\x61\162\143\x68\137\143\162\157\x6e\x20\x57\x48\x45\122\105\x20\151\x74\x65\x6d\x49\x64\40\x3d\x20\72\151\164\x65\x6d\x49\x64", ["\x69\x74\x65\x6d\111\x64" => $itemId->itemId], ReturnType::AFFECTED_ROWS); OmbTR: } qFO34: } public function setCronStatus($data) { foreach ($data as $itemId) { Shop::Container()->getDB()->queryPrepared("\125\x50\x44\101\124\x45\x20\170\x70\x6c\x75\x67\151\156\137\x61\x64\x6d\157\162\x72\x69\163\137\x70\162\x6f\137\163\x65\x61\162\x63\150\137\x63\x72\157\156\40\123\105\124\40\143\x72\x6f\x6e\123\x74\x61\164\x75\x73\x20\x3d\x20\x27\61\x27\x2c\40\143\162\x6f\156\x53\x74\141\164\x75\x73\x54\x69\155\145\40\75\40\72\156\x6f\167\x20\127\x48\x45\122\105\40\x69\x74\x65\x6d\x49\x64\40\x3d\x20\72\x69\164\145\155\111\144", ["\x6e\157\x77" => $this->now, "\151\x74\x65\155\111\x64" => $itemId->itemId], ReturnType::AFFECTED_ROWS); WMtox: } LdcsX: } private function getItemData($itemId, $itemType, $language = null) { goto hVflO; hJB19: if (!empty($getData)) { goto EMB4w; } return false; EMB4w: goto j77XF; Oogzo: $getData = Shop::Container()->getDB()->queryPrepared("\x53\x45\114\x45\103\x54\xa\40\x20\x20\x20\40\x20\x20\x20\x20\x20\x20\40\x20\x20\x27\155\x61\156\165\x66\141\143\164\165\162\145\x72\x27\40\x41\123\40\x69\x74\x65\x6d\x54\171\160\x65\54\xa\40\40\x20\x20\40\40\40\x20\40\x20\40\x20\x20\40\155\56\x63\116\x61\155\145\x2c\xa\x20\x20\40\40\40\x20\x20\40\x20\40\40\40\40\40\x73\56\x63\123\x65\157\54\xa\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\40\x20\40\40\x6d\x73\x2e\x63\115\x65\164\141\124\151\164\x6c\145\54\12\40\x20\40\40\40\40\40\x20\x20\x20\40\40\40\40\x6d\163\56\143\115\145\x74\141\x4b\145\171\167\157\162\x64\x73\54\12\x20\x20\40\40\40\x20\40\40\40\x20\40\x20\x20\x20\155\163\x2e\x63\115\x65\x74\x61\104\x65\x73\143\162\151\x70\x74\x69\x6f\x6e\54\xa\x20\x20\40\x20\x20\40\40\x20\40\40\40\x20\40\x20\155\163\56\x63\x42\x65\163\x63\150\x72\x65\x69\142\x75\x6e\x67\xa\x20\x20\40\x20\x20\40\40\x20\x20\40\40\40\x20\x20\106\x52\117\115\x20\x74\150\x65\162\x73\164\145\x6c\154\145\162\x20\x6d\xa\x20\x20\x20\x20\40\x20\x20\40\40\40\40\x20\40\x20\x4c\105\x46\x54\x20\112\117\x49\116\40\x74\163\145\157\x20\163\40\x4f\116\40\x73\56\x6b\x4b\x65\x79\x20\x3d\40\155\56\x6b\x48\145\x72\x73\x74\145\x6c\x6c\145\x72\40\101\116\104\x20\163\x2e\x6b\x53\x70\162\141\143\x68\x65\40\x3d\x20\72\154\x61\156\147\x75\141\147\x65\40\x41\116\x44\x20\163\56\x63\113\x65\171\40\x3d\x20\47\x6b\x48\145\x72\x73\x74\145\154\x6c\x65\162\47\12\x20\x20\x20\40\x20\x20\x20\x20\x20\40\40\40\x20\40\114\x45\x46\x54\x20\x4a\x4f\x49\116\40\x74\150\145\162\x73\164\145\154\x6c\x65\x72\163\160\x72\141\143\x68\x65\x20\155\x73\40\117\x4e\x20\x6d\163\x2e\x6b\110\x65\162\x73\x74\x65\x6c\154\145\x72\40\x3d\40\155\x2e\153\110\145\x72\x73\x74\x65\x6c\x6c\x65\162\x20\x41\x4e\104\x20\x6d\x73\56\153\123\160\162\141\143\150\145\40\75\x20\x3a\154\141\x6e\147\165\141\147\145\12\x20\40\40\x20\x20\40\40\40\40\x20\40\40\40\40\127\110\x45\122\x45\40\155\x2e\x6b\110\x65\x72\163\164\145\154\x6c\x65\x72\x20\x3d\x20\72\x69\164\145\x6d\111\144\xa\x20\x20\x20\x20\40\40\40\40\40\x20\40\40\x20\40\114\111\x4d\x49\124\40\61", ["\154\x61\x6e\x67\x75\x61\x67\x65" => $language, "\x69\164\145\x6d\x49\x64" => $itemId], ReturnType::SINGLE_OBJECT); if (!empty($getData)) { goto pRIoQ; } return false; pRIoQ: j77XF: goto w99Y0; hVflO: $language = $language ?? $this->mainLanguage; $isMainLanguage = $language == $this->mainLanguage; if ($itemType == "\160\162\x6f\x64\x75\143\164") { goto RIvQb; } if ($itemType == "\143\x61\164\x65\x67\157\x72\x79") { goto tE7NY; } if ($itemType == "\155\141\x6e\165\146\x61\x63\x74\x75\x72\145\162") { goto Oogzo; } return false; goto j77XF; RIvQb: if ($isMainLanguage) { goto KAshj; } $query = "\123\x45\114\105\x43\124\xa\40\x20\x20\x20\x20\x20\40\40\40\x20\x20\x20\47\160\x72\x6f\x64\x75\143\164\47\x20\101\123\40\x69\x74\x65\x6d\x54\171\x70\x65\x2c\xa\40\x20\x20\40\40\40\40\40\x20\x20\x20\40\150\x2e\143\x4e\x61\x6d\145\40\x41\x53\x20\x6b\110\145\x72\x73\x74\145\x6c\154\x65\x72\116\141\155\145\x2c\xa\x20\x20\40\x20\40\40\40\x20\40\40\x20\40\x74\56\153\x56\141\164\145\x72\x41\x72\164\x69\153\x65\x6c\54\xa\x20\40\40\40\x20\x20\40\40\x20\40\40\40\x73\x2e\143\123\145\157\54\xa\40\x20\x20\x20\40\x20\40\x20\x20\40\x20\x20\x74\x73\x2e\143\116\141\155\145\x2c\12\x20\x20\x20\x20\40\40\x20\x20\40\x20\40\x20\x74\163\56\143\x42\145\x73\x63\x68\x72\145\151\142\165\156\x67\x2c\12\x20\x20\x20\x20\40\x20\40\x20\x20\40\x20\40\x74\56\x63\102\141\162\x63\x6f\144\x65\54\xa\40\x20\40\x20\x20\x20\40\40\x20\x20\40\40\164\x73\56\x63\x4b\165\x72\x7a\102\x65\x73\x63\150\x72\x65\x69\x62\165\x6e\x67\54\12\40\x20\x20\40\40\x20\40\x20\40\40\x20\x20\x74\56\x63\x53\165\x63\x68\142\x65\x67\x72\151\x66\146\x65\54\40\x74\x2e\x63\111\x53\102\x4e\x2c\x20\164\56\x63\x48\101\x4e\x2c\40\x74\x2e\x63\125\x50\x43\x2c\40\x74\x2e\156\111\x73\164\126\141\164\x65\162\54\xa\40\x20\x20\x20\x20\x20\x20\x20\40\40\40\x20\x6d\x64\137\141\x74\164\x72\56\143\x54\145\170\x74\x57\145\x72\x74\x20\x41\123\40\x63\115\145\x74\x61\x44\145\163\143\x72\151\160\x74\151\x6f\156\54\xa\40\40\40\40\x20\40\40\40\x20\40\x20\40\155\153\x5f\x61\x74\164\162\56\143\123\x74\x72\151\156\x67\x57\145\162\164\40\101\x53\40\x63\115\x65\164\x61\113\x65\x79\x77\x6f\162\144\x73\x2c\12\x20\40\40\x20\40\x20\x20\40\40\40\40\x20\x6d\164\x5f\x61\x74\x74\162\56\143\123\164\x72\151\156\147\x57\145\x72\164\x20\x41\x53\40\143\x54\151\x74\154\x65\x54\141\147\54\xa\40\x20\x20\x20\x20\40\x20\x20\40\x20\x20\40\x70\56\x63\x50\146\x61\144\12\40\40\x20\x20\x20\x20\x20\40\40\x20\x20\x20\106\x52\x4f\115\x20\164\141\162\164\x69\x6b\145\x6c\40\x74\xa\x20\x20\x20\40\x20\40\40\40\x20\x20\x20\40\114\105\x46\x54\40\x4a\x4f\111\x4e\40\164\150\145\162\163\x74\x65\154\154\145\162\x20\150\40\x4f\x4e\40\x68\56\x6b\x48\x65\162\163\x74\145\x6c\154\145\x72\x20\75\40\164\x2e\x6b\x48\145\162\x73\x74\145\x6c\154\145\x72\12\x20\40\x20\x20\x20\x20\40\40\x20\40\40\40\x4c\105\x46\124\x20\112\x4f\111\x4e\40\164\x73\x65\157\40\x73\40\117\x4e\x20\x73\x2e\x6b\x4b\145\171\40\x3d\40\164\56\x6b\101\x72\x74\151\153\145\154\x20\101\x4e\104\40\x73\x2e\x6b\x53\160\162\141\143\150\145\x20\75\40\72\x6c\141\x6e\147\165\x61\147\145\x20\x41\116\104\x20\163\56\143\x4b\x65\x79\40\75\40\47\153\x41\162\x74\x69\153\145\154\x27\xa\x20\40\40\x20\x20\40\x20\x20\40\40\x20\x20\114\105\106\x54\x20\112\117\111\116\40\x74\x61\162\x74\x69\x6b\x65\154\163\x70\162\x61\143\150\145\x20\x74\x73\40\x4f\x4e\x20\164\x73\56\x6b\101\x72\164\151\153\145\154\x20\75\40\x74\x2e\153\x41\x72\164\151\x6b\x65\x6c\40\101\x4e\x44\40\x74\x73\x2e\153\123\160\x72\141\143\150\x65\x20\75\x20\x3a\x6c\x61\x6e\x67\x75\x61\x67\145\xa\x20\40\x20\x20\40\40\x20\40\x20\x20\40\x20\x4c\x45\106\x54\x20\x4a\117\111\x4e\x20\164\x61\162\164\x69\153\x65\x6c\160\x69\143\164\40\160\40\x4f\116\x20\x70\56\153\x41\x72\164\x69\153\x65\x6c\x20\x3d\40\x74\x2e\153\x41\162\x74\x69\153\145\154\40\x41\116\104\x20\x70\x2e\156\x4e\x72\40\75\40\61\12\x20\x20\x20\40\40\40\40\40\x20\x20\40\40\114\x45\x46\x54\40\112\117\x49\x4e\40\164\x61\x74\164\x72\151\x62\x75\164\40\155\x64\x5f\x74\x61\x20\x4f\116\40\155\x64\137\164\x61\56\153\101\162\164\x69\153\145\154\x20\x3d\x20\164\56\x6b\x41\162\164\x69\x6b\145\154\x20\101\x4e\x44\x20\155\x64\x5f\x74\141\x2e\x63\116\x61\155\x65\40\75\40\47\x6d\x65\x74\x61\137\x64\x65\x73\143\162\151\160\x74\x69\157\x6e\x27\xa\x20\40\40\x20\x20\40\40\x20\40\x20\x20\x20\x4c\x45\x46\124\x20\x4a\x4f\x49\116\x20\x74\141\x74\x74\x72\x69\142\x75\164\163\x70\x72\x61\143\150\x65\40\x6d\144\x5f\141\164\x74\x72\x20\x4f\116\40\x6d\144\x5f\141\x74\x74\x72\x2e\x6b\101\164\164\162\151\142\x75\x74\40\75\x20\x6d\x64\x5f\x74\x61\56\153\x41\x74\x74\162\151\142\x75\x74\x20\101\116\104\40\155\x64\x5f\x61\x74\x74\x72\x2e\x6b\x53\x70\x72\x61\143\x68\x65\40\75\40\x3a\154\x61\x6e\147\x75\141\x67\145\x20\101\116\x44\x20\155\144\137\141\164\164\x72\x2e\143\116\141\x6d\145\x20\x3d\x20\x27\x6d\x65\x74\x61\x5f\144\145\163\x63\162\x69\x70\164\x69\x6f\x6e\x27\xa\x20\x20\x20\x20\40\x20\x20\x20\x20\40\x20\x20\x4c\105\106\x54\x20\112\117\111\116\40\164\141\164\x74\162\x69\x62\165\164\x20\x6d\153\137\x74\x61\x20\x4f\116\40\155\153\x5f\164\141\56\153\x41\x72\x74\151\153\145\154\40\x3d\40\x74\56\x6b\101\162\x74\151\153\x65\154\x20\x41\x4e\104\40\155\153\137\164\141\56\x63\x4e\141\x6d\145\40\75\x20\47\x6d\x65\164\141\137\x6b\145\171\x77\x6f\x72\144\163\47\xa\40\x20\40\x20\40\40\40\x20\x20\x20\x20\x20\114\x45\106\x54\x20\112\117\111\116\x20\x74\x61\x74\164\162\x69\142\x75\x74\163\x70\162\141\x63\x68\145\40\155\153\x5f\141\x74\x74\x72\40\x4f\116\40\155\153\137\x61\x74\x74\x72\x2e\x6b\101\x74\x74\162\x69\x62\165\164\40\x3d\40\x6d\153\x5f\x74\x61\x2e\153\x41\x74\x74\x72\151\142\x75\164\x20\x41\116\x44\40\x6d\x6b\x5f\141\164\164\162\x2e\153\x53\x70\162\x61\143\150\145\x20\x3d\40\x3a\154\141\156\x67\x75\141\147\x65\x20\101\x4e\x44\x20\155\153\x5f\141\x74\164\x72\56\x63\116\x61\x6d\x65\40\75\40\47\155\145\x74\141\137\153\145\x79\x77\157\x72\x64\163\47\12\40\x20\40\x20\40\40\x20\40\x20\x20\x20\40\114\105\106\x54\x20\x4a\x4f\x49\x4e\40\164\141\x74\x74\162\x69\x62\165\x74\x20\x6d\x74\137\x74\x61\40\x4f\x4e\40\155\x74\137\164\141\x2e\x6b\101\x72\164\151\153\145\x6c\40\75\x20\x74\x2e\x6b\x41\x72\x74\x69\x6b\145\154\x20\x41\x4e\104\40\155\x74\137\x74\141\56\x63\116\x61\x6d\x65\40\75\x20\x27\x6d\145\x74\141\137\x74\x69\164\154\x65\x27\12\x20\40\40\x20\40\x20\40\40\x20\40\40\x20\x4c\105\x46\124\40\112\117\111\116\40\x74\141\x74\164\x72\151\x62\x75\164\x73\160\162\141\x63\x68\x65\x20\x6d\x74\x5f\141\164\x74\162\40\x4f\116\x20\x6d\x74\x5f\141\x74\x74\162\x2e\x6b\x41\x74\164\162\151\142\165\164\x20\75\x20\x6d\x74\137\x74\x61\x2e\x6b\101\164\164\162\x69\x62\165\164\x20\101\116\x44\40\x6d\164\x5f\x61\x74\164\x72\56\153\x53\x70\162\x61\143\x68\145\x20\x3d\40\x3a\154\x61\x6e\147\165\x61\147\145\x20\101\116\x44\x20\155\x74\x5f\141\164\164\162\x2e\143\x4e\x61\155\x65\40\75\x20\47\155\x65\x74\x61\137\x74\151\164\154\145\47\xa\x20\x20\40\40\40\x20\40\40\40\x20\40\x20\127\110\105\x52\x45\x20\164\x2e\x6b\x41\x72\164\x69\153\x65\154\40\75\x20\72\151\x74\x65\155\111\144\xa\40\40\40\x20\40\x20\x20\40\x20\x20\40\x20\x4c\111\115\111\124\40\x31"; goto cv9tT; MYMd0: NM7Ip: $getData->hideKundengruppe = $hideKundengruppe; goto j77XF; tE7NY: if ($isMainLanguage) { goto ViCqI; } $getData = Shop::Container()->getDB()->queryPrepared("\x53\105\114\105\x43\124\12\40\x20\x20\40\x20\x20\x20\x20\x20\x20\x20\x20\40\x20\x20\40\47\143\x61\164\145\147\x6f\x72\x79\47\40\101\123\40\x69\164\145\x6d\124\171\160\x65\x2c\xa\40\x20\40\x20\x20\x20\x20\40\x20\40\40\40\x20\x20\40\40\x73\x2e\143\123\145\x6f\54\12\x20\40\x20\40\x20\x20\40\x20\x20\x20\40\40\40\x20\40\x20\143\x73\x2e\x63\116\141\x6d\145\54\40\143\163\56\143\x42\145\x73\143\x68\x72\145\x69\x62\165\156\147\54\40\x63\x73\56\143\x4d\145\164\141\x44\145\x73\143\x72\x69\160\164\x69\x6f\x6e\54\x20\x63\163\x2e\143\115\x65\x74\x61\x4b\x65\171\167\157\162\x64\x73\x2c\x20\x63\x73\56\x63\x54\151\x74\154\x65\124\141\x67\x2c\xa\x20\x20\x20\x20\x20\40\40\x20\x20\x20\40\40\x20\x20\40\40\x70\x2e\x63\x50\x66\x61\144\12\x20\40\40\x20\40\40\40\40\x20\40\x20\x20\40\40\x20\x20\x46\x52\x4f\115\x20\164\x6b\141\164\x65\x67\157\x72\x69\x65\x73\160\162\x61\x63\150\145\40\143\x73\12\40\x20\40\40\40\x20\40\x20\40\x20\40\x20\40\x20\x20\x20\114\x45\x46\124\40\112\117\111\116\40\164\163\145\157\x20\163\40\117\116\x20\x73\56\x6b\113\x65\x79\40\x3d\40\143\x73\x2e\153\x4b\141\164\145\x67\157\x72\x69\145\x20\101\x4e\104\x20\163\x2e\153\123\160\162\x61\x63\x68\145\x20\x3d\x20\72\154\x61\156\147\165\141\x67\145\x20\x41\116\x44\x20\163\x2e\x63\113\x65\x79\40\75\x20\47\x6b\113\141\164\145\147\x6f\x72\x69\145\x27\xa\40\x20\x20\40\x20\40\40\40\x20\40\x20\x20\40\x20\40\40\114\105\x46\124\40\112\x4f\111\x4e\40\164\153\x61\x74\145\147\157\162\x69\x65\160\151\143\164\x20\160\40\117\x4e\x20\160\x2e\x6b\x4b\141\x74\145\x67\157\x72\x69\x65\40\x3d\x20\143\x73\x2e\x6b\x4b\141\164\145\147\x6f\x72\151\x65\12\x20\x20\x20\x20\40\x20\x20\40\40\x20\40\x20\x20\x20\x20\x20\127\x48\x45\x52\105\x20\143\163\56\153\x4b\x61\164\145\147\x6f\x72\151\145\x20\x3d\x20\72\151\164\x65\155\111\144\x20\101\x4e\x44\40\x63\x73\x2e\x6b\x53\160\162\141\x63\x68\x65\40\x3d\40\x3a\154\x61\156\147\x75\x61\147\x65\xa\40\40\40\40\x20\x20\x20\40\x20\40\40\x20\x20\x20\40\x20\x4c\111\x4d\111\124\x20\61", ["\154\141\x6e\x67\165\x61\147\145" => $language, "\151\x74\x65\155\111\x64" => $itemId], ReturnType::SINGLE_OBJECT); goto cOuYP; ViCqI: $getData = Shop::Container()->getDB()->queryPrepared("\x53\105\x4c\105\103\124\12\40\x20\x20\x20\40\x20\40\x20\40\x20\x20\x20\x20\40\x20\40\x27\143\141\164\x65\x67\x6f\162\171\x27\40\101\123\x20\151\164\145\x6d\x54\x79\160\145\x2c\xa\x20\x20\x20\x20\40\x20\40\x20\x20\x20\40\x20\40\x20\x20\x20\x73\x2e\143\123\x65\x6f\x2c\12\40\x20\40\40\40\x20\x20\40\40\x20\40\x20\x20\x20\x20\40\143\x2e\143\116\141\x6d\145\54\x20\143\56\143\102\145\163\143\x68\162\x65\x69\x62\x75\x6e\x67\x2c\12\40\x20\40\x20\x20\x20\40\x20\40\x20\40\x20\40\x20\x20\x20\x6d\144\137\141\x74\164\162\x2e\143\127\x65\162\x74\40\101\x53\x20\143\115\x65\x74\x61\x44\x65\163\143\162\x69\x70\x74\x69\x6f\156\x2c\12\x20\x20\40\40\x20\x20\40\x20\40\x20\40\40\x20\40\x20\x20\155\153\x5f\x61\164\164\162\x2e\x63\x57\x65\x72\164\40\x41\x53\40\143\115\145\164\x61\x4b\x65\x79\x77\x6f\162\144\163\x2c\xa\40\40\x20\x20\x20\40\x20\40\40\40\x20\x20\x20\40\40\40\x6d\x74\137\141\164\164\x72\x2e\x63\x57\x65\x72\x74\x20\x41\123\x20\x63\x54\x69\164\154\x65\x54\x61\147\x2c\xa\x20\x20\x20\40\40\40\x20\40\40\40\x20\x20\x20\40\40\x20\x70\56\x63\120\x66\141\x64\12\x20\40\x20\x20\40\40\x20\40\40\x20\x20\40\40\x20\40\40\106\122\117\x4d\x20\x74\x6b\141\164\x65\147\157\162\151\x65\40\143\12\x20\x20\40\40\40\40\40\40\x20\x20\x20\x20\x20\x20\x20\40\114\105\x46\x54\40\112\117\x49\x4e\40\x74\x73\145\x6f\x20\x73\x20\117\x4e\x20\163\x2e\153\x4b\145\x79\40\75\40\143\56\x6b\113\141\164\x65\147\157\x72\151\145\x20\101\x4e\104\40\x73\56\153\x53\160\162\x61\x63\150\145\40\75\x20\x3a\x6c\x61\156\x67\x75\x61\x67\145\40\x41\116\104\x20\x73\56\143\113\x65\x79\40\x3d\40\x27\x6b\113\141\x74\145\147\157\162\151\x65\47\12\40\40\x20\40\40\40\40\x20\x20\x20\40\40\x20\x20\x20\x20\x4c\105\106\124\x20\x4a\x4f\x49\116\40\164\x6b\141\x74\x65\x67\157\162\x69\x65\x61\164\x74\162\151\142\165\164\40\x6d\x64\x5f\141\164\164\162\40\x4f\116\40\x6d\144\137\141\164\x74\x72\56\x6b\x4b\141\x74\x65\x67\x6f\x72\x69\145\x20\75\x20\x63\x2e\153\x4b\x61\x74\145\x67\x6f\162\x69\x65\x20\101\x4e\104\40\155\144\137\141\x74\x74\162\56\143\116\x61\x6d\145\x20\x3d\x20\47\x6d\x65\x74\141\x5f\144\145\x73\x63\162\x69\160\164\x69\x6f\x6e\x27\xa\40\x20\40\x20\x20\40\40\x20\x20\x20\40\40\40\40\40\40\114\x45\106\x54\40\112\117\111\116\x20\164\153\141\x74\145\147\157\x72\x69\x65\141\164\164\x72\151\142\x75\164\x20\x6d\153\x5f\141\164\164\162\x20\x4f\116\40\155\x6b\137\x61\x74\x74\x72\x2e\x6b\113\x61\164\145\x67\x6f\x72\151\145\x20\75\40\143\56\x6b\113\141\164\x65\147\x6f\162\x69\x65\40\101\116\104\x20\x6d\153\x5f\141\x74\x74\162\56\143\x4e\x61\x6d\x65\x20\x3d\x20\x27\155\145\x74\141\x5f\153\x65\171\167\x6f\162\144\163\x27\xa\x20\40\x20\40\x20\40\x20\40\40\x20\x20\x20\40\40\x20\x20\x4c\x45\x46\124\x20\112\x4f\111\116\40\164\x6b\141\x74\145\x67\157\x72\151\x65\x61\164\x74\162\151\142\x75\164\x20\x6d\164\137\x61\164\164\162\x20\x4f\116\40\x6d\164\137\x61\x74\x74\162\x2e\x6b\113\141\164\145\147\x6f\162\151\x65\x20\x3d\x20\x63\x2e\153\x4b\141\x74\145\147\x6f\x72\x69\x65\x20\x41\x4e\104\40\155\x74\137\x61\x74\164\162\56\143\116\141\x6d\145\40\x3d\40\47\x6d\x65\164\141\137\164\x69\164\x6c\x65\x27\xa\40\40\40\40\40\x20\40\40\x20\x20\x20\40\x20\40\x20\40\114\105\106\x54\x20\112\x4f\111\x4e\x20\x74\153\x61\x74\x65\147\157\162\x69\145\160\151\x63\164\40\x70\x20\x4f\116\40\x70\x2e\x6b\113\141\164\145\x67\157\162\151\x65\40\75\40\143\x2e\x6b\113\141\164\x65\147\157\x72\x69\x65\xa\40\x20\40\40\x20\40\x20\40\40\x20\40\x20\x20\x20\40\x20\127\x48\x45\122\105\40\x63\56\x6b\x4b\x61\x74\x65\147\x6f\x72\151\145\x20\x3d\x20\x3a\x69\x74\145\155\x49\144\12\x20\x20\x20\40\x20\x20\x20\x20\40\40\x20\x20\x20\40\40\x20\x4c\111\115\111\124\40\x31", ["\x6c\x61\x6e\147\165\x61\x67\145" => $language, "\x69\x74\145\155\111\x64" => $itemId], ReturnType::SINGLE_OBJECT); cOuYP: goto hJB19; cv9tT: goto JkkO8; KAshj: $query = "\123\105\114\105\103\x54\xa\40\x20\40\x20\40\40\40\x20\x20\x20\40\x20\x27\x70\x72\157\x64\165\143\x74\x27\x20\101\x53\40\151\x74\145\155\124\171\x70\145\54\12\x20\x20\40\40\40\x20\x20\40\x20\x20\x20\40\150\x2e\143\116\141\x6d\145\x20\x41\x53\40\x6b\110\145\162\163\164\x65\154\x6c\145\162\116\x61\x6d\145\54\12\40\40\40\40\40\40\x20\40\40\40\40\40\164\x2e\x6b\126\141\x74\x65\162\101\162\164\151\153\x65\x6c\x2c\xa\x20\40\x20\x20\x20\x20\x20\40\x20\40\x20\x20\x73\56\x63\x53\x65\x6f\x2c\12\x20\40\40\40\x20\x20\x20\40\x20\40\x20\x20\164\56\143\101\x72\x74\116\162\x2c\40\164\56\143\116\x61\155\x65\54\40\x74\56\143\102\x65\163\143\x68\162\145\x69\x62\165\156\x67\54\40\164\x2e\x63\x42\x61\162\143\x6f\x64\x65\x2c\40\x74\56\x63\113\x75\162\x7a\102\145\x73\143\x68\x72\145\151\x62\165\156\x67\54\x20\12\40\40\x20\x20\x20\x20\x20\x20\x20\40\x20\x20\x74\x2e\143\123\165\143\150\x62\x65\x67\x72\x69\x66\x66\x65\x2c\40\164\56\143\x49\x53\x42\x4e\54\40\164\x2e\x63\110\101\116\54\x20\x74\56\x63\x55\x50\x43\x2c\40\164\x2e\x6e\x49\x73\164\126\141\x74\145\x72\54\xa\x20\40\40\x20\x20\x20\x20\40\x20\40\x20\40\x6d\144\x5f\x61\164\x74\x72\x2e\143\124\x65\170\164\x57\x65\162\164\x20\x41\123\x20\x63\x4d\x65\x74\141\x44\x65\163\143\162\151\x70\x74\x69\x6f\156\54\12\x20\x20\x20\40\40\40\40\40\x20\40\x20\x20\155\x6b\137\x61\164\164\162\x2e\x63\123\x74\x72\x69\156\x67\127\x65\x72\x74\40\x41\123\40\x63\115\145\x74\x61\113\145\171\167\x6f\162\144\x73\x2c\xa\40\40\x20\40\40\x20\x20\40\40\x20\x20\40\155\x74\x5f\x61\x74\164\162\x2e\x63\123\x74\x72\x69\x6e\x67\127\x65\162\x74\40\101\123\40\x63\124\151\164\154\145\x54\141\x67\54\xa\40\x20\40\x20\40\40\40\x20\40\x20\40\40\x70\56\x63\x50\x66\141\144\12\40\40\x20\40\40\x20\x20\40\40\x20\x20\40\x46\122\117\115\40\x74\x61\x72\x74\x69\153\x65\x6c\x20\164\12\x20\40\40\40\40\40\x20\x20\40\40\x20\40\114\105\x46\x54\x20\112\117\111\x4e\x20\164\150\x65\x72\163\x74\x65\154\x6c\x65\x72\x20\150\x20\x4f\116\x20\150\56\x6b\110\x65\162\163\x74\145\154\154\145\x72\x20\75\40\x74\56\153\110\145\x72\163\x74\x65\154\x6c\145\162\12\x20\x20\x20\x20\x20\x20\x20\x20\x20\40\x20\40\x4c\105\106\124\40\112\x4f\111\x4e\40\164\163\x65\157\40\163\40\117\x4e\40\x73\56\x6b\113\x65\x79\x20\x3d\40\x74\56\153\101\162\x74\151\x6b\x65\154\x20\x41\116\104\40\163\x2e\x6b\123\x70\x72\141\143\x68\x65\x20\75\x20\x3a\154\x61\156\x67\165\141\147\x65\x20\x41\116\104\x20\x73\56\x63\x4b\145\x79\40\75\40\x27\x6b\101\162\164\x69\x6b\145\x6c\x27\12\40\x20\x20\x20\x20\x20\40\40\40\40\x20\40\114\x45\106\x54\x20\112\117\111\116\40\164\x61\162\164\x69\153\145\154\x70\151\143\x74\40\x70\x20\x4f\116\40\x70\x2e\x6b\x41\162\164\151\x6b\x65\154\x20\x3d\x20\x74\x2e\153\101\162\164\151\x6b\x65\154\40\101\x4e\104\40\160\x2e\156\116\x72\x20\x3d\40\x31\xa\40\40\40\x20\x20\x20\40\x20\x20\40\x20\x20\114\x45\x46\x54\40\112\x4f\x49\x4e\x20\164\141\x74\164\x72\151\142\165\x74\40\x6d\x64\x5f\141\x74\x74\x72\x20\x4f\116\x20\x6d\x64\137\141\x74\164\162\56\x6b\x41\162\x74\151\153\x65\x6c\x20\x3d\40\164\x2e\x6b\x41\162\x74\x69\153\x65\x6c\40\x41\116\104\x20\x6d\x64\137\x61\x74\164\162\x2e\143\x4e\x61\155\145\40\75\x20\x27\155\x65\164\141\x5f\x64\145\x73\x63\162\151\160\164\151\x6f\x6e\x27\xa\x20\40\40\40\40\x20\40\x20\x20\x20\x20\40\x4c\x45\106\124\40\112\x4f\111\x4e\x20\164\x61\x74\x74\162\x69\142\x75\164\40\155\x6b\x5f\141\x74\164\x72\x20\117\116\x20\155\x6b\x5f\141\x74\164\x72\56\x6b\101\x72\x74\x69\153\145\154\40\75\40\x74\56\153\101\x72\x74\151\x6b\x65\154\40\101\116\x44\x20\x6d\153\137\141\x74\164\162\x2e\x63\x4e\x61\x6d\x65\x20\x3d\40\x27\155\x65\164\x61\x5f\x6b\x65\x79\x77\x6f\162\144\163\x27\12\40\40\x20\x20\40\40\x20\x20\40\40\40\40\114\105\106\x54\x20\x4a\x4f\111\116\40\164\141\x74\164\162\151\142\165\x74\x20\x6d\x74\x5f\141\164\164\x72\40\x4f\116\40\155\164\137\x61\x74\164\x72\x2e\153\101\x72\x74\x69\x6b\145\x6c\40\x3d\x20\x74\x2e\153\x41\x72\x74\151\x6b\x65\154\40\101\116\104\x20\155\164\x5f\x61\164\x74\x72\x2e\x63\116\x61\155\145\40\75\40\47\x6d\x65\164\141\137\x74\x69\164\x6c\x65\x27\xa\x20\40\x20\x20\x20\40\40\x20\x20\x20\x20\40\x57\110\105\122\x45\x20\164\56\153\101\162\164\151\153\x65\154\x20\x3d\40\x3a\x69\164\x65\155\111\144\xa\40\x20\x20\x20\40\40\x20\40\40\40\x20\x20\x4c\x49\115\x49\124\x20\x31"; JkkO8: $getData = Shop::Container()->getDB()->queryPrepared($query, ["\x6c\141\x6e\x67\x75\141\147\x65" => $language, "\151\164\x65\x6d\x49\144" => $itemId], ReturnType::SINGLE_OBJECT); if (!empty($getData)) { goto TnRRg; } return false; TnRRg: $hideKundengruppe = Shop::Container()->getDB()->queryPrepared("\x53\x45\114\x45\103\x54\x20\x6b\x4b\165\x6e\x64\x65\x6e\147\162\x75\160\x70\145\x20\106\x52\117\x4d\40\164\141\x72\x74\x69\153\145\x6c\x73\151\143\150\164\142\x61\x72\153\x65\151\164\40\x57\110\x45\122\x45\x20\153\x41\x72\164\x69\153\145\x6c\x20\x3d\x20\x3a\x69\164\x65\155\111\144", ["\151\x74\145\155\x49\x64" => $itemId], ReturnType::ARRAY_OF_OBJECTS); foreach ($hideKundengruppe as $key => $hideElement) { $hideKundengruppe[$key] = $hideElement->kKundengruppe; J0TIf: } goto MYMd0; w99Y0: return $this->stripDescriptionTags($getData); goto l3dvq; l3dvq: } private function getProductDataMainLanguage($itemId, $itemType) { return $this->getItemData($itemId, $itemType); } private function getProductDataOtherLanguage($itemId, $itemType, $language) { return $this->getItemData($itemId, $itemType, $language); } private function stripDescriptionTags($data) { if (!empty($data)) { goto goocB; } return "\x7b\x7d"; goocB: if (empty($data->cBeschreibung)) { goto AePFZ; } $data->cBeschreibung = strip_tags($data->cBeschreibung); AePFZ: if (empty($data->cKurzBeschreibung)) { goto wzZD9; } $data->cKurzBeschreibung = strip_tags($data->cKurzBeschreibung); wzZD9: return json_encode($data); } private function splitDataRemoveFirst($data) { $chunks = explode("\40", $data); array_shift($chunks); $result = array_merge($chunks, $this->splitDataStrings($data)); return $result; } private function splitDataStrings($data) { $splitNames = []; $chunks = explode("\40", $data); $count = count($chunks); foreach ($chunks as $i => $chunk) { if (!(--$count >= 2)) { goto y2oew; } $splitNames[] = sprintf("\45\163", implode("\x20", array_slice($chunks, $i + 1)), $chunk); y2oew: UmRrz: } CRFWj: return $splitNames; } }