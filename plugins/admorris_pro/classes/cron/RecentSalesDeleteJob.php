<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\cron; use JTL\Cache\JTLCacheInterface; use Plugin\admorris_pro\ioHandling\CronJobIO; use JTL\Shop; use JTL\Cron\Job; use JTL\Cron\JobHydrator; use JTL\Cron\JobInterface; use JTL\Cron\QueueEntry; use JTL\DB\DbInterface; use Plugin\admorris_pro\RecentSalesHelper; use Psr\Log\LoggerInterface; class RecentSalesDeleteJob extends Job { public const RECENT_SALES_DELETE_CRON_JOB = "\x61\x64\x6d\x6f\162\162\151\163\137\162\145\143\x65\x6e\164\137\163\x61\154\x65\x73\x5f\144\145\154\145\x74\145"; public function __construct(DbInterface $db, LoggerInterface $logger, JobHydrator $hydrator, JTLCacheInterface $cache) { parent::__construct($db, $logger, $hydrator, $cache); } public function start(QueueEntry $queueEntry) : JobInterface { parent::start($queueEntry); $this->logger->debug("\x52\x65\x63\x65\156\164\40\x53\141\x6c\145\163\40\104\x65\x6c\145\x74\145\40\143\162\x6f\x6e\40\x6a\x6f\142\x20\x73\164\141\162\x74\x65\x64"); if ($res = $this->deleteOldEntries()) { goto DxG4R; } $this->logger->debug("\122\145\143\x65\156\x74\x20\x53\x61\154\145\163\x20\x44\x65\x6c\145\164\x65\x20\x63\x72\157\x6e\x20\152\x6f\142\x20\146\141\x69\154\x65\144\56\40\x50\154\x65\141\163\145\x20\x74\x72\171\40\x61\x67\141\x69\156"); goto d6Rt5; DxG4R: $this->logger->debug("\x52\145\143\x65\156\164\x20\x53\x61\x6c\145\163\40\104\x65\154\145\x74\145\40\x63\162\x6f\x6e\x20\x6a\157\x62\40\x66\151\x6e\151\x73\x68\x65\x64\x2e"); d6Rt5: $this->setFinished(true); return $this; } private function deleteOldEntries() : bool { return RecentSalesHelper::deleteOldEntries(); } public static function handleCron($settings) { $cronExists = Shop::Container()->getDB()->select("\164\143\162\157\x6e", "\x6a\x6f\x62\x54\171\x70\145", self::RECENT_SALES_DELETE_CRON_JOB); if (!(!$cronExists && ($settings["\155\x61\162\153\145\164\x69\x6e\x67\137\x72\145\143\145\x6e\164\137\x73\141\x6c\145\163\x5f\141\143\x74\x69\x76\145"] === "\131" || $settings["\x6d\141\162\153\x65\x74\x69\x6e\x67\137\162\x65\143\x65\x6e\x74\137\166\151\163\151\164\x73\137\141\x63\164\151\x76\145"] === "\x59"))) { goto DW86u; } CronJobIO::addCron("\x44\x65\154\145\164\x65\x20\122\x65\143\x65\x6e\164\x20\x53\x61\154\x65\x73", self::RECENT_SALES_DELETE_CRON_JOB); DW86u: if (!($cronExists && ($settings["\x6d\141\162\153\x65\164\151\156\x67\137\162\x65\x63\145\156\164\x5f\x73\141\154\145\163\x5f\x61\x63\164\151\166\x65"] === "\116" && $settings["\x6d\x61\x72\x6b\x65\164\151\x6e\147\137\162\x65\x63\145\x6e\164\137\166\x69\x73\x69\x74\x73\137\141\x63\x74\151\x76\x65"] === "\116"))) { goto Nn1hy; } CronJobIO::removeCron(self::RECENT_SALES_DELETE_CRON_JOB); Nn1hy: } }