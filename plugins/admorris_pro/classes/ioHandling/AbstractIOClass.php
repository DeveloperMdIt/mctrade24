<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\ioHandling; use Exception; use JTL\IO\IOError; use JTL\Shop; use Plugin\admorris_pro\RequestEnum; abstract class AbstractIOClass { protected static $tableName; public const CACHE_ID = null; public const CACHE_TAGS = []; public function __construct() { } public static function request($data, $requestType) { try { return match ($requestType) { RequestEnum::Create => static::create($data), RequestEnum::GetById => static::getById($data), RequestEnum::GetAll => static::getAll(), RequestEnum::Update => static::update($data), RequestEnum::UpdateMultiple => static::updateMultiple($data), RequestEnum::Delete => static::delete($data), default => static::$requestType($data), }; } catch (Exception $e) { return new IOError("\x45\x72\162\x6f\162\40\151\156\40" . get_called_class() . "\40\x63\x61\154\154\151\x6e\x67\x20" . $requestType . "\73", 500, [(string) $e]); } } public static function create($data) { $data = (object) $data; if (!isset($data->id)) { goto oRXT4; } unset($data->id); oRXT4: $newId = Shop::Container()->getDB()->insert(static::$tableName, $data); if ($newId > 0) { goto NLs8m; } throw new Exception("\x43\x6f\165\154\144\40\x6e\157\x74\40\151\156\163\145\x72\x74\40\151\x6e\164\x6f\40" . static::$tableName); goto mheTL; NLs8m: $data->id = $newId; static::flushCache(); return $data; mheTL: } public static function getAll() { $all = Shop::Container()->getDB()->selectAll(static::$tableName, [], []); foreach ($all as $item) { foreach ($item as $key => $value) { if (!($value === "\x59" || $value === "\116")) { goto QgulG; } $value === "\x59" ? $item->{$key} = true : ($item->{$key} = false); QgulG: if (!(($value === "\x31" || $value === "\x30") && $key === "\163\x65\x74\164\x69\156\147\x56\141\154\x75\145")) { goto hjjcd; } $value === "\61" ? $item->{$key} = true : ($item->{$key} = false); hjjcd: vrV2s: } IBCWa: VMVjp: } z1T8a: return $all; } public static function getById($id) { $item = Shop::Container()->getDB()->select(static::$tableName, "\151\144", (int) $id); if ($item) { goto ca9bv; } throw new Exception("\x43\157\x75\154\x64\40\156\x6f\x74\x20\147\145\164\x20\151\x74\x65\x6d\40\x66\x72\x6f\155\40" . static::$tableName); goto VFAAS; ca9bv: return $item; VFAAS: } public static function where($column, $identifier, $singleVal = false) { if (!intval($identifier)) { goto Hu1Sd; } $identifier = intval($identifier); Hu1Sd: $array = Shop::Container()->getDB()->selectArray(static::$tableName, $column, $identifier); if (!(count($array) === 1 && $singleVal)) { goto QO_Jo; } return $array[0]; QO_Jo: return $array; } public static function update($data) { $values = clone $data; $value = property_exists($values, "\x73\145\164\x74\151\156\x67\x56\141\154\165\x65") ? $values->settingValue : null; if (!($value === true || $value === false)) { goto eWk8w; } $value === true ? $values->settingValue = "\x31" : ($values->settingValue = "\x30"); eWk8w: $update = Shop::Container()->getDB()->update(static::$tableName, "\x69\144", $data->id, $values); if ($update !== -1) { goto EHOmj; } throw new Exception("\103\157\x75\x6c\144\40\x6e\x6f\x74\x20\165\x70\144\x61\164\x65\x20" . static::$tableName); goto VpsDU; EHOmj: static::flushCache(); return $data; VpsDU: } public static function delete($data) { $toDelete = Shop::Container()->getDB()->delete(static::$tableName, "\151\144", (int) $data->id); if ($toDelete === -1) { goto wFWcA; } static::flushCache(); return $data; goto CK5MH; wFWcA: throw new Exception("\103\157\x75\x6c\x64\x20\x6e\157\164\x20\144\145\154\145\164\x65\40\151\156\x20" . static::$tableName); CK5MH: } public static function updateMultiple($data) { $returnArr = []; foreach ($data as $item) { $returnArr[] = static::update((object) $item); FPLkP: } rsbYZ: return $returnArr; } public static function flushCache() { $cache = Shop::Container()->getCache(); if (empty(static::CACHE_ID)) { goto kBaB7; } $cache->flush(static::CACHE_ID); kBaB7: if (empty(static::CACHE_TAGS)) { goto wKuKv; } $cache->flushTags(static::CACHE_TAGS); wKuKv: } }