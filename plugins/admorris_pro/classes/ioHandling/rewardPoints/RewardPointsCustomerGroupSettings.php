<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\ioHandling\rewardPoints; use Exception; use JTL\Shop; use Plugin\admorris_pro\ioHandling\AbstractIOClass; use stdClass; class RewardPointsCustomerGroupSettings extends AbstractIOClass { protected static $tableName = "\170\x70\x6c\165\x67\151\x6e\137\141\x64\x6d\x6f\x72\162\x69\163\137\x70\x72\157\137\x72\145\x77\141\x72\144\x5f\160\x6f\x69\156\x74\163\x5f\x63\165\x73\x74\x6f\x6d\145\162\x5f\x67\x72\x6f\x75\160\x5f\x73\145\x74\164\151\x6e\147\x73"; public static function create($data) { $newId = Shop::Container()->getDB()->insert(static::$tableName, $data); if ($newId > 0) { goto DUY2d; } throw new Exception("\103\157\165\x6c\144\x20\156\157\164\x20\151\156\163\145\x72\164\40\151\x6e\x74\x6f\x20" . static::$tableName); goto qlOgI; DUY2d: $data->customergroup_id = $newId; return $data; qlOgI: } public static function update($data) { $filtered = new stdClass(); $filtered->customergroup_id = $data->customergroup_id; $filtered->active_id = "\x30"; $filtered->earn_conversionrate = $data->earn_conversionrate; if ($filtered->customergroup_id) { goto aQb7H; } $filtered->customergroup_id = $data->kKundengruppe; $create = self::create($filtered); $obj_merged = (object) array_merge((array) $data, (array) $create); goto f8K9n; aQb7H: $update = Shop::Container()->getDB()->update(static::$tableName, "\x63\x75\x73\x74\x6f\x6d\x65\162\x67\x72\157\165\x70\x5f\151\144", $filtered->customergroup_id, $filtered); if ($update !== -1) { goto CWgtG; } throw new Exception("\x43\x6f\165\154\x64\x20\x6e\157\164\40\165\x70\x64\141\164\145\40" . static::$tableName); goto qPC2Z; CWgtG: $obj_merged = (object) array_merge((array) $data, (array) $filtered); qPC2Z: f8K9n: return $obj_merged; } public static function getCustomerGroupSettings() { $customerGroups = Shop::Container()->getDB()->selectAll("\x74\153\x75\156\144\145\156\147\162\165\160\160\145", [], []); $rewardPointGroupSettings = self::getAll(); $data = array_map(function ($item) use($rewardPointGroupSettings) { $settings = array_filter($rewardPointGroupSettings, function ($prop) use($item) { return $prop->customergroup_id === $item->kKundengruppe; }); $setting = array_pop($settings); if ($setting) { goto bVY_k; } $item->earn_conversionrate = null; $item->customergroup_id = null; goto CFkM6; bVY_k: $item->earn_conversionrate = $setting->earn_conversionrate; $item->customergroup_id = $setting->customergroup_id; CFkM6: return $item; }, $customerGroups); return $data; } }