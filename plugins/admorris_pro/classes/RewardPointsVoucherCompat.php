<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Session\Frontend; use JTL\Shop; class RewardPointsVoucherCompat { public static function init(\JTL\Events\Dispatcher $dispatcher) { $dispatcher->listen("\x73\150\157\x70\x2e\x68\x6f\157\x6b\56" . \HOOK_BESTELLABSCHLUSS_INC_WARENKORBINDB, function (array $args_arr) { self::backupRewardPoints(); }, 0); $dispatcher->listen("\163\150\x6f\160\56\150\x6f\x6f\x6b\56" . \HOOK_BESTELLABSCHLUSS_INC_WARENKORBINDB, function (array $args_arr) { self::restoreRewardPoints(); }, 9); $dispatcher->listen("\x73\150\157\160\56\150\x6f\157\153\x2e" . \HOOK_BESTELLVORGANG_PAGE_STEPBESTAETIGUNG_GUTHABEN_PLAUSI, function () { self::backupRewardPoints(); }, 0); $dispatcher->listen("\x73\x68\157\160\x2e\x68\157\x6f\x6b\56" . \HOOK_BESTELLVORGANG_PAGE_STEPBESTAETIGUNG_GUTHABEN_PLAUSI, function () { self::restoreRewardPoints(); }, 9); } public static function backupRewardPoints() { foreach (Frontend::getCart()->PositionenArr as $Position) { if (!($Position->nPosTyp === \C_WARENKORBPOS_TYP_GUTSCHEIN && $Position->cResponsibility === "\x61\144\x6d\157\162\x72\x69\x73\x5f\160\162\157\137\x72\x65\x77\141\x72\x64\x70\x6f\x69\156\x74\163")) { goto cnHp0; } Shop::set("\141\144\x6d\x6f\x72\162\x69\x73\x5f\160\x72\x6f\x5f\162\x65\167\141\x72\x64\x70\x6f\151\156\164\x73", $Position); cnHp0: HKEFm: } aKQux: } public static function restoreRewardPoints() { $found = false; if (!(!isset($_SESSION["\141\x64\155\157\162\162\151\x73\122\145\167\x61\x72\x64\120\x6f\x69\x6e\164\x73"]) && is_null(Shop::get("\141\x64\155\157\x72\x72\x69\x73\137\x70\162\x6f\x5f\162\145\x77\x61\x72\144\x70\157\x69\x6e\x74\163")))) { goto A3Agb; } return; A3Agb: foreach (Frontend::getCart()->PositionenArr as $Position) { if (!($Position->nPosTyp === \C_WARENKORBPOS_TYP_GUTSCHEIN && $Position->cResponsibility === "\141\144\x6d\157\x72\162\151\163\x5f\160\162\x6f\137\x72\145\167\141\162\144\x70\157\x69\156\x74\163")) { goto iQsgu; } $found = true; iQsgu: liZQh: } yo9m3: if (!$found) { goto P2dJ3; } return; P2dJ3: Frontend::getCart()->PositionenArr[] = Shop::get("\141\x64\x6d\157\x72\x72\151\163\x5f\x70\162\157\x5f\162\145\x77\x61\162\144\x70\x6f\x69\156\x74\x73"); } }