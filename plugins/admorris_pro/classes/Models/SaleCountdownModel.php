<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\Models; use AdmPro\Carbon\Carbon; class SaleCountdownModel extends AbstractModel { protected $table = "\170\x70\154\x75\x67\x69\x6e\x5f\x61\144\x6d\x6f\x72\162\x69\x73\137\160\162\x6f\137\x73\x61\x6c\x65\x5f\143\157\x75\156\164\x64\x6f\x77\x6e"; protected $primaryKey = "\x69\x64"; public $timestamps = false; public const CACHE_ID = "\x61\144\x6d\157\x72\x72\x69\163\x5f\x70\x72\x6f\137\163\x61\154\145\137\143\157\x75\x6e\x74\x64\x6f\x77\x6e\x5f\x6d\157\144\145\x6c"; public const CACHE_TAGS = ["\141\144\155\x6f\x72\162\151\x73\137\160\x72\x6f\x5f\163\x61\x6c\x65\x5f\143\x6f\165\156\164\x64\157\x77\156"]; protected $fillable = ["\x6e\x61\155\145", "\141\x63\164\x69\166\x65", "\163\150\x6f\x77\x46\162\x6f\155\x44\x61\164\x65", "\163\164\141\x72\164\x44\x61\164\145", "\145\156\x64\104\141\164\145", "\144\151\163\x63\x6f\165\156\164", "\x62\x67\103\157\154\157\x72", "\164\145\170\164\x43\157\154\x6f\162", "\x68\x69\x67\150\x6c\151\x67\x68\164\103\157\154\x6f\162", "\146\x6f\156\x74\123\x69\x7a\145", "\160\x61\x64\x64\151\x6e\147\124\x6f\160", "\x70\141\144\x64\x69\156\x67\102\x6f\164\x74\157\x6d", "\x62\141\x6e\x6e\145\x72\114\x69\x6e\153", "\x70\x6f\x73"]; protected $casts = ["\141\143\164\151\x76\145" => "\142\x6f\x6f\154\145\141\156", "\x73\150\x6f\167\x46\162\157\155\x44\141\x74\145" => "\144\141\x74\x65\164\x69\155\145", "\163\164\x61\162\x74\x44\x61\x74\145" => "\144\x61\164\x65\x74\x69\155\x65", "\x65\156\144\104\141\164\145" => "\144\141\164\x65\x74\151\x6d\x65"]; protected $attributes = ["\x61\x63\x74\x69\166\x65" => true, "\x6e\141\x6d\x65" => '', "\x64\x69\x73\143\157\165\x6e\x74" => '', "\x62\147\x43\157\154\x6f\x72" => "\43\x30\60\x30\x30\x30\60", "\x74\x65\170\164\x43\157\154\157\x72" => "\43\x66\x66\146\x66\146\146", "\150\x69\147\x68\154\151\147\x68\164\103\x6f\154\x6f\162" => "\x23\146\x66\x30\60\x30\60", "\146\x6f\156\x74\x53\x69\172\x65" => "\x31\x36\160\x78", "\x70\141\x64\144\151\x6e\x67\x54\157\160" => "\x31\60\x70\x78", "\160\x61\144\144\x69\156\147\x42\x6f\x74\164\x6f\155" => "\x31\60\x70\170", "\x62\141\x6e\156\145\162\114\x69\x6e\x6b" => '', "\x70\x6f\163" => "\x61\x62\x6f\166\x65\55\150\145\x61\x64\145\162"]; public function texts() { return $this->hasMany(SaleCountdownTextModel::class, "\163\x61\x6c\145\103\157\x75\156\x74\x64\x6f\167\156\111\x64", "\151\x64"); } public function getTextForLanguage(string $languageId) : ?SaleCountdownTextModel { return $this->texts()->where("\154\141\156\x67\x75\141\147\145\x49\x64", $languageId)->first(); } public function isCurrentlyActive() : bool { $now = Carbon::now(); return $this->active && $this->showFromDate <= $now && $this->endDate >= $now; } public function isSaleOn() : bool { $now = Carbon::now(); return $now >= $this->startDate; } public function getStartDateIsoAttribute() : string { return $this->startDate->format("\143"); } public function getEndDateIsoAttribute() : string { return $this->endDate->format("\143"); } public function scopeActive($query) { return $query->where("\x61\x63\164\151\166\145", true); } public function scopeInTimeWindow($query) { $now = Carbon::now(); return $query->where("\x73\150\157\167\106\x72\157\x6d\104\141\164\145", "\x3c\x3d", $now)->where("\145\156\x64\x44\x61\164\145", "\76\x3d", $now); } }