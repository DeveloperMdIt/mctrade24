<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\Models; use Plugin\admorris_pro\RequestEnum; use AdmPro\Illuminate\Database\Eloquent\Model; use Exception; use JTL\IO\IOError; use JTL\Shop; class AbstractModel extends Model { public const CACHE_ID = null; public static function request($data, $requestType) { try { $resp = null; switch ($requestType) { case RequestEnum::Create: $resp = self::query()->create($data); goto SOc3l; case RequestEnum::GetAll: $resp = static::all()->first(); if (!empty($resp)) { goto cI2Oj; } $new = new static(); $new->save(); $resp = $new->toArray(); goto SOc3l; cI2Oj: $resp = $resp->toArray(); goto SOc3l; case RequestEnum::Update: case RequestEnum::UpdateMultiple: $model = static::findAndUpdateValues($data); $resp = static::saveModel($model); static::flushCache(); goto SOc3l; case RequestEnum::Delete: $resp = static::findAndDelete($data); static::flushCache(); goto SOc3l; default: $resp = call_user_func([get_called_class(), $requestType], $data); } DQOOM: SOc3l: return json_encode($resp); } catch (Exception $e) { return new IOError("\105\162\162\x6f\x72\x20\x69\x6e\40" . get_called_class() . "\40\143\141\154\154\151\x6e\x67\40" . $requestType . "\x3b", 500, [(string) $e]); } } public static function findAndUpdateValues(array $data) : Model { $model = self::query()->find($data["\151\144"]); unset($data["\151\x64"]); foreach ($data as $name => $value) { $model->{$name} = $value; Sb5pe: } f5nUp: return $model; } public static function findAndDelete(array $data) { $model = self::query()->find($data["\x69\144"]); return $model->delete(); } public static function saveModel($model) { $resp = $model->save(); if (!($resp === true)) { goto BnCrX; } return $model; BnCrX: } public static function flushCache() { if (!empty(static::CACHE_ID)) { goto UMgK3; } return; UMgK3: Shop::Container()->getCache()->flush(static::CACHE_ID); } }