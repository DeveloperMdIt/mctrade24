<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Plugin\Plugin; use JTL\Shop; use Plugin\admorris_pro\cron\RecentSalesDeleteJob; use Plugin\admorris_pro\Facades\Cache; use Plugin\admorris_pro\ioHandling\IoRequestTrait; use Plugin\admorris_pro\pluginSettings\PluginSettingsNew; use Plugin\admorris_pro\pluginSettings\PluginSettingsTypesTrait; use Plugin\admorris_pro\Utils\TypeConverter; class PluginSettings { use PluginSettingsTypesTrait; use IoRequestTrait; public const CACHE_ID = "\141\x64\x6d\157\x72\162\x69\x73\137\160\x72\157\x5f\160\x6c\x75\147\151\156\137\163\145\164\164\x69\x6e\147\x73"; private $settings; private $plugin; public function load() { return Cache::remember(self::CACHE_ID, function () { $this->settings = Shop::Container()->getDB()->getObjects("\x53\105\x4c\x45\103\124\40\52\xa\40\40\40\x20\40\40\x20\40\40\40\x20\40\x46\x52\x4f\x4d\40\164\160\x6c\165\147\x69\x6e\145\151\156\x73\164\145\154\154\x75\x6e\147\145\156\12\x20\40\40\40\x20\x20\x20\x20\x20\40\x20\x20\x57\x48\x45\x52\x45\40\153\120\x6c\165\x67\151\156\40\75\x20" . getPluginId()); if (!(count($this->settings) === 0)) { goto V9o4H; } return []; V9o4H: $this->buildSettingsArray(); $this->settings = NoShippingDays::load($this->settings); $this->settings = LiveSaleNotification::load($this->settings); $this->settings = SalesBoosterIcons::load($this->settings); $adventCalendarSettings = Shop::Container()->getDB()->select("\x78\160\x6c\165\147\151\x6e\137\141\x64\x6d\157\x72\162\x69\163\x5f\160\162\157\x5f\141\144\x76\145\156\164\137\143\x61\x6c\145\156\x64\141\x72\137\163\145\164\164\151\x6e\x67\x73", "\151\144", 1); $this->settings["\155\x61\162\x6b\145\164\151\156\147\x5f\141\x64\x76\145\156\x74\x5f\x63\x61\x6c\x65\156\144\141\162\x5f\141\x63\x74\151\x76\145"] = boolval($adventCalendarSettings->active); $this->setTypes(); return $this->settings; }); } public function save($settings) { if (isset($settings["\x73\145\x74\164\151\x6e\147\163"])) { goto rcr_m; } $this->settings = $settings; goto gF9DD; rcr_m: $this->settings = $settings["\163\145\164\164\x69\156\147\x73"]; gF9DD: $this->setTypes(true); LiveChat::handleConsent($this->settings["\155\141\162\153\145\x74\x69\156\x67\137\x6c\151\166\145\137\143\150\x61\x74\137\x61\x63\x74\151\166\x65"]); GoogleCustomerReviews::handleConsent($this->settings["\x6d\x61\162\153\x65\164\151\156\147\x5f\164\x72\x75\163\x74\155\141\162\153\137\147\x6f\157\x67\x6c\x65\x5f\x61\x63\x74\x69\166\145"]); ShopVote::handleConsent($this->settings["\155\141\162\x6b\x65\x74\x69\x6e\147\x5f\x74\x72\165\163\164\155\141\x72\153\137\141\x63\x74\151\x76\145"]); RecentSalesDeleteJob::handleCron($this->settings); $this->settings = NoShippingDays::save($this->settings); $this->settings = LiveSaleNotification::save($this->settings); $this->settings = SalesBoosterIcons::save($this->settings); $this->addSettingPrefix(); foreach ($this->settings as $name => $value) { $del = Shop::Container()->getDB()->delete("\x74\x70\x6c\x75\x67\x69\156\145\151\x6e\x73\x74\145\154\x6c\165\156\x67\145\x6e", ["\x6b\120\x6c\x75\147\151\156", "\x63\x4e\x61\155\x65"], [getPluginId(), $name]); $oPluginEinstellung = new \stdClass(); $oPluginEinstellung->kPlugin = getPluginId(); $oPluginEinstellung->cName = $name; $oPluginEinstellung->cWert = $value; $kKey = Shop::Container()->getDB()->insert("\164\160\x6c\x75\x67\x69\x6e\145\x69\156\x73\x74\x65\x6c\154\165\x6e\x67\145\x6e", $oPluginEinstellung); if (!($kKey < 0)) { goto E3iCx; } throw new \Exception("\106\145\150\x6c\145\162\x20\142\145\x69\x6d\40\163\160\x65\151\143\150\x65\162\x6e\40\x64\x65\x72\x20\x50\x6c\x75\x67\151\156\x2d\x53\x65\x74\164\151\x6e\147\x73"); E3iCx: PluginSettingsNew::flushCache(); kOmh2: } X5OxB: Shop::Container()->getCache()->flush(self::CACHE_ID); return $this->settings; } private function setTypes($decode = false) { $this->settings = TypeConverter::setTypes($this->settings, null, self::$convertBoolToString, self::$convertSpecialchars, $decode); if ($decode) { goto Og76f; } $this->settings["\155\x61\x72\153\145\164\x69\156\147\137\163\156\x6f\167\137\x63\x68\x61\162\141\143\164\x65\162"] = json_decode($this->settings["\x6d\x61\162\x6b\x65\164\151\x6e\147\x5f\x73\156\x6f\167\137\143\150\x61\162\x61\x63\164\x65\x72"]); foreach (self::$formatDate as $value) { $this->settings[$value] = TypeConverter::dateTimeStringToIso($this->settings[$value]); xfsZx: } F2DJ4: goto fAYeH; Og76f: $this->settings["\x6d\x61\x72\x6b\x65\164\151\x6e\147\137\x73\x6e\x6f\167\137\x63\x68\x61\162\141\x63\x74\x65\x72"] = json_encode($this->settings["\155\141\162\x6b\145\x74\x69\156\x67\x5f\x73\x6e\x6f\x77\x5f\x63\150\x61\x72\x61\143\x74\x65\x72"]); fAYeH: } private function buildSettingsArray() { $settings = []; foreach ($this->settings as $setting) { $name = str_replace("\141\x64\155\x6f\162\x72\151\x73\137\160\162\x6f\x5f", '', $setting->cName); $settings[$name] = $setting->cWert; GInUX: } XIC6z: $this->settings = $settings; } private function addSettingPrefix() { $prefixed = []; foreach ($this->settings as $name => $value) { $key = "\x61\144\x6d\157\162\162\151\x73\x5f\160\162\x6f\x5f" . $name; $prefixed = array_merge($prefixed, [$key => $value]); x8y9v: } CoBGg: $this->settings = $prefixed; } }