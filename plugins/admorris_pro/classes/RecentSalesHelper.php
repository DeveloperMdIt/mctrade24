<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Shop; class RecentSalesHelper { private static $settings; public static function getSettings() { if (!isset(self::$settings)) { goto C75R3; } return; C75R3: self::$settings = Shop::get("\141\144\x6d\x6f\x72\162\151\163\x50\162\157\x2d\163\x65\x74\x74\x69\156\x67\163"); } public static function deleteOldEntries() { goto FV_f3; OVHTd: if ($recent_sales_active && $recent_visits_active) { goto ybU14; } if ($recent_sales_active) { goto lcxJl; } if ($recent_visits_active) { goto hU9qp; } goto k9sX2; ybU14: if ($period_begin_sales < $period_begin_visits) { goto v0Y1J; } $period_begin = $period_begin_visits; goto dqf0i; v0Y1J: $period_begin = $period_begin_sales; goto eaQEs; eaQEs: dqf0i: goto k9sX2; lcxJl: $period_begin = $period_begin_sales; goto k9sX2; hU9qp: $period_begin = $period_begin_visits; k9sX2: Shop::Container()->getDB()->query("\104\x45\114\105\124\105\40\106\122\x4f\x4d\x20\170\160\154\165\x67\151\x6e\x5f\x61\144\155\x6f\x72\162\x69\x73\x5f\x70\162\157\x5f\162\145\143\145\x6e\x74\x5f\x73\x61\154\145\x73\x20\x57\110\x45\x52\x45\40\141\143\164\151\x6f\156\104\141\164\145\x20\74\x20\47{$period_begin}\x27"); return true; goto lOqiQ; FV_f3: self::getSettings(); $recent_sales_active = self::$settings["\155\141\x72\x6b\145\164\151\x6e\147\137\162\x65\x63\145\156\164\137\163\x61\154\x65\163\137\x61\143\164\151\166\x65"]; $recent_visits_active = self::$settings["\155\x61\x72\x6b\x65\164\151\156\x67\x5f\x72\x65\x63\145\156\x74\x5f\x76\151\x73\x69\164\x73\137\141\x63\x74\151\166\x65"]; if (!(!$recent_sales_active && !$recent_visits_active)) { goto MJNRl; } return false; MJNRl: $period_sales = self::$settings["\155\141\162\153\145\164\x69\156\147\137\162\145\143\x65\156\x74\x5f\163\x61\154\145\x73\137\160\145\162\151\157\144"]; $period_visits = self::$settings["\x6d\141\x72\x6b\145\x74\151\156\147\x5f\162\145\x63\145\x6e\x74\137\166\151\x73\151\x74\163\x5f\160\145\x72\x69\x6f\x64"]; $period_begin_sales = new TimeOffset("\x2d\40{$period_sales}\40\150\157\165\162", "\131\55\x6d\55\144\40\110\x3a\x69\72\163"); $period_begin_visits = new TimeOffset("\55\40{$period_visits}\40\155\x69\156", "\x59\55\x6d\x2d\x64\x20\x48\x3a\151\x3a\x73"); goto OVHTd; lOqiQ: } public static function insertVisit($Artikel, $ownVisit, $artikelNummer = null, ?TimeOffset $updateDateTimeCheck = null) { goto GjNEF; DxwtN: if ($updateDateTimeCheck !== null && $ownVisit->count > 0) { goto mnSOj; } goto sLxIC; DQsO3: $data = new \stdClass(); $data->kArtikel = $artikelNummer; $data->actionDate = $date; $data->quantity = 1; $data->sessionID = $jtl_token; $data->typ = "\x76\x69\163\151\x74"; Shop::Container()->getDB()->insert("\x78\x70\154\165\x67\151\x6e\137\x61\x64\155\x6f\162\162\x69\163\137\x70\162\157\137\x72\145\x63\145\x6e\164\137\163\x61\x6c\145\163", $data); goto Tew0Q; Tew0Q: goto sLxIC; mnSOj: $actionDate = new \DateTime($ownVisit->actionDate); if (!($updateDateTimeCheck > $actionDate)) { goto pR3s0; } $result = Shop::Container()->getDB()->query("\125\120\x44\101\x54\105\40\x60\170\x70\154\165\147\151\156\x5f\141\144\x6d\x6f\162\162\x69\163\x5f\x70\162\x6f\x5f\162\145\143\145\x6e\x74\137\x73\x61\x6c\x65\163\140\x20\x53\105\124\40\140\x61\x63\164\x69\157\156\x44\x61\164\145\x60\75\x20\x27{$date}\x27\x20\127\110\x45\122\x45\x20\x60\x73\145\x73\x73\151\157\156\x49\104\140\40\75\x20\x27{$jtl_token}\x27\x20\x41\116\x44\40\140\x6b\x41\x72\x74\151\x6b\x65\154\140\x20\75\40\x27{$artikelNummer}\47", 2); pR3s0: sLxIC: goto adTN6; GjNEF: if (!($artikelNummer === null)) { goto H2SWm; } $artikelNummer = $Artikel->kArtikel; H2SWm: $jtl_token = $_SESSION["\x6a\164\x6c\x5f\164\x6f\x6b\x65\156"]; $date = (new \DateTime())->format("\131\x2d\x6d\55\144\x20\x48\72\x69\x3a\x73"); $lager = $Artikel->fLagerbestand > 0 || $Artikel->cLagerBeachten === "\x4e"; if ($lager) { goto TpCi0; } return; TpCi0: if ($ownVisit->count == 0) { goto DQsO3; } goto DxwtN; adTN6: } }