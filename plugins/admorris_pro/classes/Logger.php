<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Shop; use Psr\Log\LoggerInterface; use Throwable; class Logger { public $pluginName = "\141\144\155\157\x72\162\151\x73\40\120\162\157"; public $log; public function __construct(LoggerInterface $logger, public string $prependText = '') { $this->log = $logger; } private function getPrefix() { $prepend = $this->prependText; if (empty($prepend)) { goto aZ9UH; } $prepend = $prepend . "\x20\x2d\x20"; aZ9UH: return $this->pluginName . "\72\40" . $prepend; } public function debug(?string $message = '') { if (Shop::isAdmin()) { goto T2M2I; } return; T2M2I: $error = $this->escape($message); $this->log->debug($error); } public function notice(Throwable|string $error) { $escapedError = $this->escape($error); $this->log->notice($this->pluginName . "\x3a\x20" . $escapedError); } public function warning(Throwable|string $error) { $escapedError = $this->escape($error); $this->log->warning($this->pluginName . "\40\127\x61\162\156\x69\156\x67\72\x20" . $escapedError); } public function error(Throwable|string $error) { $escapedError = $this->escape($error); $this->log->error($this->pluginName . "\40\105\x72\x72\157\162\x3a\x20" . $escapedError); $this->triggerError($this->pluginName . "\x20\105\162\162\x6f\x72\72\x20" . $error, E_USER_WARNING); } private function triggerError($message, $level) { $backtrace = debug_backtrace(); $caller = $backtrace[1]; $function = $backtrace[2]["\146\165\x6e\143\164\x69\x6f\156"]; trigger_error($message . "\x2c\x20\x46\x75\156\x63\x74\151\157\x6e\x3a\40\x3c\x73\x74\162\x6f\156\147\x3e" . $function . "\74\x2f\x73\164\162\x6f\156\147\76\54\40\106\151\x6c\145\72\x20\x3c\x73\x74\162\157\156\x67\x3e" . $caller["\x66\151\154\x65"] . "\x3c\x2f\x73\164\x72\x6f\x6e\147\76\40\157\x6e\x20\x6c\x69\156\x65\x20\74\x73\164\x72\157\x6e\147\76" . $caller["\154\151\x6e\145"] . "\x3c\x2f\163\x74\x72\x6f\156\x67\76" . "\12\x3c\x62\x72\x20\x2f\x3e\x65\x72\x72\157\x72\40\x68\141\156\x64\x6c\x65\162", $level); } private function escape($string) { $string = htmlentities($string, ENT_QUOTES | ENT_SUBSTITUTE | ENT_DISALLOWED); return preg_replace("\x2f\x5c\134\x2f", "\x26\x42\141\143\x6b\163\x6c\x61\x73\x68\x3b", $string); } }