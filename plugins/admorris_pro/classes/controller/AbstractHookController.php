<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\controller; use JTL\Events\Dispatcher; use JTL\Plugin\PluginInterface; use Plugin\admorris_pro\LoggerTrait; use Plugin\admorris_pro\StatusRequest; abstract class AbstractHookController { use LoggerTrait; protected bool $isActive = false; protected string $configKey = ''; protected int $minModuleLevel = 2; public function __construct(protected readonly PluginInterface $plugin, protected readonly Dispatcher $dispatcher, protected readonly StatusRequest $statusRequest) { $this->initLogger(); if ($this->checkRequirements()) { goto HGw2f; } return; HGw2f: $this->isActive = true; $this->init(); } protected function checkRequirements() : bool { if (!empty($this->configKey)) { goto wUOFd; } throw new \InvalidArgumentException("\x63\x6f\156\x66\x69\x67\113\145\x79\x20\160\162\x6f\x70\145\162\x74\171\x20\x6d\x75\x73\164\x20\142\145\x20\x73\145\x74\x20\x69\x6e\40\143\150\x69\154\x64\40\143\x6c\141\x73\x73"); wUOFd: $active = $this->plugin->getConfig()->getValue($this->configKey) === "\131"; $module = $this->statusRequest->module(); return $active && $module >= $this->minModuleLevel; } protected abstract function init() : void; public function isActive() : bool { return $this->isActive; } }