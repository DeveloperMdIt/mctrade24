<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\update; use JTL\DB\DbInterface; use JTL\DB\ReturnType; use Plugin\admorris_pro\LoggerTrait; class RewardPointsExpertSettingsUpdater { use LoggerTrait; use SettingsLoaderTrait; private $updateValues = ["\163\150\x6f\167\137\143\141\x72\164" => ["\157\x6c\x64\x5f\163\x65\154\x65\143\164\157\x72" => "\x2e\x70\162\157\143\x65\x65\144\40\56\163\165\x62\x6d\151\164", "\156\x65\167\x5f\163\x65\x6c\x65\143\164\x6f\162" => "\43\x63\x61\162\x74\55\143\x68\145\143\153\157\165\164\x2d\142\164\x6e", "\x6d\157\144\x69\146\151\x65\162" => "\x62\145\146\157\162\x65"], "\163\x68\157\x77\137\x63\150\145\143\x6b\157\165\164" => ["\157\x6c\x64\137\163\145\154\145\143\164\157\x72" => "\43\x63\x6f\x6d\160\x6c\x65\164\x65\55\x6f\162\x64\145\162\55\x62\x75\164\x74\157\156", "\x6e\x65\167\x5f\x73\145\x6c\x65\143\164\157\x72" => "\56\x63\x68\145\143\153\157\165\164\x2d\x62\x75\164\x74\157\x6e\55\x72\157\167", "\x6d\157\x64\x69\x66\151\x65\x72" => "\x62\145\x66\157\162\x65"]]; public function __construct(protected DbInterface $db) { $this->initLogger(); $this->setSearchValue("\145\x78\x70\x65\x72\x74\x5f\163\145\164\164\151\x6e\147\163\x5f\162\x65\x77\x61\162\x64\x5f\x70\157\x69\156\x74\163"); try { $this->loadSettings(); $this->updateSettings(); } catch (\Throwable $th) { $this->log->error($th); } } public function updateSettings() { $compareSetting = function ($key, $modifier = false) { $postfix = $modifier ? "\137\143\x73\x73\137\163\x65\x6c\x65\x63\164\157\x72\x5f\164\171\x70\x65" : "\x5f\143\163\163\x5f\x73\x65\154\x65\x63\x74\x6f\162"; return fn($item) => $item->cName === $this->getSearchValue() . $key . $postfix; }; foreach ($this->updateValues as $key => $value) { $selectorSetting = collect($this->pluginSettings)->first($compareSetting($key, false)); if (!($selectorSetting?->cWert !== $value["\157\154\x64\137\163\145\154\x65\x63\164\157\162"])) { goto kWN13; } goto MwaSh; kWN13: $selectorSetting->cWert = $value["\x6e\145\x77\137\x73\x65\x6c\x65\143\164\157\x72"]; $this->db->update("\x74\x70\154\165\147\x69\156\x65\x69\156\163\x74\x65\154\154\x75\x6e\x67\145\156", "\143\116\x61\155\145", $selectorSetting->cName, $selectorSetting); $modifierSetting = collect($this->pluginSettings)->first($compareSetting($key, true)); if ($modifierSetting) { goto ipL9i; } goto MwaSh; ipL9i: $modifierSetting->cWert = $value["\x6d\x6f\144\x69\x66\151\x65\x72"]; $this->db->update("\x74\x70\154\165\x67\x69\x6e\x65\x69\156\x73\164\x65\154\x6c\165\x6e\147\145\x6e", "\x63\116\x61\155\x65", $modifierSetting->cName, $modifierSetting); MwaSh: } EVR3Q: } }