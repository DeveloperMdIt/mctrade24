<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\Facades; use JTL\Cache\JTLCacheInterface; use JTL\Plugin\Helper; use JTL\Shop; class Cache { private static function getCache() : JTLCacheInterface { return Shop::Container()->getCache(); } private static function getPluginCacheGroup() : ?string { $plugin = Shop::get("\x6f\x70\154\x75\x67\151\156\137\x61\x64\155\x6f\x72\162\x69\x73\137\x70\x72\x6f"); if (!$plugin) { goto i9Sa3; } return $plugin->getCache()->getGroup(); i9Sa3: return Helper::getPluginById("\141\x64\155\157\x72\162\x69\x73\x5f\x70\162\157")?->getCache()->getGroup(); } private static function getDefaultTags(array $customTags = []) : array { $pluginCacheGroup = self::getPluginCacheGroup(); if (!($pluginCacheGroup === null)) { goto i2g4n; } return [\CACHING_GROUP_PLUGIN]; i2g4n: $defaultTags = [self::getPluginCacheGroup(), \CACHING_GROUP_PLUGIN]; return array_merge($defaultTags, $customTags); } public static function remember(string $key, $callback, array $tags = [], ?int $ttl = null) { $cache = self::getCache(); $cacheTags = self::getDefaultTags($tags); $value = $cache->get($key); if (!($value !== false)) { goto wiYCs; } return $value; wiYCs: if (is_callable($callback)) { goto zj78e; } $value = $callback; goto QlxcX; zj78e: $value = $callback(); QlxcX: $cache->set($key, $value, $cacheTags, $ttl); return $value; } public static function rememberForever(string $key, $callback, array $tags = []) { return self::remember($key, $callback, $tags); } public static function put(string $key, $value, array $tags = [], ?int $ttl = null) : bool { $cache = self::getCache(); $cacheTags = self::getDefaultTags($tags); return $cache->set($key, $value, $cacheTags, $ttl); } public static function forever(string $key, $value, array $tags = []) : bool { return self::put($key, $value, $tags, 0); } public static function get(string $key, $default = null) { $value = self::getCache()->get($key); return $value !== false ? $value : $default; } public static function forget(string $key, array $tags = []) : bool { if (empty($tags)) { goto FR0li; } $cacheTags = self::getDefaultTags($tags); return self::getCache()->flushTags($cacheTags) > 0; FR0li: return self::getCache()->flush($key); } public static function flush() : bool { return self::getCache()->flushAll(); } public static function flushTags(array $tags) : int { $cacheTags = self::getDefaultTags($tags); return self::getCache()->flushTags($cacheTags); } public static function has(string $key) : bool { return self::getCache()->get($key) !== false; } public static function increment(string $key, int $value = 1, array $tags = []) { $cache = self::getCache(); $current = $cache->get($key); if (!($current === false)) { goto HMsy8; } $current = 0; HMsy8: $new = (int) $current + $value; $cacheTags = self::getDefaultTags($tags); $cache->set($key, $new, $cacheTags); return $new; } public static function decrement(string $key, int $value = 1, array $tags = []) { return self::increment($key, -$value, $tags); } public static function many(array $keys) : array { return self::getCache()->getMulti($keys); } public static function putMany(array $values, array $tags = [], ?int $ttl = null) : bool { $cacheTags = self::getDefaultTags($tags); return self::getCache()->setMulti($values, $cacheTags, $ttl); } public static function getKeysByTag(array $tags) : array { $cacheTags = self::getDefaultTags($tags); return self::getCache()->getKeysByTag($cacheTags); } }