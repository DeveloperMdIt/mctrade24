<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Shop; class AmSlider { public const CACHE_ID_PREFIX = "\141\144\x6d\x6f\x72\162\151\x73\137\160\162\x6f\x5f\163\154\x69\144\x65\x72\137"; public const CACHE_ID_ARROWS_PREFIX = "\x61\144\x6d\157\x72\162\x69\x73\x5f\x70\x72\x6f\137\163\x6c\x69\x64\145\162\137\x61\x72\x72\x6f\167\163\x5f"; public const CACHE_ID_BULLETS_PREFIX = "\141\144\x6d\x6f\162\x72\151\x73\x5f\x70\162\157\137\163\154\151\x64\145\x72\137\x62\165\154\x6c\x65\164\x73\137"; public const CACHE_TAG_SLIDERS = "\141\144\x6d\157\162\x72\151\163\x5f\x70\x72\157\137\x73\154\x69\x64\145\x72\x73"; public $id; public $name; public $active = 0; public $desktopSlides = []; public $mobileSlides = []; public $navArrowsIconId = null; public $navBulletsIconId = null; public $navArrowsSvg; public $navBulletsSvg; public $delay = 500; public $transition = ''; public $fullscreen = ''; public $pauseOnHover = false; public $shuffle = false; public $autoplay = true; public $looping = true; public $keyboardNavigation = false; public $parallax = false; public $hideNavOnMobile = false; public $hideNavOnLeave = false; public $slide_arr = []; public $sliderBackgroundColor = "\x23\x30\x30\60\60\x30\x30"; public $sizeRatio = ''; public $sliderContainerSize = "\x66\x75\154\x6c\167\151\x64\164\x68"; private $cache; public function __construct() { $this->cache = Shop::Container()->getCache(); } private function __clone() { } public function init(int $id) : self { $id = (int) $id; if (!($id > 0)) { goto cUQA6; } global $smarty; if (!($this->load($id, "\101\116\104\x20\141\x63\x74\x69\x76\x65\x20\x3d\40\61") === true && (int) $this->active === 1)) { goto hehJI; } $this->getNavArrowsSvg(); $this->getNavBulletssSvg(); if (!($this->shuffle === "\x31")) { goto AIpc8; } $this->slide_arr = $this->shuffleSlidesArray($this->slide_arr); AIpc8: $this->setResponsiveSlideArrrays(); $smarty->assign("\120\x46\101\104\137\123\114\111\x44\x45\122", Shop::getURL() . "\x2f" . PFAD_BILDER_SLIDER)->assign("\141\155\x53\154\151\x64\x65\162", $this); hehJI: cUQA6: return $this; } public function set(array $cData_arr) { $cObjectFields_arr = get_class_vars("\x50\x6c\165\147\151\156\x5c\x61\x64\155\157\x72\x72\151\x73\137\x70\x72\x6f\134\101\155\123\154\x69\144\x65\162"); unset($cObjectFields_arr["\x73\154\x69\144\x65\137\x61\x72\x72"]); foreach ($cObjectFields_arr as $cField => $cValue) { if (!isset($cData_arr[$cField])) { goto KuIOo; } $this->{$cField} = $cData_arr[$cField]; KuIOo: G2YKU: } eowWg: return $this; } public function load($id = 0, $filter = '', $limit = 1) { goto mH4Oe; WXaz5: return false; goto Cn3HS; mH4Oe: if (!((int) $id > 0 || !empty($this->id) && (int) $this->id > 0)) { goto fQtIi; } if (!(empty($id) || (int) $id === 0)) { goto xTTQa; } $id = $this->id; xTTQa: $id = (int) $id; $limit = (int) $limit; $cacheId = self::CACHE_ID_PREFIX . $id . "\137" . md5($filter . "\137" . $limit); if (!(($cachedData = $this->cache->get($cacheId)) !== false)) { goto A3TYf; } $this->set($cachedData["\163\154\x69\144\x65\x72\x44\x61\164\x61"]); $this->slide_arr = $cachedData["\163\x6c\151\144\x65\x44\x61\164\141"]; goto QVrZF; QVrZF: return true; A3TYf: $cSlider_arr = Shop::Container()->getDB()->query("\12\x20\x20\x20\x20\x20\x20\40\40\40\x20\40\40\x20\40\x20\40\x53\105\x4c\105\x43\x54\40\52\12\40\x20\40\x20\x20\40\40\40\x20\x20\x20\x20\40\x20\x20\x20\x20\x20\x20\x20\106\122\117\x4d\x20\x78\160\x6c\165\x67\151\x6e\x5f\x61\144\x6d\x6f\162\162\151\163\x5f\160\x72\157\137\x73\154\151\144\x65\162\12\40\x20\x20\40\40\x20\x20\40\40\40\x20\40\40\40\40\40\40\40\x20\40\127\x48\105\122\105\40\x69\144\x20\75\x20" . $id . "\40" . $filter . "\12\x20\x20\x20\40\40\x20\x20\x20\40\40\x20\x20\x20\40\x20\x20\40\40\x20\x20\114\x49\x4d\x49\124\40" . $limit, 8); if (!($cSlider_arr === null)) { goto WSiZ7; } return false; WSiZ7: $kSlide_arr = Shop::Container()->getDB()->query("\12\x20\x20\40\x20\x20\x20\x20\x20\x20\x20\40\x20\x20\x20\x20\x20\123\x45\x4c\x45\103\124\40\x69\144\xa\40\x20\40\40\40\x20\40\x20\40\40\40\40\40\x20\40\40\40\x20\x20\x20\x46\122\x4f\x4d\x20\x78\x70\x6c\165\147\x69\156\x5f\x61\144\x6d\x6f\x72\x72\x69\x73\x5f\160\x72\x6f\137\x73\154\x69\x64\x65\12\x20\40\40\x20\x20\40\x20\40\40\40\40\x20\x20\x20\x20\40\40\40\x20\40\127\110\x45\122\x45\40\x73\154\x69\144\x65\x72\x49\144\40\x3d\x20" . $id . "\12\x20\40\40\40\40\x20\x20\40\x20\40\40\x20\40\x20\40\40\x20\x20\40\40\x4f\122\104\105\x52\x20\x42\x59\x20\163\157\x72\x74\x20\101\x53\x43", 9); $slide_arr = []; foreach ($kSlide_arr as $kSlide) { $oSlide = new AmSlide(); $oSlide->sliderId = (int) $id; $oSlide->id = (int) $kSlide["\151\x64"]; $oSlide->load(); $slide_arr[] = $oSlide; eACdC: } MCrpM: goto hq7AM; hq7AM: if (!is_array($slide_arr)) { goto x3z8J; } $this->slide_arr = $slide_arr; x3z8J: if (!is_array($cSlider_arr)) { goto x7QxW; } $this->set($cSlider_arr); $cacheData = ["\x73\154\x69\x64\x65\162\104\141\x74\x61" => $cSlider_arr, "\163\x6c\x69\x64\145\104\x61\164\141" => $slide_arr]; $this->cache->set($cacheId, $cacheData, [\CACHING_GROUP_PLUGIN, self::CACHE_TAG_SLIDERS, Shop::get("\x6f\x70\x6c\165\x67\151\x6e\137\141\144\x6d\157\x72\x72\x69\x73\x5f\160\x72\x6f")?->getCache()->getGroup()]); return true; x7QxW: fQtIi: goto WXaz5; Cn3HS: } public function save() { $result = $this->id > 0 ? $this->update() : $this->append(); $this->flushSliderCache(); return $result; } private function append() { $oSlider = clone $this; unset($oSlider->slide_arr, $oSlider->id, $oSlider->navArrowsSvg, $oSlider->navBulletsSvg, $oSlider->desktopSlides, $oSlider->mobileSlides); $id = Shop::Container()->getDB()->insert("\170\x70\x6c\x75\x67\151\156\137\x61\144\x6d\x6f\162\x72\x69\163\137\160\x72\x6f\x5f\x73\154\x69\x64\145\x72", $oSlider); if (!((int) $id > 0)) { goto AUSjn; } $this->id = (int) $id; return true; AUSjn: return false; } private function update() { $oSlider = clone $this; unset($oSlider->slide_arr, $oSlider->id, $oSlider->navArrowsSvg, $oSlider->navBulletsSvg, $oSlider->desktopSlides, $oSlider->mobileSlides); return Shop::Container()->getDB()->update("\170\x70\154\165\147\x69\x6e\x5f\x61\x64\155\157\162\x72\x69\x73\137\160\x72\x6f\x5f\163\154\151\144\x65\x72", "\x69\x64", $this->id, $oSlider) >= 0; } public function delete($id = 0) { if (!((int) $this->id !== 0 && (int) $id !== 0)) { goto sSL5t; } $id = $this->id; sSL5t: $id = (int) $id; if (!($id !== 0)) { goto pXYW_; } $affected = Shop::Container()->getDB()->delete("\170\x70\154\x75\147\x69\x6e\137\x61\x64\x6d\x6f\x72\x72\151\x73\137\160\162\157\x5f\x73\154\x69\144\145\162", "\x69\x64", $id); Shop::Container()->getDB()->delete("\164\x65\x78\164\145\x6e\x73\151\x6f\x6e\x70\x6f\x69\156\164", ["\x63\x43\154\141\x73\x73", "\x6b\111\156\151\x74\x69\x61\x6c"], ["\101\155\x53\x6c\x69\144\145\162", $id]); if (!($affected > 0)) { goto qdWT3; } if (empty($this->slide_arr)) { goto YBlUf; } foreach ($this->slide_arr as $oSlide) { $oSlide->delete(); stakZ: } j63U2: YBlUf: $this->flushSliderCache(); return true; qdWT3: pXYW_: return false; } public function flushSliderCache() { $cache = $this->cache ?? Shop::Container()->getCache(); $cache->flushTags([self::CACHE_TAG_SLIDERS]); $cache->flush(self::CACHE_ID_ARROWS_PREFIX . $this->id); $cache->flush(self::CACHE_ID_BULLETS_PREFIX . $this->id); } private function getNavArrowsSvg() { $cacheId = self::CACHE_ID_ARROWS_PREFIX . $this->id; if (!(($cachedSvg = $this->cache->get($cacheId)) !== false)) { goto seTbe; } $this->navArrowsSvg = $cachedSvg; return; seTbe: $svg = Shop::Container()->getDB()->getSingleObject("\xa\40\40\x20\x20\40\x20\40\x20\123\x45\114\105\x43\x54\40\x70\x61\164\x68\117\x72\x53\166\x67\54\40\151\x63\157\156\124\171\160\x65\x20\xa\x20\x20\40\40\x20\40\40\x20\106\122\117\x4d\x20\x78\160\x6c\165\x67\x69\156\x5f\x61\x64\x6d\x6f\x72\x72\x69\x73\137\x70\162\x6f\137\x69\x63\x6f\x6e\163\xa\40\x20\40\x20\x20\x20\x20\x20\111\x4e\x4e\105\122\x20\112\117\111\x4e\x20\170\160\x6c\165\147\x69\156\x5f\141\x64\x6d\157\x72\162\x69\163\x5f\x70\162\157\137\163\154\x69\144\x65\x72\12\40\x20\40\x20\x20\40\x20\40\x4f\x4e\x20\170\x70\154\x75\x67\x69\156\x5f\x61\144\x6d\157\162\x72\151\x73\137\x70\x72\x6f\x5f\x73\154\151\144\x65\x72\56\x6e\141\166\101\x72\162\x6f\x77\163\111\143\157\156\111\x64\40\75\x20\170\160\x6c\165\x67\151\x6e\137\x61\144\155\157\162\162\x69\163\137\x70\x72\157\137\x69\143\157\x6e\163\56\151\x63\x6f\156\x49\x64\40\x57\110\x45\122\105\40\170\x70\x6c\x75\147\x69\156\137\x61\x64\155\157\x72\162\151\x73\137\x70\x72\x6f\137\163\154\x69\x64\x65\x72\x2e\x69\x64\x20\x3d\x20\x3a\151\x64", ["\151\x64" => $this->id]); if ($svg->iconType === "\x6e\x6f\111\143\x6f\x6e") { goto NJ2wo; } $this->navArrowsSvg = $svg->pathOrSvg; goto WmOqg; NJ2wo: $this->navArrowsSvg = ''; WmOqg: $this->cache->set($cacheId, $this->navArrowsSvg, [\CACHING_GROUP_PLUGIN, self::CACHE_TAG_SLIDERS, Shop::get("\x6f\x70\154\x75\x67\151\x6e\x5f\141\x64\155\157\162\x72\151\x73\137\x70\162\x6f")?->getCache()->getGroup()]); } private function getNavBulletssSvg() { $cacheId = self::CACHE_ID_BULLETS_PREFIX . $this->id; if (!(($cachedSvg = $this->cache->get($cacheId)) !== false)) { goto BHr4E; } $this->navBulletsSvg = $cachedSvg; return; BHr4E: $svg = Shop::Container()->getDB()->getSingleObject("\12\x20\x20\x20\x20\40\40\40\40\x53\x45\x4c\105\x43\x54\40\x70\141\164\150\117\162\x53\x76\147\x2c\40\x69\x63\157\156\124\171\160\145\x20\12\40\x20\40\x20\40\40\40\40\x46\122\117\x4d\x20\170\x70\x6c\x75\x67\151\x6e\x5f\x61\x64\155\157\162\x72\151\x73\x5f\x70\162\157\x5f\x69\x63\x6f\x6e\x73\12\40\40\40\40\40\x20\x20\x20\111\x4e\116\x45\122\40\x4a\x4f\x49\116\x20\x78\160\x6c\165\x67\151\x6e\137\x61\x64\155\x6f\162\x72\x69\x73\137\160\x72\157\x5f\x73\x6c\x69\144\x65\162\xa\x20\x20\40\x20\40\40\x20\40\x4f\x4e\x20\170\x70\154\165\x67\x69\x6e\x5f\x61\144\155\157\162\162\x69\163\137\x70\162\157\137\163\x6c\151\x64\145\x72\x2e\156\x61\166\x42\165\154\154\x65\164\x73\111\x63\x6f\x6e\111\x64\x20\x3d\x20\x78\x70\154\165\x67\x69\x6e\x5f\x61\x64\155\157\162\162\x69\163\x5f\160\x72\x6f\x5f\x69\143\157\x6e\163\x2e\151\x63\157\156\111\x64\40\127\110\x45\x52\105\40\170\160\x6c\165\147\151\156\x5f\x61\x64\x6d\x6f\x72\162\x69\163\137\160\162\x6f\x5f\163\154\x69\x64\145\162\x2e\x69\x64\40\x3d\x20\x3a\151\x64", ["\151\144" => $this->id]); if ($svg->iconType === "\x6e\157\111\143\157\x6e") { goto VmZLB; } $this->navBulletsSvg = $svg->pathOrSvg; goto ekQsu; VmZLB: $this->navBulletsSvg = ''; ekQsu: $this->cache->set($cacheId, $this->navBulletsSvg, [\CACHING_GROUP_PLUGIN, self::CACHE_TAG_SLIDERS, Shop::get("\x6f\160\154\x75\x67\151\x6e\137\x61\144\x6d\157\x72\x72\x69\x73\137\x70\x72\157")?->getCache()->getGroup()]); } private function setResponsiveSlideArrrays() { foreach ($this->slide_arr as $slide) { if (!$slide->showOnDesktop) { goto FnyqH; } array_push($this->desktopSlides, $slide); FnyqH: if (!$slide->showOnMobile) { goto QRKC5; } array_push($this->mobileSlides, $slide); QRKC5: bM26L: } LqXi3: } private function shuffleSlidesArray($array) { $i = count($array) - 1; x7brD: if (!($i > 0)) { goto mUihZ; } $j = floor(rand(0, 1) * ($i + 1)); if (!($j >= count($array))) { goto mQVRA; } $j = count($array) - 1; mQVRA: if (!($array[$i] !== null && $array[$j] !== null)) { goto FRfOg; } [$array[$i], $array[$j]] = [$array[$j], $array[$i]]; FRfOg: tUwTr: $i--; goto x7brD; mUihZ: return $array; } }