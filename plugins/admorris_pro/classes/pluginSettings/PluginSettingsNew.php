<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\pluginSettings; use Plugin\admorris_pro\ioHandling\{AbstractIOClass, cookieNoticePro\CookieNoticePro}; use Exception; use JTL\Shop; use Plugin\admorris_pro\lib\AdmorrisLib; class PluginSettingsNew extends AbstractIOClass { use PluginSettingsTypesTrait; protected static $tableName = "\x74\x70\x6c\165\x67\x69\x6e\x65\151\156\163\164\x65\154\154\x75\156\x67\145\x6e"; public static function request($data, $requestType) { try { if (!is_string($data)) { goto fB8Ib; } return parent::request($data, $requestType); fB8Ib: $data = (object) $data; if (!(!empty($data) && !isset($data->cName))) { goto ahBK3; } foreach ($data as $key => $value) { $dataConverted = (object) ["\143\116\141\155\145" => self::addSettingsPrefix($key), "\143\x57\145\x72\164" => $value]; dXNzz: } ETeSS: ahBK3: return parent::request($dataConverted ?? $data, $requestType); } catch (Exception $e) { http_response_code(500); return json_encode(["\145\162\162\157\x72" => ["\x6d\x73\147" => "\x45\x72\162\157\162\x20\x69\156\x20" . get_called_class() . "\x20\143\141\x6c\154\151\156\147\40" . $requestType . "\73", "\144\145\x74\x61\151\x6c\163" => (string) $e]]); } } public static function getByName($settingName) { if (!(strpos($settingName, "\141\144\x6d\x6f\162\x72\151\163\x5f\160\x72\x6f\137") !== 0)) { goto GIYgw; } $settingNamePrefixed = "\x61\144\155\x6f\162\162\x69\x73\137\x70\x72\157\x5f" . $settingName; GIYgw: $data = Shop::Container()->getDB()->select(static::$tableName, "\143\x4e\141\x6d\145", $settingNamePrefixed ?? $settingName); if (!empty($data->cName)) { goto AJGgp; } throw new Exception("\x43\x6f\165\x6c\x64\x20\x6e\x6f\164\x20\154\x6f\x61\144\40" . $settingName . "\40\x66\x72\x6f\x6d\40" . static::$tableName); AJGgp: return [self::removeSettingsPrefix($data->cName) => self::castType($settingName, $data->cWert)]; } public static function create($data) { $data->kPlugin = AdmorrisLib::getPluginId(); if (!($data->cWert === true || $data->cWert === "\x59")) { goto Xhosp; } $data->cWert = "\131"; Xhosp: if (!($data->cWert === false || $data->cWert === "\x4e")) { goto M1HKs; } $data->cWert = "\x4e"; M1HKs: $newId = Shop::Container()->getDB()->insert(static::$tableName, $data); if ($newId > 0) { goto iSd2m; } throw new Exception("\x43\x6f\x75\x6c\144\x20\x6e\157\x74\x20\x69\x6e\163\145\162\x74\x20\151\156\x74\x6f\x20" . static::$tableName); goto RoNJu; iSd2m: $data->id = $newId; return $data; RoNJu: } public static function update($data) { $data->kPlugin = AdmorrisLib::getPluginId(); if ($data->cWert === true || $data->cWert === "\61" || $data->cWert === "\x59") { goto Q4UoK; } $data->cWert = "\116"; goto Cyusv; Q4UoK: $data->cWert = "\x59"; Cyusv: $update = Shop::Container()->getDB()->update(static::$tableName, "\143\x4e\141\x6d\x65", $data->cName, $data); if ($update === -1) { goto rBLD2; } $data = static::sanitizeCWert($data); self::pipeline($data->cName, $data->cWert); self::flushCache(); return $data; goto GtlvG; rBLD2: throw new Exception("\x43\157\165\154\x64\x20\156\x6f\164\x20\165\x70\x64\141\164\145\40" . $data->cName . "\40\151\156\x20" . static::$tableName); GtlvG: } public static function delete($data) { $toDelete = Shop::Container()->getDB()->delete(static::$tableName, "\143\116\x61\155\x65", $data->cName); if ($toDelete === -1) { goto M0L8I; } return $data; goto dw081; M0L8I: throw new Exception("\103\x6f\x75\x6c\x64\40\x6e\x6f\164\x20\144\145\x6c\145\x74\x65\40\151\x6e\40" . static::$tableName); dw081: } public static function sanitizeCWert($obj) { if (!($obj->cWert === "\x31" || $obj->cWert === "\x59")) { goto NhcFd; } $obj->cWert = true; NhcFd: if (!($obj->cWert === "\60" || $obj->cWert === "\116")) { goto yDKyZ; } $obj->cWert = false; yDKyZ: return $obj; } private static function pipeline($settingName, $settingValue) { $pipeline = ["\x61\x64\155\x6f\162\162\151\x73\137\160\x72\x6f\137\155\141\x72\x6b\145\x74\151\156\x67\x5f\143\157\x6f\153\x69\145\x5f\156\157\x74\x69\x63\x65\137\x70\162\x6f\137\x61\143\164\x69\x76\x65" => CookieNoticePro::class]; if (!array_key_exists($settingName, $pipeline)) { goto irfu9; } $pipeline[$settingName]::handlePluginSetting($settingValue); irfu9: } private static function removeSettingsPrefix($settingName) { return str_replace("\141\144\155\x6f\162\162\x69\x73\x5f\160\162\x6f\x5f", '', $settingName); } private static function addSettingsPrefix($settingName) { return "\141\x64\x6d\157\x72\x72\151\163\137\x70\x72\157\137" . $settingName; } private static function castType($name, $value) { if (!in_array($name, self::$convertBoolToString)) { goto z1krK; } return is_bool($value) ? boolToString($value) : stringToBool($value); z1krK: return $value; } private static function getPluginCacheId() { return Shop::get("\x6f\x70\154\x75\x67\x69\x6e\x5f\x61\x64\155\x6f\162\x72\151\x73\137\x70\x72\x6f")?->getCache()->getGroup(); } public static function flushCache() { Shop::Container()->getCache()->flushTags([self::getPluginCacheId()]); } } function stringToBool($value) { return $value === "\131" ? true : false; } function boolToString($value) { return $value === true ? "\x59" : "\x4e"; }