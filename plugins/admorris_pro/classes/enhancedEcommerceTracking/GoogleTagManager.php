<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\enhancedEcommerceTracking; use JTL\Shop; class GoogleTagManager extends GoogleAnalytics { const CONSENT_KEY = "\x61\144\x6d\x6f\x72\x72\151\163\55\x74\141\x67\55\155\x61\x6e\x61\x67\145\x72"; protected function getGeneralScript() : array { $result = []; $consentManager = Shop::Container()->getConsentManager(); $analyticsConsent = $consentManager->hasConsent(GoogleAnalytics::CONSENT_KEY); $analyticsConsentStatus = $analyticsConsent ? "\147\162\x61\156\164\145\x64" : "\144\145\x6e\151\145\x64"; $adsConsent = $consentManager->hasConsent(GoogleAds::CONSENT_KEY); $adsConsentStatus = $adsConsent ? "\x67\x72\x61\156\x74\x65\x64" : "\144\x65\x6e\151\x65\144"; $url = $this->getScriptUrl(); $generalScript = ''; $generalScript .= "\40\x20\x3c\163\143\x72\x69\160\x74\76\xa\40\40\x20\40\167\x69\156\x64\x6f\167\x2e\144\x61\x74\x61\114\141\171\145\x72\x20\x3d\40\167\151\156\x64\x6f\x77\x2e\x64\x61\x74\141\x4c\x61\x79\145\162\40\174\174\40\133\135\x3b\12\40\x20\x20\40\151\146\50\x74\171\x70\145\157\146\40\x67\x74\x61\x67\40\x21\x3d\x3d\40\47\146\x75\x6e\143\x74\151\x6f\156\x27\51\173\xa\40\x20\40\40\40\x20\146\165\156\x63\x74\151\x6f\x6e\x20\147\x74\141\x67\x28\51\x7b\40\x64\x61\164\141\x4c\141\x79\x65\162\56\x70\165\x73\150\50\x61\162\147\x75\x6d\x65\156\164\163\x29\73\40\x7d\73\xa\x20\40\x20\40\175\12\40\x20\74\57\163\143\162\x69\160\164\76"; $generalScript .= "\x20\40\x3c\41\55\x2d\x20\107\157\x6f\147\154\145\x20\x54\x61\x67\x20\x4d\141\x6e\x61\147\x65\x72\40\55\55\x3e\xa\x20\40\74\163\x63\162\x69\x70\164\40{$this->getScriptTagInner()}\x3e\50\146\165\156\143\164\x69\x6f\x6e\50\167\x2c\144\x2c\163\54\154\x2c\151\x29\173\x77\133\x6c\135\75\167\x5b\x6c\135\174\174\x5b\x5d\73\167\133\154\x5d\56\x70\165\163\150\50\x7b\47\147\x74\155\x2e\163\164\141\162\164\47\x3a\12\x20\x20\x6e\145\167\x20\104\141\x74\145\x28\x29\x2e\147\x65\x74\x54\151\155\145\50\x29\54\x65\x76\x65\x6e\164\72\47\147\x74\155\56\152\x73\47\x7d\x29\73\166\141\x72\x20\146\75\x64\56\147\x65\164\x45\x6c\145\155\x65\x6e\x74\x73\102\x79\x54\141\147\116\141\x6d\145\50\x73\51\133\60\135\x2c\xa\x20\40\x6a\x3d\144\56\x63\x72\x65\x61\x74\x65\x45\x6c\x65\155\145\x6e\164\50\x73\51\x2c\x64\154\75\154\x21\75\x27\144\141\x74\141\114\x61\x79\145\162\x27\x3f\x27\x26\154\x3d\x27\53\x6c\72\47\47\x3b\152\56\141\163\x79\156\143\x3d\164\162\x75\x65\x3b\152\x2e\163\x72\143\x3d\xa\40\40\47{$url}\57\147\x74\155\x2e\x6a\163\77\x69\x64\75\x27\53\151\53\144\154\x3b\146\x2e\160\141\162\x65\x6e\x74\x4e\x6f\144\145\56\x69\x6e\x73\x65\x72\x74\102\145\146\x6f\x72\145\x28\x6a\x2c\x66\51\x3b\12\40\40\175\51\50\167\151\156\x64\x6f\x77\54\x64\157\143\165\x6d\145\x6e\x74\x2c\x27\x73\143\162\x69\x70\164\x27\x2c\x27\x64\141\164\141\x4c\141\x79\x65\162\47\54\47{$this->getID()}\47\x29\73\xa\x20\x20\74\57\163\143\x72\x69\160\x74\76\12\x20\x20\x3c\x21\55\x2d\40\x45\x6e\x64\x20\x47\157\x6f\147\154\x65\40\124\141\147\40\115\x61\x6e\x61\147\145\162\40\55\55\76"; array_push($result, $this->wrapScript("\x68\145\141\144", "\160\x72\145\x70\145\156\144", $generalScript)); if (!$this->activateScripts()) { goto ws1RL; } $nojsScript = "\74\x21\x2d\55\x20\x47\x6f\x6f\x67\x6c\145\x20\x54\x61\x67\x20\115\141\156\141\147\x65\x72\x20\50\156\157\x73\143\x72\151\160\164\x29\40\55\x2d\76\12\40\x20\40\40\x20\40\40\40\x3c\156\157\x73\x63\162\x69\x70\x74\76\74\x69\x66\162\141\155\145\40\x73\162\143\x3d\x22{$url}\x2f\156\x73\56\x68\164\x6d\154\77\151\x64\x3d{$this->getID()}\x22\12\40\40\40\40\x20\40\40\x20\x68\x65\151\147\150\164\75\x22\x30\x22\x20\167\151\x64\164\x68\x3d\42\x30\x22\40\x73\x74\171\154\145\x3d\42\144\151\x73\x70\x6c\x61\x79\x3a\156\157\x6e\x65\73\166\151\x73\151\142\151\x6c\x69\x74\171\x3a\150\151\x64\144\x65\156\42\x3e\74\x2f\151\x66\x72\x61\155\x65\76\74\57\x6e\x6f\x73\143\162\151\x70\x74\76\12\40\x20\x20\x20\x20\40\x20\40\x3c\41\x2d\x2d\40\x45\x6e\144\x20\x47\x6f\x6f\147\154\145\40\124\141\x67\x20\115\x61\156\x61\x67\x65\162\40\x28\156\157\x73\x63\162\151\x70\164\x29\x20\55\55\76"; array_push($result, $this->wrapScript("\142\157\x64\x79", "\x70\162\145\x70\x65\x6e\144", $nojsScript)); ws1RL: return $result; } }