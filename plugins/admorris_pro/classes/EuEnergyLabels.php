<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Shop; use JTL\Catalog\Product\Artikel; use JTL\Events\Dispatcher; use JTL\Plugin\PluginInterface; use JTL\Smarty\JTLSmarty; use Plugin\admorris_pro\controller\AbstractHookController; use Smarty; class EuEnergyLabels extends AbstractHookController { use SettingsTrait; public bool $show_detail; public bool $show_list; public string $list_position; public bool $show_slider; private $view; protected string $configKey = "\x61\x64\155\x6f\162\162\151\x73\137\160\x72\x6f\x5f\155\x61\162\x6b\145\164\151\156\147\x5f\x65\165\137\x6c\x61\142\145\x6c\163\137\141\x63\x74\151\x76\x65"; const ATTRIBUTE_LABEL = "\x61\144\x6d\157\x72\162\x69\163\x5f\x70\162\x6f\137\x65\x75\x5f\x65\x6e\x65\x72\x67\171\x5f\x6c\141\142\145\x6c"; const ATTRIBUTE_DATA_SHEET = "\x61\144\x6d\x6f\162\x72\151\x73\x5f\160\162\x6f\x5f\x65\x75\x5f\145\x6e\x65\x72\147\171\x5f\x6c\x61\142\x65\154\x5f\x64\141\164\141\137\163\150\145\145\x74"; const ATTRIBUTE_IMAGE = "\141\144\x6d\x6f\162\162\x69\x73\x5f\160\x72\157\137\145\165\137\145\x6e\x65\162\x67\x79\137\x6c\x61\x62\145\154\x5f\151\x6d\x61\147\x65"; function __construct(PluginInterface $plugin, Dispatcher $dispatcher, StatusRequest $statusRequest) { parent::__construct($plugin, $dispatcher, $statusRequest); } protected function init() : void { $this->mapSettings = ["\x73\150\157\x77\x5f\144\x65\164\141\x69\x6c", "\163\150\x6f\167\137\154\151\x73\x74", "\x6c\151\163\x74\137\x70\x6f\163\151\x74\x69\x6f\156", "\163\x68\157\167\137\163\154\151\x64\x65\162"]; $this->settingPrefix = "\x6d\141\162\153\145\x74\x69\156\x67\x5f\x65\x75\137\154\141\x62\x65\154\x73"; $this->initSettings(); $this->dispatcher->hookInto(\HOOK_LETZTERINCLUDE_INC, $this->lastInclude(...)); $this->dispatcher->hookInto(\HOOK_SMARTY_OUTPUTFILTER, $this->smartyOutputFilter(...), 10); } private function lastInclude() { Shop::Smarty()->assign("\145\165\105\x6e\145\x72\x67\x79\x4c\x61\142\145\154\163", $this); } private function smartyOutputFilter() { $smarty = Shop::Smarty(); $smarty->assign("\x65\x75\x5f\154\141\x62\x65\x6c\163\x5f\x6c\x69\163\x74\x5f\160\x6f\163\x69\x74\x69\x6f\156", $this->list_position); if (!(Shop::getPageType() === PAGE_ARTIKEL && $this->show_detail == "\131")) { goto tVTgd; } $this->displayInDetailView(); tVTgd: if (!(\pq("\56\x65\165\x2d\145\x6e\145\162\x67\x79\x2d\154\x61\142\x65\154")->length > 0)) { goto CVcUn; } $this->loadStyles(); CVcUn: } private function displayInDetailView() { $smarty = Shop::Smarty(); $article = $smarty->getTemplateVars("\x41\x72\164\x69\x6b\x65\x6c"); $functionAttr = $article->getFunctionalAttributevalue(self::ATTRIBUTE_LABEL); if (!empty($functionAttr)) { goto xH3BI; } return; xH3BI: $template = $this->plugin->getPaths()->getFrontendPath() . "\x74\x65\155\160\x6c\x61\164\145\163\57\x6d\141\x72\153\x65\x74\x69\156\147\x5f\145\x75\x5f\145\156\x65\162\x67\171\137\x6c\x61\x62\145\x6c\163\57\x64\x65\164\141\151\154\x2e\164\160\x6c"; $content = $smarty->fetch($template); $this->cssSelector("\144\145\x74\x61\x69\154", $content); } private function loadStyles() { $version = $this->plugin->getMeta()->getVersion(); $styles = "\x3c\x6c\151\x6e\153\40\x72\145\154\x3d\42\x73\x74\x79\x6c\145\x73\150\x65\145\164\42\x20\x68\162\145\x66\x3d\x22" . $this->plugin->getPaths()->getFrontendURL() . "\x63\163\163\57\x65\165\x2d\145\x6e\x65\162\147\171\55\154\x61\142\x65\154\163\x2e\143\163\163\77\166\75" . $version . "\42\x3e"; $ShopURL = Shop::getURL(); $modalOpenScript = "\74\x73\143\x72\151\160\164\x20\164\171\160\x65\x3d\x22\x6d\x6f\144\x75\154\145\x22\x3e\xa\x20\x20\40\x20\x20\x20\x77\x69\156\144\x6f\x77\x2e\157\x70\x65\x6e\x45\x75\105\x6e\145\162\147\x79\114\141\x62\x65\154\115\157\144\x61\x6c\x20\75\x20\x28\x69\x6d\141\147\145\137\x75\x72\x6c\54\x20\x61\154\x74\137\164\145\170\x74\x20\75\40\47\47\51\x20\x3d\76\x20\173\12\x20\x20\x20\x20\x20\x20\40\40\x20\40\40\x20\143\x6f\156\163\x74\x20\x6d\145\163\163\141\147\145\40\75\x20\x60\74\151\155\x67\40\x63\x6c\141\163\163\75\x22\151\x6d\147\55\x72\145\163\160\x6f\x6e\163\x69\x76\145\42\x20\x73\x72\143\x3d\42{$ShopURL}\x2f\x6d\145\x64\151\x61\57\x69\155\141\x67\x65\57\163\164\x6f\x72\141\147\x65\57\x6f\160\x63\57\x65\x6e\x65\162\x67\x79\137\154\x61\x62\145\154\x73\57\154\x61\x62\x65\154\163\x2f\44\x7b\151\x6d\x61\147\145\137\x75\x72\x6c\x7d\42\x20\x61\x6c\x74\x3d\x22\44\173\x61\154\x74\x5f\164\145\170\164\x7d\42\57\x3e\140\73\12\40\40\x20\x20\40\40\40\x20\40\x20\x65\115\x6f\x64\x61\154\x2e\141\x6c\145\x72\x74\x28\x7b\12\40\x20\x20\40\x20\x20\x20\40\40\x20\x20\40\40\x20\x6d\145\x73\163\x61\147\145\x3a\x20\x6d\x65\x73\163\141\x67\x65\54\xa\x20\40\x20\x20\40\x20\x20\x20\40\40\40\40\x20\40\164\x69\x74\154\x65\72\x20\47\x20\47\x2c\12\40\x20\40\x20\40\40\40\x20\40\x20\x20\x20\40\40\x62\x75\x74\x74\x6f\x6e\163\x3a\40\133\135\xa\x20\40\x20\40\x20\40\x20\x20\x20\40\x7d\x29\x3b\12\40\x20\x20\x20\40\x20\175\12\40\40\74\57\163\143\162\x69\160\x74\x3e"; pq("\150\145\x61\144")->append($styles . $modalOpenScript); } public function getEnergyScaleAndValue($functionAttr) { goto P3gsX; pWCNi: $valuePluses = substr($value, 1, $valueStringLength - 1); $value = [$valueOnlyLetter, $valuePluses]; zBlGD: $returnArr = ["\x73\143\141\154\145\123\164\141\162\164\103\157\155\160\154\x65\x74\x65" => $scaleStartComplete, "\x73\143\141\154\145\x53\x74\141\x72\164" => $scaleStart, "\163\x63\141\154\145\105\156\144" => $scaleEnd, "\x76\141\x6c\165\x65\103\157\155\160\x6c\145\164\x65" => $valueComplete, "\x76\x61\x6c\165\145" => $value]; return $returnArr; OKS_4: goto z8EYy; P3gsX: if (!empty($functionAttr)) { goto Q9Wxh; } $returnArr = ["\166\141\154\165\x65" => "\x4e\x6f\164\x20\146\157\165\x6e\144"]; return $returnArr; goto OKS_4; Q9Wxh: $splitArr = explode("\40", $functionAttr); $scaleStringLength = strlen($splitArr[0]); $scaleStart = substr($splitArr[0], 0, $scaleStringLength - 1); $scaleStartComplete = $scaleStart; if (!(strlen($scaleStart) > 1)) { goto brO3L; } goto Nha0U; Nha0U: $scaleStartOnlyLetter = substr($scaleStart, 0, 1); $scaleStartPluses = substr($scaleStart, 1, $scaleStringLength - 1); $scaleStart = [$scaleStartOnlyLetter, $scaleStartPluses]; brO3L: $scaleEnd = substr($splitArr[0], $scaleStringLength - 1, $scaleStringLength); $valueStringLength = strlen($splitArr[1]); $value = $splitArr[1]; $valueComplete = $value; if (!($valueStringLength > 1)) { goto zBlGD; } $valueOnlyLetter = substr($value, 0, 1); goto pWCNi; z8EYy: } public function getEnergyBgFromScaleAndValue($scaleAndValueArr) { goto rLShq; SSD5g: $keyOfValueInScale = array_search($scaleAndValueArr["\166\x61\154\x75\145\103\x6f\x6d\x70\x6c\x65\164\x65"], $aPlusFArr); return $keyOfValueInScale; goto qfRdY; thcaz: $keyOfValueInScale = array_search($scaleAndValueArr["\166\x61\154\x75\x65\x43\157\x6d\160\154\145\164\x65"], $aPlusPlusEArr); return $keyOfValueInScale; qfRdY: IwtV7: goto lhyeX; rLShq: $bgColorsArr = ["\x23\x30\x30\x61\x36\65\x32", "\x23\65\61\142\x37\64\67", "\x23\x62\144\144\x36\63\60", "\x23\x66\x65\x66\62\x30\x30", "\x23\146\x64\142\x38\x31\x33", "\43\x65\x64\x31\x62\x32\x34"]; $aGArr = ["\x61", "\142", "\143", "\x64", "\x65", "\146", "\x67"]; $aPlusFArr = ["\x61\x2b", "\141", "\142", "\143", "\144", "\145", "\x66"]; $aPlusPlusEArr = ["\141\53\53", "\141\53", "\x61", "\x62", "\x63", "\x64", "\x65"]; $aPlusPlusPlusDArr = ["\x61\53\53\x2b", "\x61\x2b\x2b", "\x61\x2b", "\x61", "\x62", "\143", "\x64"]; if ($scaleAndValueArr["\166\x61\x6c\x75\x65"] != "\116\157\164\x20\106\x6f\x75\156\144") { goto wEP_f; } return "\43\145\x64\61\x62\62\x34"; goto IwtV7; wEP_f: if ($scaleAndValueArr["\x73\143\141\154\145\x53\x74\141\162\x74\103\157\155\x70\x6c\145\164\145"] == "\141") { goto E2YwU; } goto jrpKT; jrpKT: if ($scaleAndValueArr["\163\143\141\154\x65\x53\x74\141\162\x74\103\157\x6d\160\x6c\x65\164\145"] == "\141\x2b") { goto V69pi; } if ($scaleAndValueArr["\163\x63\x61\x6c\x65\x53\164\141\x72\164\x43\157\155\160\154\145\x74\145"] == "\141\53\53") { goto thcaz; } $keyOfValueInScale = array_search($scaleAndValueArr["\x76\141\x6c\165\x65\x43\157\x6d\160\x6c\x65\x74\145"], $aPlusPlusPlusDArr); return $keyOfValueInScale; goto qfRdY; E2YwU: $keyOfValueInScale = array_search($scaleAndValueArr["\x76\x61\x6c\165\145\103\157\x6d\x70\x6c\x65\x74\x65"], $aGArr); return $keyOfValueInScale; goto qfRdY; V69pi: goto SSD5g; lhyeX: } }