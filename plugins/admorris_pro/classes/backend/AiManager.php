<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\backend; use JTL\DB\ReturnType; use JTL\Shop; use JTL\IO\IOError; use Plugin\admorris_pro\Utils\TypeConverter; use Plugin\admorris_pro\ioHandling\IoRequestTrait; use Plugin\admorris_pro\AmSlider; use JTL\Language\LanguageHelper; class AiManager { use IoRequestTrait; public function uploadFiles($data) { goto Ud2Bo; Ud2Bo: if (!($_FILES == null || count($_FILES) == 0)) { goto qkgIN; } return; qkgIN: $path = ''; if (!isset($data[0]["\160\x61\x74\150"])) { goto Jxij9; } $path = $data[0]["\160\x61\164\x68"]; Jxij9: $uploadDir = PFAD_ROOT . $this->getUploadDirectory($path); $urls = []; $errors = []; goto rEshZ; rEshZ: if (is_dir($uploadDir)) { goto CxCTN; } if (mkdir($uploadDir, 0755, true)) { goto bhlHZ; } return ["\145\162\162\x6f\162" => "\106\x61\151\x6c\x65\x64\x20\x74\x6f\x20\x63\162\x65\x61\164\x65\40\165\160\x6c\x6f\141\144\40\144\151\x72\145\x63\164\x6f\x72\x79"]; bhlHZ: CxCTN: foreach ($_FILES as $file) { if (!(!isset($file["\164\x6d\x70\137\x6e\x61\155\145"]) || !isset($file["\x6e\141\x6d\x65"]) || empty($file["\x74\155\160\137\x6e\141\x6d\x65"]))) { goto FsUBD; } goto EVlNI; FsUBD: $filename = $this->sanitizeFilename($file["\x6e\141\155\x65"]); $targetPath = $uploadDir . $filename; if (move_uploaded_file($file["\x74\x6d\160\x5f\156\x61\x6d\x65"], $targetPath)) { goto yYBjF; } $errors[] = "\x46\x61\x69\154\145\144\x20\x74\x6f\x20\165\x70\154\x6f\x61\144\40{$file["\x6e\141\155\x65"]}"; goto sE2Xy; yYBjF: $urls[] = Shop::getURL() . "\57" . $this->getUploadDirectory($path) . $filename; sE2Xy: EVlNI: } cn9a4: if (!(empty($urls) && !empty($errors))) { goto CTclK; } return ["\145\162\x72\157\162" => implode("\54\x20", $errors)]; CTclK: goto pJQgj; pJQgj: return ["\x73\164\x61\x74\x75\x73" => "\x73\165\143\x63\145\163\x73", "\165\x72\154\x73" => $urls, "\x6d\145\x73\163\141\x67\145" => count($urls) . "\40\x66\151\154\145\50\163\x29\40\x75\160\x6c\x6f\x61\144\x65\144\x20\x73\x75\143\143\145\163\x73\x66\165\x6c\x6c\x79"]; goto A8iz_; A8iz_: } private function getUploadDirectory($path) { $basePath = STORAGE_OPC; if (empty($path)) { goto oUDWD; } return $basePath . $path . "\x2f"; oUDWD: return $basePath; } private function sanitizeFilename($filename) { $filename = basename($filename); $filename = preg_replace("\57\x5b\136\134\167\x5c\x2e\55\x5d\57", "\x5f", $filename); $pathInfo = pathinfo($filename); $extension = isset($pathInfo["\x65\170\x74\x65\x6e\x73\x69\x6f\156"]) ? "\56" . $pathInfo["\145\x78\x74\145\156\x73\151\x6f\x6e"] : ''; $basename = $pathInfo["\x66\x69\154\145\156\x61\x6d\x65"]; return $basename . "\x5f" . time() . $extension; } public function deleteAISlider($data) { $aiSlider = Shop::Container()->getDB()->select("\x78\160\154\165\x67\151\x6e\x5f\141\x64\155\x6f\x72\162\151\163\x5f\x70\162\x6f\137\x73\x6c\x69\144\x65\162", "\x6e\141\x6d\145", $data["\156\x61\x6d\145"]); $id = (int) $aiSlider->id; if ($id > 0) { goto Aok7c; } return ["\155\145\x73\163\141\x67\145" => "\x73\x6c\151\144\145\x72\x20\156\x6f\x74\40\x66\x6f\165\156\x64"]; goto dd6b7; Aok7c: $oSlider = new AmSlider(); $oSlider->load($id); $bSuccess = $oSlider->delete($id); if ($bSuccess) { goto AkASg; } return ["\145\x72\x72\157\x72" => "\145\162\162\157\x72"]; goto ZbPtJ; AkASg: return ["\x6d\145\x73\x73\141\147\145" => "\163\x6c\x69\x64\145\x72\x20\144\x65\154\x65\164\145\144"]; ZbPtJ: dd6b7: } public function setLanguageVariables($data) { if (!(!isset($data["\x6c\x61\x6e\x67\126\x61\162\163"]) || !is_array($data["\154\x61\156\x67\126\x61\162\163"]))) { goto s49Lh; } return ["\x65\162\162\x6f\x72" => "\x49\156\166\141\154\x69\x64\40\x6c\x61\156\x67\165\141\147\145\x20\x76\x61\x72\x69\141\142\154\145\x73\x20\x64\x61\x74\x61"]; s49Lh: $results = []; $languageHelper = new LanguageHelper(); foreach ($data["\154\x61\x6e\x67\126\141\162\163"] as $langVar) { if (!(!isset($langVar["\163\x65\x63\x74\x69\157\156"]) || !isset($langVar["\153\x65\171"]) || !isset($langVar["\166\141\154\x75\x65"]) || !isset($langVar["\x6c\141\x6e\x67"]))) { goto hO52n; } $results[] = ["\145\x72\x72\157\162" => "\x4d\151\163\163\151\x6e\147\x20\162\x65\x71\165\151\x72\x65\144\40\160\141\162\x61\155\x65\x74\145\162\163\x20\x66\157\162\40\154\141\156\x67\165\x61\x67\x65\40\166\x61\162\x69\141\x62\x6c\x65"]; goto DfJNn; hO52n: $languageHelper->setzeSprache($langVar["\154\x61\156\x67"]); $result = $languageHelper->setzeWert($langVar["\x73\145\x63\x74\x69\157\x6e"], $langVar["\x6b\x65\x79"], $langVar["\x76\x61\154\165\145"]); $results[] = ["\x73\x65\143\164\151\x6f\x6e" => $langVar["\x73\x65\143\x74\x69\157\156"], "\153\x65\x79" => $langVar["\153\145\x79"], "\154\141\x6e\x67" => $langVar["\154\x61\x6e\147"], "\162\145\163\x75\154\x74" => $result]; DfJNn: } XL0e6: return ["\163\x74\141\164\165\x73" => "\163\165\143\143\145\x73\163", "\155\145\163\x73\x61\147\145" => count($results) . "\40\x6c\141\156\147\165\x61\x67\145\x20\166\x61\162\x69\x61\142\x6c\x65\163\40\x70\x72\157\x63\145\163\163\145\x64", "\162\145\x73\165\x6c\164\163" => $results]; } }