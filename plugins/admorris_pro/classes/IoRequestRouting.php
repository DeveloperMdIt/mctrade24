<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Shop; use JTL\IO\IO; use JTL\IO\IOError; use JTL\Helpers\{Form, Request}; use Plugin\admorris_pro\requestHandlers\{LangVars, AsyncJsConfig, PluginSettingsHandler}; class IoRequestRouting { public static function direct($reqString) { goto v2xJ3; pt6Xn: header("\x43\157\x6e\x74\145\x6e\x74\55\x74\x79\160\x65\x3a\x20\x61\160\x70\154\x69\x63\141\x74\151\157\x6e\57\152\x73\x6f\156"); echo json_encode($response); die; goto uy9Ya; v2xJ3: if (isset($_REQUEST["\x69\x6f"])) { goto eDK2d; } header(Request::makeHTTPHeader(400)); exit; eDK2d: if (Shop::Container()->getAdminAccount()->logged()) { goto Dno7a; } header(Request::makeHTTPHeader(401)); exit; Dno7a: if (Form::validateToken()) { goto K4udw; } $io = IO::getInstance(); goto sbgjO; sbgjO: $io->respondAndExit(new IOError("\x43\x53\x52\106\x20\x76\141\154\x69\x64\141\164\x69\x6f\x6e\x20\x66\141\151\x6c\145\x64\x2e", 500)); K4udw: $request = json_decode($reqString, true); if (!(($errno = json_last_error()) != JSON_ERROR_NONE)) { goto aEYa4; } return new IOError("\105\162\x72\157\x72\40{$errno}\x20\167\x68\151\x6c\x65\40\144\145\x63\157\144\x69\x6e\x67\40\x64\141\x74\141"); aEYa4: if (isset($request["\156\141\155\145"])) { goto B6zMX; } return new IOError("\x72\145\161\x75\145\163\164\40\x6e\141\155\145\x20\x75\156\x64\x65\x66\151\x6e\145\144"); B6zMX: $response = self::callAction($request, $request["\156\141\x6d\145"], $request["\155\x65\164\x68\x6f\x64"]); goto pt6Xn; uy9Ya: } protected static function callAction($request, $controller, $action) { $controller = "\x50\x6c\165\147\x69\156\x5c\x61\144\x6d\157\162\162\x69\x73\x5f\x70\162\157\134\162\145\x71\165\145\163\164\110\141\156\144\x6c\145\x72\163\x5c{$controller}"; $controller = new $controller(); if (method_exists($controller, $action)) { goto EhmDE; } throw new \Exception("{$controller}\40\144\157\x65\x73\x20\x6e\157\x74\x20\x72\145\163\160\x6f\156\144\40\164\157\x20\x74\x68\145\x20{$action}\40\x61\143\164\x69\x6f\x6e\x2e"); EhmDE: try { return $controller->{$action}($request["\x64\x61\164\141"]); } catch (\Exception $error) { return json_encode($error); } } }