<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\Utils; use JTL\Shop; use stdClass; class TypeConverter { public static function encode_with_specialchars($string) { return htmlspecialchars($string, ENT_COMPAT | ENT_HTML5, "\x55\124\106\x2d\x38", false); } public static function encode_entities($string) { return htmlspecialchars_decode(htmlentities($string, ENT_COMPAT, "\x55\x54\106\x2d\x38", false), ENT_COMPAT); } public static function convertStringToBool($value) { return $value === "\x59" ? true : false; } public static function convertBoolToString($value) { return $value === true ? "\131" : "\116"; } public static function convertIntegerToBool($value) { return $value == 1 ? true : false; } public static function convertBoolToInteger($value) { return $value === true ? 1 : 0; } public static function getSpecialCharFn($decode) { return function ($text) use($decode) { return $decode ? htmlspecialchars_decode($text) : self::encode_with_specialchars($text); }; } public static function getBoolStringConversionFn($decode) { return function ($val) use($decode) { return $decode ? self::convertBoolToString($val) : self::convertStringToBool($val); }; } public static function dateTimeStringToIso($date) { $dateObj = new \DateTime($date); return $dateObj->format("\143"); } public static function setTypes($settings, $types, $convertBoolString = null, $convertSpecialchars = null, $decode = null) { $toArray = false; if (!is_array($settings)) { goto AQUwZ; } $toArray = true; $settings = (object) $settings; AQUwZ: $specialchars_encode_decode = function ($text) use($decode) { return $decode ? htmlspecialchars_decode($text) : self::encode_with_specialchars($text); }; $bool_convert = function ($val) use($decode) { return $decode ? self::convertBoolToString($val) : self::convertStringToBool($val); }; $doConversion = function ($type, $func) use(&$settings, $specialchars_encode_decode, $bool_convert) { if (empty($type)) { goto robYi; } foreach ($type as $key => $value) { if (is_array($value)) { goto EkKIV; } if (isset($settings->{$value})) { goto fLhhA; } goto LGJaS; fLhhA: $settings->{$value} = $func($settings->{$value}, $key); goto dG0Bt; EkKIV: foreach ($type[$key] as $subkey => $subvalue) { if (!isset($settings->{$key}[$subvalue])) { goto KgJiK; } $settings->{$key}[$subvalue] = $func($settings->{$key}[$subvalue], $subkey); KgJiK: m2Rz3: } Jvvci: dG0Bt: LGJaS: } tdiyh: robYi: }; if (empty($types)) { goto nKxQO; } foreach ($types as $key => $value) { if (!isset($settings->{$key})) { goto eXtzV; } settype($settings->{$key}, $value); eXtzV: RQkGS: } AGMDp: nKxQO: $doConversion($convertSpecialchars, function ($value) use($specialchars_encode_decode) { return $specialchars_encode_decode($value); }); $doConversion($convertBoolString, function ($value) use($bool_convert) { return $bool_convert($value); }); if (!$toArray) { goto RwF1C; } return (array) $settings; RwF1C: return $settings; } }