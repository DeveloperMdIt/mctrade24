<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\Utils; final class Html { protected $reachedLimit = false, $totalLen = 0, $maxLen = 25, $toRemove = []; public static function trim(?string $html, int $maxLen = 25) : string { if (!empty($html)) { goto URsS_; } return ''; URsS_: $dom = new \DomDocument(); $dom->loadHTML("\74\x3f\170\155\154\x20\x65\156\x63\157\144\x69\156\x67\x3d\42\125\124\x46\x2d\x38\x22\x3e" . $html, LIBXML_HTML_NOIMPLIED | LIBXML_HTML_NODEFDTD); foreach ($dom->childNodes as $item) { if (!($item->nodeType == XML_PI_NODE)) { goto hCx86; } $dom->removeChild($item); hCx86: H9emi: } GEX3_: $dom->encoding = "\125\124\x46\55\x38"; $instance = new self(); $toRemove = $instance->walk($dom, $maxLen); foreach ($toRemove as $child) { $child->parentNode->removeChild($child); h8COT: } Ud6VJ: return $dom->saveHTML(); } protected function walk(\DomNode $node, $maxLen) { if ($this->reachedLimit) { goto rKM2L; } if (!$node instanceof \DomText) { goto la2fE; } $this->totalLen += $nodeLen = strlen($node->nodeValue); if (!($this->totalLen > $maxLen)) { goto rP8TB; } $node->nodeValue = substr($node->nodeValue, 0, $nodeLen - ($this->totalLen - $maxLen)) . "\x2e\56\x2e"; $this->reachedLimit = true; rP8TB: la2fE: if (!isset($node->childNodes)) { goto kjVYU; } foreach ($node->childNodes as $child) { $this->walk($child, $maxLen); rU34Y: } Kol7f: kjVYU: goto T9vsY; rKM2L: $this->toRemove[] = $node; T9vsY: return $this->toRemove; } }