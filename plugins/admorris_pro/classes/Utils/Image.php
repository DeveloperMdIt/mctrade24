<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\Utils; use JTL\Media\Image as MediaImage; use JTL\Media\Image\Product; use JTL\Shop; use stdClass; class Image { public static function getOPCImageSrcSet($path) { goto TZuf9; raCET: usort($fileList->default, function ($a, $b) { return $a->width <=> $b->width; }); if (!empty($fileList->default)) { goto GHdW3; } $fileList->default = $fileList->webp; GHdW3: return $fileList; goto YOr6n; mGYgP: list($width, $height) = \getimagesize($fullPath); $origin->width = $width; $origin->height = $height; if (pathinfo($path, \PATHINFO_EXTENSION) === "\x77\145\142\160") { goto ud4W9; } array_push($fileList->default, $origin); goto hyY9H; ud4W9: array_push($fileList->webp, $origin); hyY9H: usort($fileList->webp, function ($a, $b) { return $a->width <=> $b->width; }); goto raCET; TZuf9: if (!empty($path)) { goto b6HmE; } return; b6HmE: $path = urldecode($path); $fileName = pathinfo($path, \PATHINFO_FILENAME); $dir = pathinfo($path, \PATHINFO_DIRNAME); if (!($dir[0] === "\57")) { goto IrUWj; } $dir = substr($dir, 1); IrUWj: if ($dir . "\x2f" === \STORAGE_OPC) { goto Bz4ux; } goto daHrK; daHrK: $subDir = str_replace(\STORAGE_OPC, '', $dir); $glob = glob(\PFAD_ROOT . \STORAGE_OPC . "\x2e\x73\162\x63\x73\145\x74\163\57" . $subDir . "\x2f" . preg_quote($fileName, "\x2f") . "\x2a"); goto XZbmU; Bz4ux: $glob = glob(\PFAD_ROOT . \STORAGE_OPC . "\x2e\163\x72\143\163\x65\x74\x73\57" . preg_quote($fileName, "\57") . "\52"); XZbmU: $fileList = new stdClass(); $fileList->webp = []; $fileList->default = []; foreach ($glob as $file) { if (!(preg_match("\57" . preg_quote($fileName, "\57") . "\x2d\133\x30\55\71\135\173\62\x2c\x34\175\x78\x5b\60\55\x39\135\173\62\x2c\64\175\56\134\167\x2b\57", $file) === 1)) { goto sfUYZ; } if (file_exists($file)) { goto lhyYF; } goto O6vd7; lhyYF: $absolute = str_replace(\PFAD_ROOT, '', $file); $obj = new stdClass(); $obj->path = Shop::getUrl() . "\x2f" . $absolute; list($width, $height) = \getimagesize($file); $obj->width = $width; $obj->height = $height; if (pathinfo($file, \PATHINFO_EXTENSION) === "\x77\145\142\x70") { goto KkAsc; } array_push($fileList->default, $obj); goto FkE1E; KkAsc: array_push($fileList->webp, $obj); FkE1E: sfUYZ: O6vd7: } goto AFrS_; AFrS_: Xr0HX: if (!(strpos($path, "\x2f") === 0)) { goto s14qr; } $path = substr($path, 1); s14qr: $fullPath = \PFAD_ROOT . $path; $origin = new stdClass(); $origin->path = Shop::getUrl() . "\x2f" . $path; if (file_exists($fullPath)) { goto O3EDY; } throw new \Exception("\x46\x69\x6c\145\x20\x6e\x6f\164\40\x66\157\165\156\x64\72\x20" . $fullPath); O3EDY: goto mGYgP; YOr6n: } public static function getOPCImageSrcSetString($srcSet, $scaling = 0) { $output = null; $scaled = null; foreach ($srcSet as $file) { $scaled = ceil($file->width * (1 - $scaling)); if (is_null($output)) { goto SYJX9; } $output .= "\x2c\x20"; SYJX9: if (empty($file->path)) { goto Ouz66; } $output .= $file->path . "\40" . $scaled . "\167"; Ouz66: RczKL: } xSU6d: return $output; } public static function imageSizeFromSrcset($srcsetAttr) { $sizeSets = explode("\x2c", $srcsetAttr); $sizeSets = array_reverse($sizeSets); foreach ($sizeSets as $item) { $imgUrl = explode("\40", trim($item))[0]; $size = self::imageSize($imgUrl); if (empty($size)) { goto J7oP0; } return $size; J7oP0: RqNn9: } VBq6b: } public static function imageSize($imageUrl) { goto tZzVG; KytY3: $xmlattributes = $xmlget->attributes(); if (!empty($xmlattributes->width)) { goto F5TR3; } if (!empty($xmlattributes->viewBox)) { goto hhfMm; } return false; goto SjyfU; hhfMm: $vbox = explode("\40", (string) $xmlattributes->viewBox); $width = $vbox[2]; $height = $vbox[3]; SjyfU: goto hJmeH; hJmeH: goto mH0y5; F5TR3: $width = str_replace("\160\x78", '', (string) $xmlattributes->width); $height = str_replace("\x70\x78", '', (string) $xmlattributes->height); mH0y5: vVsRK: $size = new \StdClass(); $size->width = $width; $size->height = $height; return $size; goto I70vw; Nh0rm: return null; R8GL7: $settings = MediaImage::getSettings(); $refImage = $req->getRaw(); if (!($refImage === null)) { goto Y23_K; } return null; Y23_K: list($width, $height, $type, $attr) = \getimagesize($refImage); $size = $settings["\x73\151\172\x65"][$req->getSizeType()]; $max_width = $size["\167\151\144\164\x68"]; goto UqWhf; tZzVG: $imagePath = \PFAD_ROOT . str_replace(Shop::getURL() . "\x2f", '', $imageUrl); if (!is_file($imagePath)) { goto DBkr8; } if (pathinfo($imagePath, \PATHINFO_EXTENSION) === "\163\166\147") { goto XiSc9; } list($width, $height) = \getimagesize($imagePath); goto vVsRK; DBkr8: $imageUrl = str_replace(Shop::getURL() . "\x2f", '', $imageUrl); $path = mb_strpos($imageUrl, \PFAD_BILDER) === 0 ? \PFAD_ROOT . $imageUrl : $imageUrl; $req = Product::toRequest($path); if (is_object($req)) { goto R8GL7; } goto Nh0rm; UqWhf: $max_height = $size["\x68\145\x69\x67\x68\164"]; $old_width = $width; $old_height = $height; $scale = min($max_width / $old_width, $max_height / $old_height); $width = ceil($scale * $old_width); $height = ceil($scale * $old_height); goto vVsRK; XiSc9: $svg = file_get_contents($imagePath); $xmlget = simplexml_load_string($svg); goto KytY3; I70vw: } public static function base64_encode_image($imageUrl) { if (!MediaImage::hasWebPSupport()) { goto wykZ5; } $imageUrl = preg_replace("\x2f\134\56\x28\77\151\51\50\x6a\160\147\x7c\160\x6e\x67\51\x2f", "\56\167\145\142\x70", $imageUrl); wykZ5: $imagePath = PFAD_ROOT . str_replace(Shop::getURL() . "\57", '', $imageUrl); if (file_exists($imagePath)) { goto uw_Lb; } return; uw_Lb: $ext = pathinfo($imagePath, \PATHINFO_EXTENSION); $im = file_get_contents($imagePath); return "\x64\x61\164\x61\72\151\x6d\141\147\x65\57{$ext}\73\142\x61\163\145\x36\x34\x2c" . base64_encode($im); } }