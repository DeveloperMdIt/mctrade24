<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\Migrations; use JTL\Plugin\Migration; use JTL\Update\IMigration; class Migration20250428010100 extends Migration implements IMigration { protected $description = "\125\160\x64\141\x74\x65\40\x65\x78\x70\145\162\x74\x20\163\x65\x74\x74\151\156\147\163\x20\x66\x6f\x72\x20\162\145\x77\x61\x72\144\x20\160\157\x69\156\x74\163"; protected $settings = ["\163\x68\157\x77\137\x61\x63\143\157\x75\156\164\137\x63\163\163\x5f\163\145\x6c\x65\x63\164\157\x72" => ["\157\154\x64" => "\43\x61\143\143\157\165\156\x74\x20\56\x72\157\167\40\x2e\x63\x6f\x6c\55\170\x73\55\61\62\72\x6e\x74\x68\55\143\150\x69\154\x64\x28\62\x29", "\x6e\145\167" => "\56\x61\143\143\157\165\156\x74\x2d\x68\x65\141\144\x2d\144\141\x74\x61\x20\x2b\x20\x2e\162\x6f\x77"], "\163\150\x6f\167\137\141\x63\143\157\x75\x6e\x74\x5f\143\163\x73\x5f\x73\145\x6c\x65\x63\164\x6f\x72\x5f\164\x79\x70\x65" => ["\157\x6c\144" => "\160\162\145\x70\145\x6e\x64", "\156\145\167" => "\x61\x70\160\145\x6e\144"], "\x63\141\162\164\137\143\163\163\x5f\x73\145\154\x65\143\164\157\162" => ["\x6f\154\144" => "\56\156\x65\x78\x74\x2d\x61\143\164\151\x6f\x6e\163", "\156\145\167" => "\56\142\x61\163\153\x65\x74\x2d\163\165\155\155\141\x72\171"], "\x63\141\162\x74\137\x63\x73\163\x5f\163\x65\x6c\145\x63\x74\x6f\162\137\x74\171\160\145" => ["\157\x6c\x64" => "\141\x66\x74\x65\x72", "\156\x65\x77" => "\142\x65\x66\x6f\x72\145"], "\x63\x68\x65\x63\153\x6f\x75\164\x5f\x63\163\163\137\x73\145\154\x65\x63\x74\157\162" => ["\x6f\x6c\144" => "\43\143\x6f\155\160\x6c\145\164\x65\137\157\162\144\x65\162", "\156\145\x77" => "\43\x6f\162\144\145\162\55\x63\157\156\146\x69\x72\x6d\x20\76\x20\56\162\157\x77"], "\x63\150\145\143\x6b\157\165\164\x5f\x63\163\x73\x5f\x73\145\154\145\143\164\x6f\162\x5f\x74\171\160\x65" => ["\x6f\x6c\x64" => "\x62\x65\x66\157\162\x65", "\x6e\145\x77" => "\x61\x70\160\x65\156\144"], "\x73\x68\x6f\x77\137\143\150\x65\x63\153\157\x75\x74\137\x63\x73\163\137\x73\x65\x6c\145\143\164\x6f\x72" => ["\157\154\144" => "\56\x63\x68\145\143\153\157\165\x74\55\x62\165\x74\x74\x6f\x6e\55\162\x6f\x77", "\x6e\x65\167" => "\56\143\x68\x65\143\x6b\157\x75\164\x2d\143\x6f\x6e\146\x69\x72\155\141\164\151\157\x6e\55\x69\164\145\155\x73\137\137\x63\x61\x72\144"], "\x73\150\157\167\137\143\150\x65\x63\x6b\157\165\x74\x5f\x63\x73\x73\137\x73\x65\x6c\145\143\164\157\x72\137\164\x79\160\145" => ["\157\154\144" => "\x62\x65\146\x6f\x72\x65", "\156\145\x77" => "\x61\146\164\x65\162"]]; protected function getPluginID() : int { $plugin = $this->getDB()->select("\x74\x70\x6c\165\x67\x69\156", "\x63\x50\154\165\x67\x69\x6e\111\x44", "\141\x64\155\157\162\x72\151\x73\x5f\x70\162\157"); return (int) $plugin->kPlugin; } public function up() { $pluginID = $this->getPluginID(); foreach ($this->settings as $settingKey => $values) { $fullSettingName = "\141\144\x6d\157\162\x72\151\163\x5f\160\162\x6f\x5f\x65\170\160\145\162\x74\x5f\x73\x65\x74\164\151\x6e\x67\x73\x5f\x72\145\167\141\x72\144\x5f\160\157\151\156\164\x73\x5f" . $settingKey; $sql = "\123\x45\x4c\105\x43\124\40\52\40\106\x52\x4f\x4d\40\x74\x70\x6c\165\x67\x69\156\145\x69\x6e\x73\164\145\x6c\x6c\x75\156\x67\145\x6e\40\xa\40\40\40\x20\x20\x20\x20\40\x20\x20\x20\x20\x20\x20\127\110\x45\122\105\x20\x6b\120\154\165\x67\151\156\40\x3d\x20{$pluginID}\40\12\x20\40\40\40\40\x20\x20\x20\40\40\40\40\x20\40\x41\x4e\x44\x20\143\x4e\x61\x6d\145\x20\x3d\x20\47{$fullSettingName}\x27"; $currentValue = $this->fetchOne($sql); if (!($currentValue && isset($currentValue->cWert) && $currentValue->cWert === $values["\157\154\144"])) { goto FYaHi; } $updateSQL = "\125\120\x44\x41\x54\105\x20\164\160\154\x75\147\x69\x6e\145\x69\x6e\x73\x74\145\154\x6c\x75\156\147\x65\x6e\40\12\x20\x20\40\x20\x20\x20\x20\40\x20\40\40\40\40\40\x20\40\40\40\40\x20\40\40\123\105\124\40\x63\127\145\x72\164\x20\x3d\x20\x27{$values["\x6e\x65\167"]}\47\40\xa\x20\x20\40\x20\x20\x20\40\x20\x20\x20\40\40\x20\40\x20\x20\40\x20\x20\40\x20\x20\127\110\105\122\x45\40\x6b\x50\x6c\165\x67\x69\156\40\x3d\40{$pluginID}\x20\12\x20\x20\x20\40\x20\x20\x20\x20\40\40\x20\x20\x20\x20\40\40\x20\x20\x20\x20\x20\40\101\x4e\104\x20\143\x4e\x61\x6d\145\x20\x3d\x20\x27{$fullSettingName}\x27"; $this->execute($updateSQL); FYaHi: KR0cr: } WCq_F: } public function down() { $pluginID = $this->getPluginID(); foreach ($this->settings as $settingKey => $values) { $fullSettingName = "\141\144\155\x6f\x72\162\x69\163\137\160\162\157\x5f\145\170\160\145\x72\x74\137\x73\x65\164\x74\151\156\147\x73\x5f\162\x65\x77\x61\162\144\137\160\x6f\x69\x6e\164\x73\x5f" . $settingKey; $sql = "\x53\105\x4c\x45\103\124\x20\x2a\x20\106\x52\117\x4d\x20\x74\160\154\165\147\x69\156\145\151\x6e\x73\x74\x65\154\x6c\x75\156\147\145\x6e\40\12\x20\x20\x20\x20\x20\40\40\x20\40\40\40\40\40\x20\x57\x48\x45\x52\x45\40\153\x50\154\165\x67\x69\156\40\x3d\x20{$pluginID}\40\xa\40\40\40\40\x20\x20\40\40\40\40\x20\40\x20\40\x41\116\104\x20\143\116\141\x6d\x65\x20\x3d\40\x27{$fullSettingName}\47"; $currentValue = $this->fetchOne($sql); if (!($currentValue && isset($currentValue->cWert) && $currentValue->cWert === $values["\x6e\145\x77"])) { goto J17Vy; } $updateSQL = "\x55\120\104\101\124\105\x20\164\160\x6c\x75\x67\x69\x6e\145\151\156\163\x74\145\154\x6c\x75\156\x67\x65\156\40\12\x20\x20\40\x20\40\40\x20\40\x20\40\x20\x20\x20\40\40\x20\x20\40\x20\40\x20\40\123\x45\x54\40\x63\x57\145\162\x74\40\x3d\40\47{$values["\x6f\154\x64"]}\x27\x20\12\40\40\x20\x20\x20\40\x20\40\x20\40\x20\x20\x20\40\x20\x20\x20\40\40\x20\40\x20\x57\x48\105\122\x45\40\x6b\120\154\165\147\151\x6e\40\75\x20{$pluginID}\40\xa\x20\x20\x20\40\x20\40\x20\x20\40\40\40\x20\40\x20\40\x20\40\40\40\40\x20\40\x41\x4e\x44\x20\143\x4e\141\x6d\145\x20\75\40\47{$fullSettingName}\47"; $this->execute($updateSQL); J17Vy: Yooyn: } mATCp: } }