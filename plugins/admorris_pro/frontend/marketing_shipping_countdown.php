<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Shop; use Plugin\admorris_pro\AssetLoader; use Plugin\admorris_pro\Utils\Utils; $Artikel = $smarty->getTemplateVars("\x41\162\164\x69\153\145\x6c"); $nMinDeliveryDays = $Artikel->nMinDeliveryDays; $nMaxDeliveryDays = $Artikel->nMaxDeliveryDays; $dErscheinungsdatum = $Artikel->dErscheinungsdatum ?? "\156\x6f\x77"; $nMinLiefertage = $Artikel->oFavourableShipping->nMinLiefertage ?? null; $nMaxLiefertage = $Artikel->oFavourableShipping->nMaxLiefertage ?? null; $shippingCountdownScript; $outputText = ''; $versandschlussIso = ''; $erscheinungsdatum = new \DateTime($dErscheinungsdatum); $now = new \DateTime(); $nowTimestamp = $now->getTimestamp(); $nowTimestamp = $nowTimestamp + 7200; if ($erscheinungsdatum > $now) { goto FKFhz; } $from = "\x74\x6f\144\141\x79"; goto G292d; FKFhz: $nMinDeliveryDays = $nMinLiefertage; $nMaxDeliveryDays = $nMaxLiefertage; $from = new \DateTime($dErscheinungsdatum); $from->modify("\55\61\40\x64\x61\171"); $from = $from->format("\x59\55\155\55\144"); G292d: $nBearbeitungszeit = $Artikel->nBearbeitungszeit; $shipping_saturday = $oPlugin->getConfig()->getValue("\x61\144\155\157\162\162\x69\x73\137\160\x72\x6f\137\x6d\141\x72\153\145\164\x69\x6e\147\137\x73\x68\x69\x70\160\x69\x6e\147\137\143\x6f\x75\x6e\x74\x64\x6f\167\156\137\163\150\x69\x70\160\x69\x6e\147\137\163\141\x74\165\x72\144\x61\x79"); $delivery_saturday = $oPlugin->getConfig()->getValue("\x61\x64\x6d\x6f\x72\x72\151\x73\x5f\x70\x72\x6f\137\x6d\x61\x72\153\x65\x74\x69\x6e\x67\137\x73\x68\x69\160\160\x69\156\147\137\143\157\x75\x6e\x74\x64\x6f\167\156\137\144\145\154\x69\166\145\162\171\137\163\141\164\x75\x72\x64\x61\x79"); $shipping_closing = $oPlugin->getConfig()->getValue("\x61\x64\155\157\x72\x72\151\x73\137\x70\x72\157\x5f\155\141\162\x6b\x65\164\x69\156\x67\x5f\163\x68\x69\160\160\151\x6e\147\x5f\143\157\165\156\x74\x64\x6f\x77\156\x5f\163\x68\x69\160\x70\x69\x6e\147\137\143\x6c\x6f\163\x69\x6e\147"); $shipping_countdown = $oPlugin->getConfig()->getValue("\x61\x64\155\157\162\x72\x69\163\x5f\160\162\x6f\x5f\x6d\141\x72\x6b\145\x74\151\x6e\x67\137\163\x68\151\160\160\x69\156\147\x5f\143\157\165\156\164\144\157\167\156\137\143\x6f\165\156\164\144\157\167\x6e"); $data = Shop::Container()->getDB()->query("\x53\105\x4c\x45\103\x54\40\52\40\106\x52\117\115\40\x78\160\154\165\x67\151\156\x5f\x61\x64\x6d\x6f\162\162\151\x73\137\x70\162\x6f\x5f\x6d\x61\x72\153\x65\x74\x69\x6e\x67\137\163\x68\x69\160\x70\x69\156\x67\137\143\x6f\165\156\x74\144\157\167\x6e\x5f\x6e\x6f\x5f\163\x68\x69\x70\160\x69\x6e\147", 2); $holidayDays = []; foreach ($data as $day) { $holidayDays[] = $day->noShippingDate; VTPvr: } FpP2m: $showIfNoShippingToday = $oPlugin->getConfig()->getValue("\141\x64\155\157\162\162\151\x73\x5f\160\162\157\137\155\141\x72\x6b\145\164\x69\x6e\147\x5f\163\x68\151\x70\x70\151\156\147\137\x63\x6f\x75\156\x74\x64\x6f\167\x6e\x5f\163\x68\x6f\167\x5f\151\x66\x5f\156\x6f\137\x73\150\x69\x70\x70\x69\x6e\147\137\x74\x6f\144\x61\x79"); $workingDays = [1, 2, 3, 4, 5]; if (!($shipping_saturday === "\x59")) { goto m1xtr; } $workingDays = [1, 2, 3, 4, 5, 6]; m1xtr: if (!($shipping_countdown === "\131" && $nMinDeliveryDays)) { goto eH03U; } $assetLoader->loadShared("\143\157\x75\156\x74\x64\x6f\x77\156"); eH03U: if (!$nMinDeliveryDays) { goto c9TwI; } if ($oPlugin->getConfig()->getValue("\141\x64\x6d\x6f\162\x72\x69\163\137\160\x72\157\137\155\141\x72\x6b\145\x74\151\156\x67\x5f\163\150\x69\x70\x70\151\156\x67\137\143\157\x75\x6e\164\x64\x6f\167\156\x5f\164\171\x70") === "\x31") { goto ubyo3; } if (!($oPlugin->getConfig()->getValue("\x61\x64\x6d\157\x72\x72\x69\x73\137\160\x72\157\137\x6d\141\162\x6b\x65\x74\x69\156\x67\137\163\150\151\x70\x70\151\156\147\x5f\x63\x6f\165\x6e\164\x64\157\167\x6e\x5f\x74\171\x70") === "\62")) { goto Vcmvv; } $versandbeginn = $nBearbeitungszeit + 1; $versanddatum = versanddatum($from, $versandbeginn, $workingDays, $delivery_saturday, $holidayDays, $shipping_closing); $versandschluss = versanddatum($from, "\x31", $workingDays, $delivery_saturday, $holidayDays, $shipping_closing) . "\40" . $shipping_closing; $versandschlussDatum = \DateTime::createFromFormat("\152\56\x6e\x2e\131\40\x47\72\x69", $versandschluss); $versandschluss = $versandschlussDatum->getTimestamp(); $versandschluss = $versandschluss + 7200; $today = new \DateTime(); $today->setTime(0, 0, 0); $match_date = \DateTime::createFromFormat("\x6a\56\156\x2e\x59", $versanddatum); $match_date->setTime(0, 0, 0); $diff = $today->diff($match_date); $diffDays = (int) $diff->format("\45\122\x25\141"); switch ($diffDays) { case 0: $versanddatum = "\74\163\160\141\156\40\143\154\x61\163\163\75\42\x63\157\154\x6f\162\55\x62\x72\141\x6e\144\55\160\x72\151\x6d\141\162\x79\40\164\145\170\164\x2d\x70\x72\151\155\141\x72\171\42\x3e\74\142\76\40" . Utils::trans("\155\x61\x72\x6b\x65\x74\x69\x6e\147\x5f\x73\150\151\x70\160\x69\156\x67\137\143\x6f\x75\x6e\x74\144\x6f\167\156\x5f\164\x6f\x64\141\x79") . "\74\x2f\x62\x3e\x3c\x2f\x73\160\x61\156\x3e\56"; goto rDFYV; case +1: $versanddatum = "\x3c\163\160\141\156\40\x63\x6c\x61\x73\163\75\x22\143\x6f\x6c\157\x72\x2d\x62\x72\x61\x6e\x64\x2d\160\x72\151\155\x61\162\x79\x20\164\145\170\164\55\160\x72\x69\155\x61\162\x79\x22\76\x3c\x62\76\x20" . Utils::trans("\155\141\162\x6b\145\164\x69\156\x67\x5f\163\x68\x69\160\160\151\156\x67\x5f\x63\x6f\x75\x6e\164\144\157\x77\156\x5f\164\x6f\155\157\x72\162\157\167") . "\x3c\x2f\142\76\74\57\x73\160\141\x6e\x3e\x2e"; goto rDFYV; default: $versanddatum = Utils::trans("\155\x61\x72\153\x65\164\151\156\x67\x5f\163\150\x69\x70\160\x69\156\x67\137\x63\x6f\x75\x6e\164\144\x6f\167\x6e\x5f\157\156") . "\x3c\163\160\141\156\40\143\x6c\x61\x73\163\x3d\42\x63\157\x6c\x6f\162\55\x62\162\x61\156\144\55\x70\x72\x69\155\141\162\171\40\x74\x65\x78\164\55\160\162\151\155\141\x72\x79\42\x3e\74\x62\76\x20" . substr($versanddatum, 0, -4) . "\74\57\142\x3e\74\57\x73\160\141\x6e\x3e"; } Ned30: rDFYV: $outputText = orderText($versandschluss, $shipping_countdown, $versanddatum); Vcmvv: goto ULMLP; ubyo3: $MinDeliveryDate = lieferdatum($from, $nMinDeliveryDays, $workingDays, $delivery_saturday, $holidayDays, $shipping_closing); $MaxDeliveryDate = lieferdatum($from, $nMaxDeliveryDays, $workingDays, $delivery_saturday, $holidayDays, $shipping_closing); if ($MinDeliveryDate != $MaxDeliveryDate) { goto VpKEz; } if (!($MinDeliveryDate == $MaxDeliveryDate)) { goto q74aI; } $actualDeliveryDate = new \DateTime($MinDeliveryDate); $actualDeliveryDate = $actualDeliveryDate->format("\131\x2d\155\x2d\x64"); $today = new \DateTime(); $tomorrow = $today->modify("\53\x31\x20\x64\141\x79"); $tomorrow = $tomorrow->format("\x59\55\155\x2d\x64"); if ($actualDeliveryDate === $tomorrow) { goto U0Cg6; } $deliveryDate = Utils::trans("\155\x61\x72\x6b\145\x74\x69\x6e\147\137\163\x68\x69\160\x70\151\x6e\147\x5f\143\157\x75\x6e\x74\x64\157\x77\x6e\137\x6f\156") . "\x20\74\163\160\141\x6e\40\x63\x6c\141\x73\163\x3d\42\143\157\154\157\x72\x2d\142\x72\141\156\144\55\160\162\x69\155\141\162\171\x20\164\145\170\164\x2d\x70\162\x69\155\x61\x72\x79\42\x3e\74\142\x3e" . substr($MaxDeliveryDate, 0, -4) . "\x3c\57\142\x3e\x3c\57\x73\160\141\156\x3e"; goto rCVRt; U0Cg6: $deliveryDate = "\x20\74\163\x70\141\x6e\x20\x63\x6c\141\x73\x73\75\42\x63\x6f\x6c\157\162\55\x62\x72\141\156\x64\55\x70\162\x69\x6d\141\x72\171\x20\164\145\x78\164\55\x70\x72\151\x6d\x61\162\171\x22\76\74\142\x3e" . Utils::trans("\x6d\141\162\153\145\164\x69\x6e\x67\137\163\x68\x69\x70\x70\x69\156\x67\137\x63\x6f\x75\x6e\x74\144\157\x77\156\x5f\164\157\155\x6f\x72\162\157\167") . "\74\57\x62\x3e\56\x3c\x2f\163\160\x61\x6e\x3e"; rCVRt: q74aI: goto YEcpl; VpKEz: $deliveryDate = Utils::trans("\x6d\x61\x72\x6b\x65\164\x69\156\147\137\x73\x68\x69\160\x70\x69\x6e\147\x5f\x63\x6f\165\x6e\164\144\x6f\x77\x6e\137\x62\x65\164\167\x65\145\x6e") . "\40\x3c\163\x70\141\x6e\x20\143\x6c\141\163\163\75\42\143\157\x6c\x6f\162\x2d\142\x72\141\156\x64\55\x70\x72\x69\155\141\x72\171\40\164\x65\170\164\55\x70\x72\151\155\141\162\x79\42\x3e\x3c\142\x3e" . substr($MinDeliveryDate, 0, -4) . "\x3c\x2f\142\x3e\74\x2f\x73\160\x61\156\x3e\40" . Utils::trans("\155\141\x72\153\145\164\x69\156\x67\x5f\163\x68\x69\160\160\x69\x6e\x67\137\x63\x6f\165\x6e\x74\144\x6f\167\156\x5f\141\156\x64") . "\x20\x3c\163\x70\141\x6e\x20\143\154\x61\x73\163\75\x22\x63\157\154\x6f\x72\55\x62\x72\x61\x6e\144\x2d\160\162\x69\155\x61\x72\171\40\164\145\x78\x74\x2d\x70\162\151\155\x61\x72\171\42\76\x3c\142\76" . substr($MaxDeliveryDate, 0, -4) . "\74\x2f\142\76\x3c\x2f\x73\x70\x61\156\x3e"; YEcpl: $versanddatum = versanddatum($from, $nMinDeliveryDays, $workingDays, $delivery_saturday, $holidayDays, $shipping_closing); $versandschluss = versanddatum($from, "\61", $workingDays, $delivery_saturday, $holidayDays, $shipping_closing) . "\x20" . $shipping_closing; $versandschlussDatum = \DateTime::createFromFormat("\152\56\156\x2e\131\40\107\72\151", $versandschluss); $versandschluss = $versandschlussDatum->getTimestamp(); $versandschluss = $versandschluss + 7200; $outputText = orderText($versandschluss, $shipping_countdown) . $deliveryDate; ULMLP: $versandschlussIso = $versandschlussDatum->format("\x63"); c9TwI: Shop::Smarty()->assign("\163\x68\x69\x70\x70\x69\x6e\147\137\x63\157\165\x6e\x74\144\x6f\167\x6e\137\x74\145\x78\x74", $outputText)->assign("\166\x65\x72\163\141\156\144\163\143\x68\154\x75\163\163\x49\x73\x6f", $versandschlussIso)->assign("\163\150\x69\x70\x70\151\156\x67\x5f\x63\157\x75\x6e\164\144\157\167\156", $shipping_countdown); $versanddatumCheck = versanddatum("\164\157\x64\x61\x79", $nMinDeliveryDays, $workingDays, $delivery_saturday, $holidayDays, $shipping_closing); $dateTimeCheck = new \DateTime(); $todayCheck = $dateTimeCheck->format("\x6a\x2e\x6e\x2e\131"); $timeCheck = $dateTimeCheck->format("\110\x3a\x69"); if (!($showIfNoShippingToday === "\131" || $todayCheck == $versanddatumCheck || $timeCheck < $shipping_closing)) { goto sJ1Yz; } $template = $oPlugin->getPaths()->getFrontendPath() . "\x74\145\155\160\x6c\141\x74\145\163\57\x6d\x61\x72\153\145\164\x69\x6e\147\x5f\163\x68\151\160\x70\x69\x6e\147\x5f\x63\157\165\156\x74\x64\157\167\156\x2e\x74\160\x6c"; $template = $smarty->fetch($template); if (empty($shippingCountdownScript)) { goto AfXow; } $template .= $shippingCountdownScript; AfXow: cssSelector("\x73\x68\x69\160\x70\151\156\x67\137\143\157\x75\x6e\164\144\x6f\167\156", $template); sJ1Yz: function versanddatum($from, $days, $workingDays, $delivery_saturday, $holidayDays, $shipping_closing) { goto aZBFu; aZBFu: $from = new \DateTime($from); $now = new \DateTime(); $nowTimestamp = $now->getTimestamp(); $nowTimestamp = $nowTimestamp + 7200; $shipping_closing = strtotime($shipping_closing); $shipping_closing = $shipping_closing + 7200; $finalShippingDate = null; $totalDays = 0; if (!($nowTimestamp >= $shipping_closing)) { goto OqCq3; } $from->modify("\53\x31\40\x64\141\x79"); goto fSA68; N57du: $tag = "\x6e\157\x72\155\x61\x6c"; XhBLl: $finalShippingDate = $from->format("\152\56\156\x2e\131"); $from->modify("\53\x31\x20\144\141\x79"); goto oKe1_; qbQ2r: return $finalShippingDate; goto cr8XC; fSA68: OqCq3: oKe1_: if (!$days) { goto qbQ2r; } if (in_array($from->format("\116"), $workingDays) && !in_array($from->format("\131\x2d\x6d\55\x64"), $holidayDays)) { goto jsw7L; } $totalDays = $totalDays + 1; $tag = "\x66\145\151\145\x72\164\141\147\40\157\144\145\x72\40\x6b\145\151\156\x20\x77\145\x72\x6b\x74\x61\147"; goto XhBLl; jsw7L: $days--; $totalDays = $totalDays + 1; goto N57du; cr8XC: } function lieferdatum($from, $days, $workingDays, $delivery_saturday, $holidayDays, $shipping_closing) { goto ndRHT; ndRHT: $from = new \DateTime($from); $now = new \DateTime(); $nowTimestamp = $now->getTimestamp(); $nowTimestamp = $nowTimestamp + 7200; $shipping_closing = strtotime($shipping_closing); $shipping_closing = $shipping_closing + 7200; $totalDays = 0; if ($nowTimestamp >= $shipping_closing || in_array($now->format("\131\x2d\x6d\55\144"), $holidayDays) || !in_array($now->format("\116"), $workingDays)) { goto sXwfj; } $from->modify("\x2b\61\40\x64\x61\171"); goto TeAl4; goto f1mKP; oCd_W: t7l_x: $finalDeliveryDate = $from->format("\152\x2e\156\56\131"); $from->modify("\x2b\x31\x20\144\x61\x79"); goto kqEAz; mJEeB: return $finalDeliveryDate; goto lb4iO; cOczx: goto v17hU; lyDr8: $days--; $totalDays = $totalDays + 1; $tag = "\156\x6f\162\x6d\x61\x6c"; v17hU: goto t7l_x; jQbSh: $totalDays = $totalDays + 1; $days--; goto oCd_W; f1mKP: sXwfj: $from->modify("\53\x31\40\x64\x61\x79"); $days = $days + 1; TeAl4: kqEAz: if (!$days) { goto mJEeB; } if ($days == 1 && $delivery_saturday === "\x59" && $from->format("\x6c") === "\x53\141\164\165\162\144\141\x79") { goto jQbSh; } if (in_array($from->format("\x4e"), $workingDays) && !in_array($from->format("\131\x2d\155\55\144"), $holidayDays)) { goto lyDr8; } $totalDays = $totalDays + 1; $tag = "\x66\x65\x69\145\x72\x74\x61\x67\x20\157\144\x65\162\40\153\145\x69\x6e\40\167\145\x72\x6b\164\141\x67"; goto cOczx; lb4iO: } function orderText($versandschluss, $shipping_countdown, $versanddatum = false) { goto pcRHj; VhvTl: $seconds = "\40" . $langVars->and . "\x3c\x62\x20\x63\x6c\141\163\x73\x3d\x22\x63\157\x6c\157\x72\x2d\x62\x72\x61\x6e\x64\55\160\x72\x69\x6d\141\162\x79\x20\164\145\170\x74\55\x70\x72\x69\155\141\162\171\40\x73\150\151\160\x70\151\x6e\147\55\x63\157\x75\156\164\x64\157\167\x6e\55\163\145\143\x6f\156\144\163\x22\76\40\60\60\40" . $langVars->seconds . "\74\x2f\142\76\40"; koXfK: if ($versanddatum) { goto FuDN5; } $date = $langVars->within_lieferzeit . "\x20"; goto lXu26; FuDN5: $date = $langVars->within_versanddatum . "\x20" . $versanddatum; lXu26: $orderText = $langVars->within1 . $days . $hours . "\x20\x3c\142\40\x63\154\x61\163\x73\x3d\x22\x63\157\x6c\x6f\x72\x2d\142\162\141\156\x64\55\x70\162\151\155\141\162\x79\40\x74\145\170\x74\55\160\162\x69\155\141\162\171\x20\163\x68\x69\160\x70\151\156\x67\x2d\x63\157\x75\156\x74\x64\157\167\156\x2d\x6d\x69\156\x75\164\x65\x73\42\x3e" . intval(gmdate("\x69", $interval)) . "\40" . $langVars->minutes . "\74\x2f\142\x3e\40" . $seconds . $date; return $orderText; goto zC9ck; pcRHj: $now = new \DateTime(); $nowTimestamp = $now->getTimestamp(); $nowTimestamp = $nowTimestamp + 7200; $interval = $versandschluss - $nowTimestamp; $langVars = (object) ["\x64\x61\x79\163" => Utils::trans("\x6d\141\162\x6b\145\164\x69\x6e\x67\137\x73\150\151\160\x70\x69\156\147\x5f\143\157\x75\x6e\164\144\x6f\x77\156\x5f\x64\x61\x79\163"), "\x68\x6f\165\x72\163" => Utils::trans("\x6d\x61\x72\153\145\x74\x69\x6e\147\x5f\163\150\151\160\x70\151\156\147\x5f\143\x6f\165\156\x74\144\157\x77\x6e\x5f\150\x6f\165\x72\163"), "\155\151\156\x75\x74\x65\x73" => Utils::trans("\155\141\162\x6b\x65\x74\x69\x6e\x67\x5f\163\150\x69\x70\x70\x69\156\x67\137\143\157\x75\156\164\x64\157\x77\x6e\137\155\x69\x6e\165\x74\145\x73"), "\x73\145\x63\157\156\x64\x73" => Utils::trans("\x6d\141\162\x6b\145\164\x69\x6e\x67\137\163\150\x69\x70\x70\x69\x6e\147\137\143\x6f\165\156\x74\x64\x6f\167\156\137\x73\145\x63\x6f\156\144\x73"), "\x61\x6e\144" => Utils::trans("\155\141\x72\x6b\x65\x74\x69\x6e\147\137\x73\150\151\x70\x70\151\x6e\x67\x5f\x63\157\165\156\164\x64\x6f\167\156\137\141\x6e\x64"), "\x77\x69\164\x68\151\156\61" => Utils::trans("\155\x61\x72\153\145\x74\x69\156\147\x5f\x73\150\x69\x70\160\151\156\x67\x5f\x63\157\165\x6e\x74\x64\x6f\x77\156\137\157\x72\x64\x65\x72\137\x77\151\164\150\151\x6e\61"), "\x77\151\164\150\x69\156\137\x76\145\162\x73\141\x6e\144\x64\141\x74\x75\155" => Utils::trans("\155\x61\x72\x6b\x65\x74\x69\x6e\x67\x5f\163\x68\151\160\160\x69\156\147\x5f\143\x6f\x75\156\x74\144\157\167\156\137\157\162\x64\145\x72\x5f\167\151\x74\150\151\x6e\137\x76\145\x72\x73\x61\156\144\144\141\164\165\x6d"), "\x77\x69\164\150\151\x6e\137\154\x69\145\146\145\162\172\x65\151\164" => Utils::trans("\x6d\x61\162\x6b\x65\164\151\x6e\x67\x5f\163\x68\151\x70\160\x69\x6e\147\137\x63\157\165\156\164\144\x6f\x77\156\x5f\x6f\x72\144\145\162\x5f\x77\151\164\150\151\156\x5f\x6c\x69\145\x66\x65\162\172\x65\151\164")]; $day = floor($interval / (24 * 3600)); $interval = $interval % (24 * 3600); $hour = floor($interval / (60 * 60)); $interval = $interval % (60 * 60); $min = floor($interval / 60); goto vfpUW; vfpUW: $days = ''; if (!($day != "\60")) { goto F6uQn; } $days = "\40\x3c\142\40\143\x6c\141\163\x73\75\x22\143\x6f\154\157\162\x2d\x62\162\141\156\144\x2d\x70\x72\151\155\141\162\x79\40\164\x65\x78\164\x2d\x70\162\151\155\x61\x72\171\x20\x73\150\x69\160\160\151\156\x67\55\143\x6f\x75\x6e\x74\x64\x6f\x77\x6e\55\x64\x61\x79\163\x22\76" . $day . "\40" . $langVars->days . "\74\57\x62\x3e\40" . $langVars->and; F6uQn: $hours = ''; if (!($hour != "\60")) { goto KizkC; } $hours = "\40\x3c\142\x20\x63\x6c\141\163\163\x3d\42\143\x6f\154\157\x72\55\142\162\141\x6e\x64\55\160\162\x69\155\141\x72\x79\x20\x74\x65\x78\x74\x2d\x70\x72\151\x6d\x61\162\171\40\x73\x68\151\x70\160\151\156\147\x2d\x63\x6f\x75\156\x74\x64\x6f\167\156\55\x68\157\x75\x72\x73\x22\x3e" . $hour . "\40" . $langVars->hours . "\40\x3c\x2f\142\x3e\40" . $langVars->and; KizkC: $seconds = ''; if (!($shipping_countdown === "\131")) { goto koXfK; } goto VhvTl; zC9ck: }