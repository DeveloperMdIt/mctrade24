<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro\frontend\controller; use Exception; use JTL\Language\LanguageHelper; use JTL\Plugin\PluginInterface; use JTL\Shop; class ShopVoteController { private $shopVoteId; private $scriptTag; private $badgetType; private $langFromIso; private $plugin; private $flyout; function __construct(PluginInterface $oPlugin) { $this->plugin = $oPlugin; $this->shopVoteId = $oPlugin->getConfig()->getValue("\141\x64\155\157\162\x72\x69\163\137\160\x72\157\137\x6d\x61\x72\153\x65\164\x69\x6e\147\137\164\x72\165\x73\164\x6d\x61\162\153\137\x69\144"); $this->scriptTag = $this->initScriptTag(); $this->badgetType = intval($oPlugin->getConfig()->getValue("\x61\x64\x6d\x6f\162\x72\x69\163\137\x70\162\157\137\155\141\x72\x6b\x65\x74\x69\156\147\137\164\x72\165\x73\164\155\141\x72\153\137\x73\150\x6f\160\x76\x6f\164\145\x5f\163\164\171\x6c\x65")); $this->flyout = $oPlugin->getConfig()->getValue("\x61\144\x6d\157\x72\162\151\163\x5f\x70\x72\x6f\137\x6d\x61\162\153\x65\x74\151\156\147\137\x74\162\165\x73\x74\x6d\141\x72\153\137\x73\150\x6f\x70\x76\157\x74\145\x5f\x66\154\171\x6f\165\x74"); $this->langFromIso = $this->getLangfromIso(); } private function loadScript() { $consentmanagerActive = Shop::getSettingValue(CONF_CONSENTMANAGER, "\x63\x6f\x6e\163\145\156\x74\x5f\155\x61\x6e\x61\x67\145\x72\x5f\141\x63\164\151\166\145"); return Shop::Container()->getConsentManager()->hasConsent("\x61\144\x6d\157\162\x72\x69\163\x2d\x73\x68\x6f\160\x76\157\164\145") === true || $consentmanagerActive == "\116"; } private function initScriptTag() { $scriptTag = "\40\x64\141\x74\x61\55\156\141\155\x65\x3d\47\x61\x64\155\x6f\162\x72\151\x73\55\x73\x68\157\x70\166\x6f\x74\x65\x27"; $scriptTag .= $this->loadScript() ? "\40\164\x79\160\145\75\47\141\160\160\154\151\x63\141\164\151\x6f\156\x2f\152\x61\166\141\x73\x63\162\x69\160\x74\x27\x20" : "\x20\164\171\x70\x65\75\47\164\145\170\x74\x2f\x70\x6c\141\151\x6e\47\x20\144\141\x74\x61\55\164\x79\160\145\x3d\47\141\x70\x70\154\151\143\141\164\x69\x6f\x6e\x2f\152\141\166\x61\x73\x63\162\151\160\x74\47\40"; return $scriptTag; } private function getLangFromIso() { $lang = LanguageHelper::getInstance()->getIso(); $langFromIso = $lang === "\x67\145\162" ? "\x44\105" : "\105\x4e"; return $langFromIso; } public function renderBadge() { switch ($this->badgetType) { case 1: $scriptUrl = "\150\x74\164\x70\x73\x3a\x2f\x2f\x77\151\x64\147\x65\x74\x73\x2e\x73\x68\x6f\x70\166\x6f\164\x65\x2e\144\x65\x2f\x6a\x73\x2f\142\141\x64\x67\x65\164\x2d\x39\x38\x78\71\70\x2e\x6d\x69\156\x2e\152\163"; $createBadge = "\143\x72\x65\141\x74\x65\x42\x61\144\x67\145\164"; goto emRNX; case 2: $scriptUrl = "\150\x74\164\x70\163\72\x2f\x2f\167\151\144\147\x65\164\163\56\163\150\157\160\166\x6f\x74\x65\x2e\x64\x65\57\x6a\x73\57\x76\157\164\145\142\141\144\147\x65\x2e\x6d\x69\156\x2e\x6a\x73"; $createBadge = "\x63\162\145\x61\164\x65\126\102\141\144\x67\x65"; $this->badgetType = 3; goto emRNX; case 3: $scriptUrl = "\150\x74\x74\x70\x73\72\x2f\x2f\x77\x69\144\147\x65\164\x73\56\163\x68\157\x70\166\x6f\x74\145\x2e\144\145\57\x6a\163\x2f\166\x6f\x74\x65\142\x61\x64\x67\145\x2e\155\151\156\x2e\152\163"; $createBadge = "\x63\162\x65\141\x74\x65\126\x42\x61\x64\147\145"; $this->badgetType = 2; goto emRNX; default: throw new Exception("\x65\x72\162\x6f\x72\x20\146\x72\x6f\155\40" . __CLASS__ . "\54\40\x66\x75\x6e\x20" . __FUNCTION__ . "\72\40\x6e\x6f\40\102\x61\144\147\145\x54\x79\x70\145\40\x77\x61\163\x20\x73\165\142\155\x69\x74\x74\x65\144"); goto emRNX; } d09lk: emRNX: $data = Shop::Smarty()->createData(Shop::Smarty()); $data->assign("\x61\x64\155\123\x68\157\160\126\x6f\x74\145", ["\x73\143\162\x69\160\x74\124\141\147" => $this->scriptTag, "\163\143\x72\x69\x70\164\125\x72\154" => $scriptUrl, "\143\x72\x65\141\164\145\102\141\144\147\x65" => $createBadge, "\163\x68\x6f\x70\126\157\164\x65\111\144" => $this->shopVoteId, "\x62\x61\x64\x67\x65\164\x54\171\160\x65" => $this->badgetType, "\x6c\141\156\x67\165\x61\147\x65" => $this->langFromIso, "\146\154\x79\157\165\164" => $this->flyout, "\154\x6f\141\144\x53\143\x72\x69\x70\x74" => $this->loadScript()]); $template = $this->plugin->getPaths()->getFrontendPath() . "\164\145\155\160\x6c\141\x74\145\x73\57\x6d\141\x72\x6b\145\x74\151\156\147\137\x73\x68\157\x70\x5f\166\157\164\145\56\164\160\154"; $templateConfig = Shop::Smarty()->createTemplate($template, $data); pq("\142\x6f\x64\x79")->append($templateConfig->fetch()); } }