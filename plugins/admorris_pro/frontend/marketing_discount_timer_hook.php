<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Shop; $jtl_token = $_SESSION["\x6a\164\x6c\x5f\x74\157\x6b\145\156"]; $db = Shop::Container()->getDB(); $data = $db->query("\123\105\x4c\105\x43\124\x20\x69\144\40\x46\122\117\115\40\x78\160\x6c\165\147\151\156\x5f\x61\x64\155\x6f\x72\x72\x69\163\137\x70\162\x6f\x5f\144\151\163\x63\x6f\165\x6e\x74\x5f\x74\x69\x6d\x65\x72\137\x74\x65\155\x70\40\x57\110\x45\x52\x45\x20\163\145\163\163\151\157\x6e\x54\157\153\x65\156\40\x3d\x20\x27{$jtl_token}\x27", 2); $timerTime = new \DateTime(); $timeNow = $timerTime->format("\x59\x2d\x6d\55\x64\x20\110\x3a\x69\x3a\x73"); if (!empty($data)) { goto gmXi_; } $timerMinutes = $oPlugin->getConfig()->getValue("\x61\x64\155\157\x72\162\151\x73\x5f\x70\x72\x6f\x5f\x6d\141\x72\x6b\x65\x74\x69\156\147\137\x64\x69\163\x63\157\165\x6e\164\137\x74\x69\155\145\162\x5f\164\151\155\x65"); $timerDiscount = $oPlugin->getConfig()->getValue("\x61\x64\x6d\157\162\x72\x69\163\137\160\162\157\137\155\141\162\x6b\x65\164\x69\x6e\147\137\x64\151\163\143\157\x75\x6e\164\x5f\164\151\155\x65\162\137\x64\x69\163\143\x6f\165\x6e\x74"); $couponName = $oPlugin->getConfig()->getValue("\x61\144\x6d\157\162\x72\151\163\x5f\160\162\157\x5f\x6d\x61\162\153\x65\164\151\156\x67\137\144\x69\163\x63\157\x75\156\x74\x5f\164\x69\155\145\x72\137\156\x61\155\x65"); $couponTyp = $oPlugin->getConfig()->getValue("\141\x64\x6d\x6f\x72\162\x69\x73\x5f\160\162\x6f\x5f\155\x61\x72\x6b\x65\164\x69\156\147\x5f\144\151\163\143\157\x75\x6e\164\137\164\x69\x6d\145\162\137\x64\151\163\x63\157\x75\156\x74\164\171\160"); $tax = $oPlugin->getConfig()->getValue("\x61\x64\x6d\157\x72\162\151\x73\x5f\x70\162\157\x5f\x6d\141\x72\153\x65\164\x69\156\147\x5f\144\x69\163\143\x6f\x75\x6e\164\x5f\164\x69\x6d\145\162\x5f\164\x61\x78"); $coustomerGroup = $oPlugin->getConfig()->getValue("\141\144\x6d\x6f\x72\162\151\x73\137\160\x72\157\137\155\x61\162\x6b\145\164\x69\x6e\147\137\x64\x69\x73\143\157\165\x6e\x74\137\x74\x69\x6d\x65\x72\137\143\165\x73\164\157\x6d\x65\x72\x5f\147\162\157\x75\160"); $products = $oPlugin->getConfig()->getValue("\141\144\x6d\x6f\x72\162\151\x73\x5f\x70\x72\157\x5f\x6d\141\x72\153\x65\x74\151\156\147\x5f\144\x69\163\x63\157\165\156\x74\x5f\x74\x69\x6d\145\x72\137\x61\x72\x74\x69\x63\x6c\x65"); $manufacturer = $oPlugin->getConfig()->getValue("\141\144\155\157\162\162\151\x73\x5f\x70\x72\157\x5f\155\141\x72\x6b\x65\x74\x69\x6e\x67\x5f\144\x69\163\143\157\x75\x6e\x74\137\164\151\x6d\x65\x72\137\x6d\141\156\x75\146\x61\143\x74\165\162\x65\x72"); $category = $oPlugin->getConfig()->getValue("\141\144\155\157\x72\x72\151\163\137\160\x72\x6f\x5f\x6d\141\x72\153\x65\x74\151\156\147\137\144\151\x73\143\157\165\x6e\x74\137\x74\x69\x6d\145\x72\x5f\143\141\164\145\x67\157\162\x79"); $fullCart = $oPlugin->getConfig()->getValue("\x61\x64\x6d\157\x72\162\151\x73\137\160\162\x6f\x5f\x6d\141\162\x6b\x65\164\x69\156\x67\137\144\151\x73\x63\x6f\165\x6e\x74\x5f\x74\x69\x6d\x65\162\x5f\x66\165\x6c\x6c\137\x63\141\162\x74"); $kKundengruppe = !empty($_SESSION["\x4b\165\x6e\x64\145\156\147\x72\x75\160\160\145"]) ? $_SESSION["\x4b\x75\x6e\x64\x65\x6e\x67\162\165\x70\x70\x65"]->getID() : null; $kArtikel = $args_arr["\153\101\162\x74\151\153\145\x6c"]; $productData = $db->query("\123\x45\x4c\x45\x43\124\40\143\101\162\x74\x4e\162\54\x20\x6b\x48\145\x72\x73\164\x65\154\x6c\145\162\40\x46\x52\x4f\x4d\x20\164\x61\162\x74\151\x6b\145\x6c\x20\x57\x48\105\122\x45\x20\x6b\x41\162\x74\x69\153\145\x6c\40\75\40\47{$kArtikel}\47", 2); if ($coustomerGroup === "\55\x31" || $coustomerGroup == $kKundengruppe) { goto cDETo; } $coustomerGroupCheck = false; goto T1lYm; cDETo: $coustomerGroupCheck = true; T1lYm: if ($products === '') { goto uADHj; } $productsArray = explode("\x3b", $products); $productsCheck = in_array($productData[0]->cArtNr, $productsArray); goto EtT0h; uADHj: $productsCheck = true; EtT0h: if ($category === "\x2d\61") { goto gNFCa; } $categoryData = $db->query("\x53\105\x4c\105\x43\x54\40\x6b\x4b\x61\164\x65\x67\157\x72\151\145\40\x46\x52\x4f\x4d\x20\164\153\x61\164\x65\147\x6f\162\151\x65\141\x72\164\151\x6b\145\x6c\x20\x57\x48\105\122\105\40\153\x41\x72\x74\151\153\145\x6c\40\x3d\40\x27{$kArtikel}\47", 2); $categoryArray = explode("\73", $category); $categoryCheck = false; foreach ($categoryData as $key => $value) { if (!in_array($categoryData[$key]->kKategorie, $categoryArray)) { goto a4cBX; } $categoryCheck = true; a4cBX: K6LL5: } JibYd: goto AXdlJ; gNFCa: $categoryCheck = true; AXdlJ: if ($manufacturer === "\55\x31") { goto EQCRf; } $manufacturerArray = explode("\73", $manufacturer); $manufacturerCheck = in_array($productData[0]->kHersteller, $manufacturerArray); goto za4vb; EQCRf: $manufacturerCheck = true; za4vb: if (!($coustomerGroupCheck && $productsCheck && $manufacturerCheck && $categoryCheck)) { goto i7hqM; } $timerTime->modify("\53\40{$timerMinutes}\40\x6d\151\x6e\x75\164\145\163"); $timerTime = $timerTime->format("\131\55\x6d\x2d\x64\x20\x48\x3a\151\72\163"); $couponCode = generateRandomString(); $dataCouponCode = new \stdClass(); $dataCouponCode->kKundengruppe = $coustomerGroup; $dataCouponCode->kSteuerklasse = $tax; $dataCouponCode->cName = "{$couponName}"; $dataCouponCode->fWert = $timerDiscount; $dataCouponCode->cWertTyp = "{$couponTyp}"; $dataCouponCode->dGueltigAb = $timeNow; $dataCouponCode->dGueltigBis = $timerTime; $dataCouponCode->fMindestbestellwert = 0; $dataCouponCode->cCode = "{$couponCode}"; $dataCouponCode->nVerwendungen = 1; $dataCouponCode->cArtikel = $products; $dataCouponCode->cHersteller = $manufacturer; $dataCouponCode->cKategorien = $category; $dataCouponCode->cKunden = "\55\61"; $dataCouponCode->cKuponTyp = "\163\x74\141\156\x64\x61\162\x64"; $dataCouponCode->cZusatzgebuehren = "\116"; $dataCouponCode->cAktiv = "\131"; $dataCouponCode->dErstellt = $timeNow; $dataCouponCode->nGanzenWKRabattieren = $fullCart; $db->insert("\x74\153\165\x70\x6f\x6e", $dataCouponCode); $data = $db->query("\123\105\x4c\x45\103\x54\x20\x6b\x4b\x75\160\157\156\x20\x46\x52\117\x4d\40\x74\153\165\x70\x6f\x6e\x20\127\110\x45\x52\105\x20\x63\103\157\x64\x65\x20\75\x20\47{$couponCode}\x27\x20\x4c\111\x4d\x49\124\40\x31", 2); $kKupon = $data[0]->kKupon; $data = $db->query("\x53\x45\x4c\x45\x43\124\x20\x63\111\123\117\x20\106\122\117\115\40\164\163\160\162\141\143\x68\x65", 2); foreach ($data as $cISO) { $dataCouponLang = new \stdClass(); $dataCouponLang->kKupon = $kKupon; $dataCouponLang->cISOSprache = $cISO->cISO; $dataCouponLang->cName = "{$couponName}"; $db->insert("\164\x6b\165\160\x6f\156\163\x70\162\141\x63\150\145", $dataCouponLang); orG4M: } Xp29G: $dataDiscountTimer = new \stdClass(); $dataDiscountTimer->sessionToken = $jtl_token; $dataDiscountTimer->vality = $timerTime; $dataDiscountTimer->couponCode = $couponCode; $dataDiscountTimer->kKupon = $kKupon; $db->insert("\x78\160\154\165\x67\x69\156\x5f\141\144\155\157\x72\x72\x69\x73\137\160\162\157\x5f\144\151\163\143\157\x75\x6e\x74\x5f\164\x69\155\145\162\137\x74\145\155\x70", $dataDiscountTimer); i7hqM: gmXi_: $data = $db->query("\123\105\114\x45\103\124\x20\153\113\x75\160\x6f\156\40\x46\122\117\115\x20\170\x70\x6c\165\147\151\156\137\141\x64\x6d\x6f\x72\x72\x69\x73\x5f\x70\162\x6f\137\144\x69\163\x63\157\x75\x6e\x74\137\x74\x69\x6d\x65\162\x5f\x74\145\x6d\x70\40\127\x48\x45\122\105\x20\x76\x61\x6c\x69\x74\171\x20\x3c\40\47{$timeNow}\x27", 2); foreach ($data as $kKupon) { $db->delete("\x78\160\x6c\165\147\151\x6e\x5f\141\144\x6d\157\162\162\151\x73\137\160\162\x6f\137\144\151\x73\143\x6f\165\156\164\137\x74\151\x6d\145\x72\137\164\x65\155\x70", "\153\x4b\165\160\157\156", $kKupon->kKupon); $db->delete("\164\x6b\165\x70\x6f\156", "\x6b\x4b\165\160\x6f\156", $kKupon->kKupon); $db->delete("\x74\x6b\x75\160\x6f\156\163\x70\162\141\x63\150\145", "\x6b\113\x75\160\x6f\x6e", $kKupon->kKupon); ZSufB: } e3S2D: function generateRandomString($length = 6) { $characters = "\x30\61\62\x33\x34\65\66\67\70\71\141\x62\143\x64\145\146\x67\150\x69\x6a\x6b\x6c\155\156\x6f\160\x71\162\163\x74\x75\166\167\170\171\172\101\x42\103\104\x45\106\107\110\111\x4a\113\114\x4d\x4e\x4f\x50\x51\x52\x53\x54\125\x56\127\130\131\x5a"; $charactersLength = strlen($characters); $randomString = ''; $i = 0; iFOnp: if (!($length > $i)) { goto xfMi2; } $randomString .= $characters[rand(0, $charactersLength - 1)]; nq2bn: $i++; goto iFOnp; xfMi2: return $randomString; }