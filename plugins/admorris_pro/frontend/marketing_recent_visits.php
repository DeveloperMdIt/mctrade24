<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Shop; $jtl_token = $_SESSION["\x6a\164\154\x5f\x74\x6f\x6b\x65\156"]; $Artikel = $smarty->getTemplateVars("\x41\x72\x74\151\153\145\154"); $artikelNummer = null; $kundengruppe = $_SESSION["\x4b\x75\x6e\x64\145\x6e\147\162\165\x70\160\145"]->getID(); $mode = $oPlugin->getConfig()->getValue("\141\x64\x6d\157\x72\x72\151\x73\x5f\x70\x72\x6f\137\155\x61\x72\x6b\x65\x74\x69\156\147\x5f\x72\x65\143\x65\156\x74\137\166\151\163\x69\164\163\137\x6d\157\144\165\163"); $demo_max = $oPlugin->getConfig()->getValue("\x61\x64\155\157\162\x72\151\x73\x5f\160\162\157\x5f\x6d\141\162\x6b\145\x74\x69\156\147\137\x72\145\143\145\x6e\x74\137\166\151\163\151\x74\163\x5f\144\145\155\x6f\137\155\x61\x78\x69\x6d\165\x6d"); $period = $oPlugin->getConfig()->getValue("\141\x64\x6d\x6f\x72\x72\151\x73\x5f\x70\162\157\x5f\155\x61\x72\x6b\x65\x74\151\x6e\x67\137\162\x65\143\145\x6e\164\x5f\x76\151\163\x69\x74\x73\137\x70\x65\x72\x69\157\144"); $show_stock = $oPlugin->getConfig()->getValue("\141\144\x6d\157\x72\x72\151\163\x5f\x70\x72\x6f\x5f\155\141\162\153\x65\164\151\x6e\147\137\x72\x65\x63\145\156\x74\137\x76\151\163\151\164\163\x5f\163\150\x6f\x77\x5f\x73\x74\157\143\x6b"); $max_stock = $oPlugin->getConfig()->getValue("\141\x64\155\157\x72\162\151\x73\x5f\x70\x72\x6f\x5f\x6d\141\162\x6b\145\x74\151\x6e\x67\x5f\x72\145\x63\145\x6e\x74\137\x76\151\x73\151\164\163\x5f\x73\x74\x6f\143\x6b\137\155\x61\170\x69\x6d\165\x6d"); $add_father_child = $oPlugin->getConfig()->getValue("\x61\144\x6d\x6f\x72\162\x69\x73\137\160\x72\x6f\137\155\x61\x72\153\145\x74\x69\x6e\x67\137\162\x65\x63\145\x6e\164\137\166\x69\163\x69\x74\x73\x5f\141\144\x64\137\146\141\164\x68\x65\x72"); $period_begin_visits = new TimeOffset("\55\x20{$period}\x20\x6d\151\x6e", "\x59\x2d\155\x2d\x64\x20\x48\x3a\151\72\163"); if (!($mode == 1 || $mode == 2)) { goto V5Qm4; } if ($add_father_child == "\131") { goto TwCIc; } if ($Artikel->kVariKindArtikel != null) { goto kkujy; } $artikelNummer = $Artikel->kArtikel; goto KdRiS; kkujy: $artikelNummer = $Artikel->kVariKindArtikel; KdRiS: goto P4znz; TwCIc: if ($Artikel->kVaterArtikel != 0) { goto aqMsl; } $artikelNummer = $Artikel->kArtikel; goto XNgVy; aqMsl: $artikelNummer = $Artikel->kVaterArtikel; XNgVy: P4znz: V5Qm4: $visitVars = ($mode == 1 || $mode == 2) && !is_null($artikelNummer) ? "\40\166\151\163\151\164\163\56\x63\x6f\x75\156\164\x20\101\123\40\x76\x69\x73\151\164\163\x43\157\x75\156\x74\54\40\x76\151\163\x69\164\163\x2e\157\154\x64\x65\163\x74\40\x41\x53\x20\166\151\x73\x69\x74\x73\117\154\144\x65\163\164\x2c\40" : ''; $ownVisitVars = "\x20\x6f\167\x6e\x56\151\163\151\x74\x2e\x63\x6f\x75\x6e\x74\x20\x41\x53\40\157\x77\156\126\151\163\x69\x74\103\x6f\165\x6e\x74\x2c\x20\x6f\x77\x6e\x56\151\x73\151\x74\x2e\x61\143\x74\151\157\x6e\x44\x61\164\145\40\101\x53\40\x6f\x77\156\x56\151\163\151\x74\x44\141\164\x65"; $visitsQuery = ($mode == 1 || $mode == 2) && !is_null($artikelNummer) ? "\xa\xa\40\40\x4c\105\x46\x54\x20\x4a\x4f\x49\x4e\40\50\xa\x20\x20\40\40\123\105\114\x45\x43\124\40\40\40\40\x20\x20\x6b\101\x72\164\151\153\x65\154\x20\x41\x53\40\x6b\101\162\x74\x69\x6b\145\x6c\x2c\12\x20\x20\40\40\40\x20\40\40\40\40\40\x20\x20\40\40\x20\40\x20\x20\x20\x53\x55\x4d\50\161\165\141\156\164\x69\x74\171\51\x20\141\x73\40\x63\x6f\165\x6e\x74\x2c\40\x4d\x49\x4e\50\x61\x63\x74\x69\157\x6e\104\141\x74\x65\x29\40\141\163\x20\157\154\x64\x65\163\x74\12\40\40\40\x20\xa\40\x20\40\x20\x46\122\x4f\115\40\x20\x20\40\x20\40\x20\40\170\x70\x6c\x75\147\x69\x6e\137\x61\144\155\157\x72\x72\x69\163\137\160\162\157\137\x72\145\x63\x65\x6e\164\137\163\141\x6c\145\x73\12\40\x20\40\x20\x57\110\105\x52\x45\x20\x20\x20\40\x20\x20\40\x6b\x41\x72\164\151\153\x65\x6c\x20\x3d\40\x27{$artikelNummer}\x27\40\101\116\x44\40\x74\x79\160\x20\75\40\47\166\x69\x73\151\164\47\x20\101\x4e\x44\x20\141\143\x74\151\x6f\156\x44\x61\164\x65\x20\x3e\40\x27{$period_begin_visits}\x27\x20\12\40\40\40\x20\107\x52\x4f\125\x50\x20\x42\x59\40\40\40\40\x20\x78\x70\x6c\165\x67\x69\x6e\137\141\144\x6d\x6f\162\162\151\x73\137\x70\162\157\137\162\145\x63\145\x6e\164\x5f\163\141\x6c\x65\x73\x2e\153\101\162\x74\x69\x6b\145\x6c\xa\x20\x20\x20\40\12\x20\40\x20\x20\x29\x20\101\123\40\166\x69\x73\151\x74\x73\40\xa\40\x20\x20\x20\117\116\x20\166\151\163\151\x74\163\56\x6b\x41\162\164\x69\153\145\154\x20\x3d\40\x78\x70\x6c\x75\x67\151\156\x5f\x61\144\155\157\162\x72\151\x73\x5f\x70\x72\x6f\137\162\145\143\x65\156\x74\x5f\x73\141\x6c\x65\x73\x2e\x6b\x41\162\x74\x69\153\x65\x6c" : ''; $ownVisitQuery = "\xa\x20\x20\114\x45\x46\x54\x20\x4a\117\x49\116\40\50\12\40\x20\40\40\123\x45\114\105\103\x54\x20\40\x20\40\40\x20\x6b\x41\x72\164\151\153\x65\154\40\x41\123\40\x6b\x41\162\164\x69\x6b\145\154\x2c\xa\40\x20\x20\x20\40\40\40\x20\40\40\x20\40\x20\x20\40\40\40\40\x20\x20\123\125\115\x28\x71\x75\x61\x6e\x74\x69\164\x79\x29\x20\101\123\x20\x63\157\x75\156\164\x2c\40\141\143\x74\151\157\x6e\104\141\164\x65\x20\101\x53\x20\141\x63\164\151\x6f\x6e\104\141\x74\x65\12\40\x20\40\40\12\x20\40\x20\x20\106\x52\117\x4d\40\40\40\x20\40\x20\40\40\170\x70\x6c\x75\x67\x69\x6e\x5f\141\144\x6d\157\162\162\151\x73\x5f\160\162\157\137\162\x65\x63\x65\x6e\164\x5f\163\141\x6c\x65\163\xa\x20\40\x20\x20\127\110\x45\122\x45\x20\40\x20\40\40\x20\40\163\x65\163\163\x69\157\156\x49\104\x20\75\40\47{$jtl_token}\x27\40\x41\116\x44\x20\x6b\x41\x72\x74\x69\x6b\x65\x6c\40\75\40\x27{$artikelNummer}\x27\x20\101\116\x44\x20\164\x79\160\40\x3d\40\47\166\151\163\151\x74\x27\xa\40\40\x20\x20\x47\x52\117\x55\x50\x20\102\x59\x20\40\40\x20\x20\170\160\154\x75\x67\x69\156\137\141\x64\155\157\162\x72\x69\x73\x5f\160\x72\x6f\x5f\162\145\x63\145\156\x74\x5f\163\x61\154\x65\163\x2e\153\101\x72\x74\151\x6b\x65\x6c\xa\x20\x20\x20\40\xa\40\x20\x20\40\x29\40\101\x53\x20\157\x77\156\x56\x69\163\151\x74\x20\12\x20\40\40\x20\x4f\x4e\40\x6f\x77\156\126\151\163\151\164\x2e\x6b\x41\x72\x74\151\153\x65\x6c\x20\75\40\170\x70\154\165\x67\x69\156\137\x61\144\155\x6f\x72\162\151\x73\x5f\160\162\157\x5f\162\x65\143\145\x6e\164\x5f\x73\x61\x6c\x65\x73\56\x6b\x41\162\x74\151\x6b\145\154"; $query = "\123\x45\x4c\x45\103\124\40\40\x78\x70\154\165\147\x69\x6e\137\x61\x64\155\157\x72\x72\x69\163\x5f\160\x72\157\137\x72\145\143\x65\x6e\164\137\x73\x61\154\x65\163\56\153\101\162\164\x69\153\x65\x6c\40\101\x53\x20\153\x41\162\x74\x69\x6b\x65\154\x2c\xa{$visitVars}\x20{$ownVisitVars}\12\x46\x52\117\x4d\40\40\40\x20\40\40\40\40\x78\x70\x6c\165\x67\x69\156\137\x61\x64\x6d\x6f\x72\162\151\163\x5f\x70\162\157\137\162\x65\x63\145\156\x74\x5f\x73\x61\154\145\163\12{$visitsQuery}\xa{$ownVisitQuery}\xa\127\110\x45\x52\x45\40\x78\160\154\165\x67\x69\x6e\x5f\x61\x64\x6d\157\162\x72\151\x73\x5f\x70\x72\x6f\x5f\x72\x65\x63\145\x6e\164\137\163\x61\154\145\163\56\153\x41\162\x74\x69\x6b\145\x6c\40\75\40\x27{$artikelNummer}\47\xa\x47\x52\117\x55\x50\40\x42\x59\x20\x20\x20\40\170\x70\154\x75\147\x69\x6e\137\x61\144\155\x6f\x72\x72\x69\x73\x5f\160\x72\x6f\137\162\x65\143\145\156\164\x5f\163\x61\154\145\163\x2e\153\101\x72\x74\x69\x6b\x65\154"; $result = Shop::Container()->getDB()->query($query, 2); $ownVisit = (object) ["\143\x6f\x75\156\x74" => $result[0]->ownVisitCount ?? 0, "\141\x63\x74\151\157\156\104\141\x74\x65" => $result[0]->ownVisitDate ?? null]; if (!(($mode == 1 || $mode == 2) == !is_null($artikelNummer))) { goto Tx9rQ; } $real_visits = $result[0]->visitsCount ?? 0; Tx9rQ: if (!($mode == 2 || $mode == 3)) { goto cuOyN; } $demo_max = $oPlugin->getConfig()->getValue("\141\144\155\157\x72\162\151\163\x5f\160\162\157\137\x6d\141\x72\x6b\145\x74\151\156\x67\137\162\x65\x63\145\x6e\x74\x5f\x76\x69\163\x69\164\x73\137\x64\145\x6d\157\137\x6d\141\170\151\x6d\165\x6d"); $demo_visits = rand($demo_max * 0.7, $demo_max); $time = date("\107"); if ($time > 21 || $time < 7) { goto nAAD6; } if ($time >= 9 && $time <= 11 || $time >= 14 && $time <= 16) { goto CEmFG; } goto RntuL; nAAD6: $demo_visits = round($demo_visits * 0.2); goto RntuL; CEmFG: $demo_visits = round($demo_visits * 0.66); RntuL: cuOyN: if ($mode == 1) { goto LrXSJ; } if ($mode == 2) { goto psgGc; } if ($mode == 3) { goto HEjRu; } goto eSpY8; LrXSJ: $total = $real_visits; goto eSpY8; psgGc: $total = $real_visits + $demo_visits; goto eSpY8; HEjRu: $total = $demo_visits; eSpY8: if (!($total != 0)) { goto sLGmE; } if ($show_stock == "\x59" && $Artikel->fLagerbestand <= $max_stock) { goto CTVm0; } $display_stock = false; goto IFCrv; CTVm0: $display_stock = true; IFCrv: Shop::Smarty()->assign("\x61\144\x6d\x6f\162\162\x69\x73\x5f\x70\x72\x6f\x5f\x6d\x61\162\x6b\x65\164\x69\x6e\x67\137\162\x65\143\x65\156\164\137\166\x69\x73\151\164\163\137\x74\x6f\x74\x61\x6c", $total); Shop::Smarty()->assign("\141\144\x6d\157\162\x72\151\163\x5f\160\162\x6f\x5f\x6d\x61\162\x6b\145\164\151\x6e\x67\x5f\162\145\143\145\156\164\137\166\151\163\x69\x74\x73\137\x6c\151\x6d\151\x74\145\x64\137\163\164\157\x63\153", $display_stock); Shop::Smarty()->assign("\x61\x64\155\x6f\162\x72\x69\163\x5f\160\162\157\x5f\155\x61\162\153\145\164\x69\156\147\137\162\145\x63\x65\x6e\x74\x5f\166\x69\x73\x69\164\x73\x5f\x69\x63\x6f\156", $oPlugin->getConfig()->getValue("\x61\x64\155\157\162\162\151\163\x5f\x70\x72\157\x5f\155\x61\162\153\145\x74\151\156\147\x5f\162\145\x63\145\x6e\164\x5f\x76\151\x73\x69\164\x73\x5f\151\x63\x6f\x6e")); Shop::Smarty()->assign("\141\144\x6d\157\x72\162\x69\163\x5f\x70\x72\157\x5f\155\141\162\x6b\145\x74\151\x6e\147\x5f\162\145\143\x65\156\x74\x5f\166\x69\163\151\164\163\137\141\156\x69\x6d\x61\x74\151\x6f\x6e", $oPlugin->getConfig()->getValue("\x61\x64\155\x6f\x72\162\x69\163\137\160\x72\157\x5f\x6d\141\162\153\145\164\x69\156\147\137\x72\145\143\x65\156\x74\137\x76\151\x73\151\164\x73\137\141\156\x69\155\141\x74\x69\x6f\x6e")); $template = $oPlugin->getPaths()->getFrontendPath() . "\164\145\155\160\x6c\x61\x74\x65\163\x2f\x6d\141\162\153\x65\164\151\x6e\x67\x5f\162\145\143\x65\x6e\164\x5f\x76\151\163\151\164\163\x2e\x74\160\x6c"; $template = $smarty->fetch($template); cssSelector("\162\x65\x63\145\156\x74\137\166\x69\x73\151\x74\x73", $template); sLGmE: RecentSalesHelper::insertVisit($Artikel, $ownVisit, $artikelNummer, $period_begin_visits);