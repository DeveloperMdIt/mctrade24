window.amNotificationRequest=function(){var e,i={projectId:"admorris-push",messagingSenderId:"760724579446"};function n(){"granted"===Notification.permission?$("#permission_div").hide():"denied"===Notification.permission?($("#push_ok").hide(),$("#push_blocked").show(),$("#permission_div").show(),o()):($("#permission_div").show(),o())}function o(){$("#permission_bell").click((function(){$("#speech-bubble").fadeToggle(250)})),$("#allow-pushnotifications-button").on("click",(function(){t(),$("#speech-bubble").fadeOut(300)}))}function t(){Notification.requestPermission().then((function(n){console.debug(n),"granted"===n&&loadjs(["https://www.gstatic.com/firebasejs/6.6.2/firebase-app.js","https://www.gstatic.com/firebasejs/6.6.2/firebase-messaging.js"],"firebase",{success:function(){firebase.initializeApp(i),"serviceWorker"in navigator?navigator.serviceWorker.register(admorris_pluginpfad+"js/marketing_push_notifications/sw.js?v="+admorris_pluginversion).then((i=>{firebase.messaging().useServiceWorker(i),firebase.messaging().getToken().then((function(i){i?(function(i){var n={lang:e.lang,token:i,kArtikel:e.kArtikel,kKunde:e.kKunde,WarenkorbSumme:e.WarenkorbWarensumme};window.localStorage.setItem("Token",i),function(e,i,n,o){var t={name:e,params:[n,i]},r={io:JSON.stringify(t)};$.ajax({type:"POST",dataType:"json",url:window.admorris_shopUrl+"/io",data:r,success:function(e,i,n){o(e,i,n)},error:function(e,i,n){},complete:function(e,i){}})}("safePushNotificationToken","",n,(function(e,i){}))}(i),r(!0),$("#permission_div").fadeOut(250),firebase.messaging().onMessage((function(e){window.admorris_notification_url=e.data.click_action;var i=e.data.title,n={body:e.data.body,icon:e.data.icon,click_action:e.data.click_action,image:e.data.image};new Notification(i,n).addEventListener("click",(function(e){e.preventDefault(),window.open(window.admorris_notification_url,"_blank")}))}))):r(!1)})).catch((function(e){r(!1)}))})):console.error("Pushnotifications funktionieren nicht! Serviceworker nicht vorhanden. Bitte ueberpruefen Sie ob die Seite ueber https:// geladen wurde.")},error:function(e){console.error("Admorris Pro Error: Couldn't load Firebase")},before:function(e,i){i.setAttribute("defer","defer"),i.removeAttribute("async","async")}})})).catch((function(e){$("#push_ok").hide(),$("#push_blocked").show()}))}function r(e){window.localStorage.setItem("sentToServer",e?1:0)}return{init:function(i){"Notification"in window&&"serviceWorker"in navigator&&("direct"===(e=i).permissionRequest?t():n())},checkStatus:n,requestPermission:t}}();