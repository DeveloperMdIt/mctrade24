$(document).ready((function(){const e=100,t=10,r="autocomplete-list",n="smartsearch-dropdown",o="active",s={requestId:0,waitSuggestion:null,currentFocus:-1,isDropdownOpen:!1},a=$('input[name="qs"]');function c(t){const r=t.target;s.requestId++,clearTimeout(s.waitSuggestion),s.waitSuggestion=setTimeout((()=>{u(s.requestId,r),s.currentFocus=-1}),e)}function i(e){const n=document.getElementById(r),o=e.target;if("Delete"===e.key||"Backspace"===e.key)return s.requestId++,clearTimeout(s.waitSuggestion),void(s.waitSuggestion=setTimeout((()=>{u(s.requestId,o)}),t));if(!n||!s.isDropdownOpen)return;const a=n.querySelectorAll("a.dropdown-item"),c=a.length;switch(e.key){case"ArrowDown":if(e.preventDefault(),e.stopPropagation(),0===c)return;s.currentFocus=-1===s.currentFocus?0:(s.currentFocus+1)%c,d(a);break;case"ArrowUp":if(e.preventDefault(),e.stopPropagation(),0===c)return;s.currentFocus=-1===s.currentFocus?c-1:(s.currentFocus-1+c)%c,d(a);break;case"Enter":s.currentFocus>-1&&a[s.currentFocus]&&(e.preventDefault(),e.stopPropagation(),a[s.currentFocus].click())}}function u(e,t){const o=t.value.trim();if(!o)return void l();(async function(e){try{const t=new URL(window.admorris_shopUrl+"/admorris-smartsearch-suggest");t.searchParams.append("searchInput",e.searchInput);const r=await fetch(t,{method:"GET",headers:{Accept:"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(e){return console.error("Search request failed:",e),{}}})({searchInput:o}).then((function(c){var i;(i=c)&&0!==Object.keys(i).length&&e===s.requestId?function(e,t,o){const c=document.createElement("ul");if(c.setAttribute("id",r),c.setAttribute("class",n+" dropdown-menu show"),c.setAttribute("role","listbox"),c.setAttribute("aria-label","Search suggestions"),void 0!==e.hits?.hits&&e.hits.hits.length>0){e.hits.hits.forEach(((e,t)=>{const n=function(e,t,n){const o=document.createElement("li");o.setAttribute("role","presentation");const a=`${window.location.protocol}//${window.location.host}/${e._source.cSeo}`,c=document.createElement("a");c.setAttribute("href",a),c.setAttribute("role","option"),c.setAttribute("aria-selected","false"),c.setAttribute("tabindex","-1"),c.setAttribute("data-url",a),c.setAttribute("data-index",n),c.setAttribute("id",`option-${n}`),c.classList.add("dropdown-item");const i=function(e,t){const r=t.match(/\S+/g)||[];let n=e;return r.forEach((e=>{if(e.length>0&&!["b","<",">","/"].includes(e)){const t=new RegExp(e,"gi");n=n.replace(t,"</b>$&<b>")}})),n}(e._source.cName,t);return c.innerHTML=`<b>${i}</b>`,c.addEventListener("click",(function(){})),c.addEventListener("mouseenter",(()=>function(e){s.currentFocus=e;const t=document.getElementById(r);if(t){d(t.querySelectorAll("a.dropdown-item"))}}(n))),o.appendChild(c),o}(e,o,t);c.appendChild(n)})),l();const n=$(t).closest(".search__wrapper");n.length?n.append(c):$(t).after(c),a.attr("aria-expanded","true"),s.isDropdownOpen=!0,s.currentFocus=-1}else l()}(c,t,o):e===s.requestId&&l()})).catch((function(e){console.error("Error with search request:",e),l()}))}function d(e){if(!e||0===e.length)return;!function(e){Array.from(e).forEach((e=>{e.classList.remove(o),e.setAttribute("aria-selected","false")})),a.removeAttr("aria-activedescendant")}(e),s.currentFocus>=e.length&&(s.currentFocus=0),s.currentFocus<0&&(s.currentFocus=e.length-1);const t=e[s.currentFocus];t&&(t.classList.add(o),t.setAttribute("aria-selected","true"),a.attr("aria-activedescendant",t.id),t.scrollIntoView({block:"nearest",inline:"nearest"}))}function l(){const e=document.getElementsByClassName(n);Array.from(e).forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)})),a.attr("aria-expanded","false"),a.removeAttr("aria-activedescendant"),s.isDropdownOpen=!1,s.currentFocus=-1}a.attr({role:"combobox","aria-autocomplete":"list","aria-expanded":"false","aria-haspopup":"listbox","aria-controls":r}),a.on("keydown",i),a.on("input",c),a.on("focus",(function(){a.val().trim()&&c({target:a[0]})})),a.on("blur",(function(e){setTimeout((()=>{$(e.relatedTarget).closest(`#${r}`).length||l()}),150)})),document.addEventListener("keyup",(function(e){e.target.matches('input[name="qs"]')&&s.isDropdownOpen&&"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),l())}),!0),document.addEventListener("keydown",(function(e){e.target.matches('input[name="qs"]')&&s.isDropdownOpen&&i(e)}),!0),document.addEventListener("click",(function(e){$(e.target).closest(".search__wrapper, #"+r).length||l()}))}));