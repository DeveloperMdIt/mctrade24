<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Catalog\Hersteller; use JTL\Checkout\Bestellung; use JTL\Helpers\Text; use JTL\Media\Image\Product; use JTL\Media\Image; use JTL\Shop; use JTL\Template\XMLReader; if (!function_exists("\163\x65\x74\x54\x79\x70\x65\x73")) { goto uyuK_; } return; uyuK_: function triggerHelperFunctionsDeprecationError(string $functionName, bool|string $newFunction = false) { $msg = "{$functionName}\40\x69\x73\x20\144\x65\160\162\145\x63\141\164\x65\x64\40\141\x6e\144\40\x73\x68\x6f\x75\x6c\x64\x20\156\x6f\x74\40\x62\x65\x20\165\x73\x65\144\x20\141\156\171\x6d\x6f\162\x65\x2e"; if (!$newFunction) { goto hR7Ez; } $msg .= "\40\x53\167\151\x74\x63\x68\x20\x74\x6f\40\165\x73\x69\156\x67\x20{$newFunction}\40\151\x6e\163\164\x65\x61\x64\x2e"; hR7Ez: trigger_error($msg, E_USER_DEPRECATED); } function encode_with_specialchars($string) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\x54\171\160\x65\x43\157\x6e\166\x65\x72\164\145\162\72\72\x65\156\x63\157\144\145\x5f\x77\x69\x74\x68\x5f\163\x70\145\143\151\141\154\x63\x68\x61\162\163\x28\51"); return htmlspecialchars($string, ENT_COMPAT | ENT_HTML5, "\125\x54\106\55\x38", false); } function encode_entities($string) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\124\171\x70\x65\103\157\156\166\x65\162\x74\x65\162\72\x3a\x65\x6e\x63\x6f\144\145\137\x65\156\x74\x69\164\151\145\x73\50\51"); return htmlspecialchars_decode(htmlentities($string, ENT_COMPAT, "\125\x54\106\x2d\70", false), ENT_COMPAT); } function utf8_win_convert_recursive($data, $encode = true, $copy = false) { triggerHelperFunctionsDeprecationError(__FUNCTION__); return $data; } function convertStringToBool($value) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\124\x79\x70\145\103\x6f\156\166\145\x72\164\145\162\x3a\x3a\143\157\156\x76\x65\x72\164\123\164\162\x69\156\x67\x54\x6f\102\157\157\154\x28\51"); return $value === "\131" ? true : false; } function convertBoolToString($value) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\124\171\x70\145\x43\x6f\156\x76\x65\x72\x74\x65\162\72\x3a\x63\157\x6e\x76\145\x72\x74\102\157\157\x6c\124\x6f\x53\164\x72\151\156\x67\x28\x29"); return $value === true ? "\131" : "\116"; } function convertIntegerToBool($value) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\x54\171\x70\x65\x43\157\156\x76\145\162\x74\145\162\x3a\x3a\143\x6f\x6e\x76\145\x72\x74\111\156\x74\x65\147\x65\x72\x54\157\x42\x6f\x6f\154\50\51"); return $value == 1 ? true : false; } function convertBoolToInteger($value) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\124\171\160\145\x43\x6f\x6e\x76\x65\162\164\x65\x72\72\72\x63\x6f\156\166\x65\x72\164\102\157\157\x6c\x54\157\111\156\x74\x65\147\145\162\x28\51"); return $value === true ? 1 : 0; } function getSpecialCharFn($decode) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\x54\x79\x70\145\x43\x6f\156\166\x65\x72\164\x65\162\72\x3a\147\x65\x74\x53\160\x65\143\x69\x61\154\x43\x68\x61\162\106\156\x28\51"); return function ($text) use($decode) { return $decode ? htmlspecialchars_decode($text) : encode_with_specialchars($text); }; } function getBoolStringConversionFn($decode) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\x54\171\160\x65\103\157\x6e\x76\x65\x72\164\145\x72\72\x3a\x67\x65\x74\102\x6f\x6f\x6c\123\x74\x72\x69\156\x67\x43\157\156\166\145\162\x73\151\x6f\156\106\156\50\51"); return function ($val) use($decode) { return $decode ? convertBoolToString($val) : convertStringToBool($val); }; } function setTypes($settings, $types, $convertBoolString = null, $convertSpecialchars = null, $decode = null) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\124\171\160\x65\103\157\156\x76\145\162\164\145\x72\x3a\x3a\x73\x65\164\x54\171\x70\145\x73\50\x29"); $toArray = false; if (!is_array($settings)) { goto ckkKF; } $toArray = true; $settings = (object) $settings; ckkKF: $specialchars_encode_decode = function ($text) use($decode) { return $decode ? htmlspecialchars_decode($text) : encode_with_specialchars($text); }; $bool_convert = function ($val) use($decode) { return $decode ? convertBoolToString($val) : convertStringToBool($val); }; $doConversion = function ($type, $func) use(&$settings, $specialchars_encode_decode, $bool_convert) { if (empty($type)) { goto R1uSp; } foreach ($type as $key => $value) { if (is_array($value)) { goto UMqjf; } if (isset($settings->{$value})) { goto tRUg3; } goto wnEDz; tRUg3: $settings->{$value} = $func($settings->{$value}, $key); goto cy_A6; UMqjf: foreach ($type[$key] as $subkey => $subvalue) { if (!isset($settings->{$key}[$subvalue])) { goto CWxiW; } $settings->{$key}[$subvalue] = $func($settings->{$key}[$subvalue], $subkey); CWxiW: KnCBR: } a3bJP: cy_A6: wnEDz: } PLqAc: R1uSp: }; if (empty($types)) { goto TfxAJ; } foreach ($types as $key => $value) { if (!isset($settings->{$key})) { goto LJuvH; } settype($settings->{$key}, $value); LJuvH: S4sBS: } Fm2U2: TfxAJ: $doConversion($convertSpecialchars, function ($value) use($specialchars_encode_decode) { return $specialchars_encode_decode($value); }); $doConversion($convertBoolString, function ($value) use($bool_convert) { return $bool_convert($value); }); if (!$toArray) { goto x71Bm; } return (array) $settings; x71Bm: return $settings; } function getPluginId() { static $pluginId = null; if (!is_null($pluginId)) { goto IVZmz; } $plugin = Shop::get("\x6f\x70\154\165\x67\151\x6e\137\x61\x64\155\157\162\x72\x69\163\x5f\x70\162\x6f"); if (empty($plugin)) { goto Xr2Ko; } return $pluginId = $plugin->getId(); Xr2Ko: $plugin = Shop::Container()->getDB()->select("\x74\x70\x6c\x75\147\151\x6e", "\x63\x50\x6c\x75\147\x69\156\111\x44", "\141\144\155\157\162\162\x69\163\137\x70\x72\x6f"); $pluginId = $plugin->kPlugin; IVZmz: return $pluginId; } function dateTimeStringToIso($date) { triggerHelperFunctionsDeprecationError(__FUNCTION__, "\124\x79\160\145\103\157\156\x76\x65\x72\x74\145\162\x3a\x3a\144\141\164\145\x54\x69\x6d\145\123\164\162\x69\156\147\x54\157\111\163\157\50\x29"); $dateObj = new \DateTime($date); return $dateObj->format("\143"); } function admorrisProPlugin_imageSize($imagePath) { list($width, $height) = \getimagesize(\PFAD_ROOT . "\57" . $imagePath); $size = new \stdClass(); $size->width = $width; $size->height = $height; return $size; } function isNovaTemplateActive() { static $active = null; if (!is_null($active)) { goto xnfvo; } $template = Shop::Container()->getTemplateService()->getActiveTemplate(); if ($template->getName() == "\116\117\126\101" || !empty($template->getParent()) && $template->getParent() == "\x4e\117\126\101") { goto XyRgk; } $active = false; goto TS38B; XyRgk: $active = true; TS38B: xnfvo: return $active; } function renderIcon($iconId, $classes = '', $title = '', $fixedSize = false) { goto vfY_O; urH1Q: return "\x3c\163\160\141\x6e\40\143\154\x61\x73\163\75\47{$classes}\x27" . (!empty($title) ? "\x74\151\x74\154\x65\x3d\47{$title}\x27" : '') . "\76" . $toRender . "\x3c\57\163\160\x61\156\76"; goto zcydi; jOnfi: $multiplier = floatval($multiplier); return "\x3c\163\x70\x61\x6e\40\x63\154\x61\163\x73\75\x27{$classes}\x27\x20\x73\x74\x79\154\x65\75\x27\x2d\x2d\x73\151\172\145\x3a\x20{$multiplier}\47" . (!empty($title) ? "\164\x69\x74\x6c\145\x3d\47{$title}\47" : '') . "\x3e" . $toRender . "\74\57\163\160\x61\156\x3e"; zcydi: goto ol0TB; vfY_O: $iconsUsed = Shop::get("\x61\144\155\111\x63\157\x6e\x73\x55\163\145\144"); $iconData = $iconsUsed[$iconId]; if (!($iconData->iconFamily === "\156\x6f\111\x63\157\x6e")) { goto lKHqK; } return; lKHqK: $multiplier = $iconData->sizeMultiplier; if (isTemplateActive()) { goto k12Ad; } if ($iconData->pathOrSvg[0] == "\x2f") { goto vObjr; } $toRender = $iconData->pathOrSvg; goto F22ei; goto dDfFl; dDfFl: vObjr: if (!file_exists(PFAD_ROOT . $iconData->pathOrSvg)) { goto FzD11; } $toRender = file_get_contents(PFAD_ROOT . $iconData->pathOrSvg); FzD11: F22ei: goto gndOm; k12Ad: $toRender = useIcon($iconId); gndOm: if (($multiplier !== null || !empty($multiplier)) && !$fixedSize) { goto jOnfi; } goto urH1Q; ol0TB: } function useIcon($id) { $customTemplateSettings = Shop::get("\x61\x64\x6d\x6f\162\162\151\x73\55\143\x75\x73\164\x6f\155\x2d\x74\145\155\160\x6c\x61\x74\145\x2d\163\x65\x74\164\151\156\147\x73"); $hash = $customTemplateSettings->iconSpriteHash; $spritemapURL = Shop::getURL() . "\57\164\x65\155\160\154\141\x74\x65\x73\57\141\144\155\157\162\162\151\x73\137\160\x72\157\57\151\143\157\156\163\x2e\x73\x76\147\x3f\x76\x3d" . $hash; $user_agent = $_SERVER["\x48\x54\124\120\137\125\x53\105\122\137\101\107\105\116\x54"]; if (stripos($user_agent, "\x43\150\162\157\155\145") !== false) { goto uFZg_; } if (stripos($user_agent, "\x53\141\x66\x61\x72\151") !== false) { goto Bm2jq; } goto EU7S3; uFZg_: goto EU7S3; Bm2jq: $version = explode("\57", $user_agent)[3]; $version = str_replace("\40\123\141\146\141\162\x69", '', $version); $releases = explode("\56", $version); if (!(intval($releases[0]) <= 12)) { goto cA2Ph; } return "\74\163\166\147\76\74\x75\163\145\x20\x78\154\151\x6e\153\x3a\x68\162\145\146\75\42\43\151\x63\x6f\156\x2d{$id}\42\x2f\x3e\74\x2f\163\x76\x67\x3e"; cA2Ph: EU7S3: return "\x3c\163\166\x67\76\74\165\x73\x65\40\150\x72\x65\x66\x3d\42\x23\x69\143\157\x6e\55{$id}\x22\x2f\76\x3c\57\x73\166\147\76"; } function usePaymentIcon($id) { $customTemplateSettings = Shop::get("\141\x64\155\157\x72\162\x69\x73\55\x63\165\163\164\157\155\x2d\164\145\x6d\x70\154\x61\164\145\55\163\x65\164\x74\151\156\x67\163"); $hash = $customTemplateSettings->paymentIconsSpriteHash; $spritemapURL = Shop::getURL() . "\x2f\164\x65\155\x70\x6c\141\x74\145\163\x2f\141\144\x6d\x6f\x72\x72\x69\163\x5f\160\162\157\57\x70\141\171\x6d\145\156\164\x2d\151\143\x6f\156\x73\56\x73\166\x67\77\x76\75" . $hash; $user_agent = $_SERVER["\110\124\x54\x50\137\125\123\105\122\137\x41\107\105\116\x54"]; if (stripos($user_agent, "\x43\x68\162\x6f\x6d\145") !== false) { goto wYcQE; } if (stripos($user_agent, "\123\x61\x66\141\x72\151") !== false) { goto SdoYF; } goto LkpCH; wYcQE: goto LkpCH; SdoYF: $version = explode("\57", $user_agent)[3]; $version = str_replace("\40\123\141\146\x61\162\x69", '', $version); $releases = explode("\56", $version); if (!(intval($releases[0]) <= 12)) { goto UdQdE; } return "\74\x73\x76\x67\76\74\165\x73\145\40\170\154\151\x6e\153\72\x68\x72\145\146\x3d\42\43\160\x61\171\x6d\x65\156\164\x49\x63\x6f\x6e\55{$id}\42\57\76\x3c\x2f\163\166\x67\x3e"; UdQdE: LkpCH: return "\x3c\x73\x76\147\x3e\74\165\163\x65\x20\x68\x72\x65\x66\x3d\42\x23\160\x61\x79\x6d\x65\156\x74\x49\143\x6f\156\x2d{$id}\42\x2f\76\74\x2f\163\x76\147\76"; } function removeSpecialPosFromBasket($responsibility) { $cart = $_SESSION["\x57\x61\162\145\x6e\153\157\162\x62"]; foreach ($cart->PositionenArr as $i => $item) { if (!(isset($item->nPosTyp) && (int) $item->nPosTyp === 4 && $item->cResponsibility === $responsibility)) { goto ymgyC; } unset($cart->PositionenArr[$i]); ymgyC: LeJtc: } St1WX: $cart->PositionenArr = \array_merge($cart->PositionenArr); $_SESSION["\x57\141\x72\x65\x6e\x6b\x6f\162\x62"] = $cart; } function createStmtValuesString($data) { $values = (array) $data; $array = array_keys($values); $output = "\50"; foreach ($array as $key => $item) { if ($key === count($values) - 1) { goto e3KQb; } $output .= "\x3a" . $item . "\54\x20"; goto ZzM98; e3KQb: $output .= "\72" . $item; ZzM98: eVvtp: } VSXd3: $output .= "\51"; return $output; } function getOPCImageSrcSet($path) { goto IxRl4; gJKOd: if (pathinfo($path, PATHINFO_EXTENSION) === "\167\145\x62\x70") { goto XyjS5; } array_push($fileList->default, $origin); goto K_Hte; XyjS5: array_push($fileList->webp, $origin); K_Hte: usort($fileList->webp, function ($a, $b) { return $a->width <=> $b->width; }); usort($fileList->default, function ($a, $b) { return $a->width <=> $b->width; }); if (!empty($fileList->default)) { goto A3qYR; } $fileList->default = $fileList->webp; goto fK1dl; fK1dl: A3qYR: return $fileList; goto jS2Uj; rQYv3: $subDir = str_replace(STORAGE_OPC, '', $dir); $glob = glob(PFAD_ROOT . STORAGE_OPC . "\x2e\x73\x72\x63\163\145\164\163\57" . $subDir . "\x2f" . preg_quote($fileName, "\x2f") . "\x2a"); goto EdU3P; oOB0B: $glob = glob(PFAD_ROOT . STORAGE_OPC . "\x2e\x73\x72\143\163\145\x74\x73\57" . preg_quote($fileName, "\x2f") . "\x2a"); EdU3P: $fileList = new \stdClass(); $fileList->webp = []; $fileList->default = []; foreach ($glob as $file) { if (!(preg_match("\x2f" . preg_quote($fileName, "\57") . "\55\133\60\x2d\x39\x5d\173\62\x2c\x34\175\x78\x5b\x30\x2d\x39\135\x7b\62\54\64\x7d\x2e\x5c\x77\53\x2f", $file) === 1)) { goto lHlso; } $absolute = str_replace(PFAD_ROOT, '', $file); $obj = new \stdClass(); $obj->path = Shop::getUrl() . "\57" . $absolute; list($width, $height) = \getimagesize($file); $obj->width = $width; $obj->height = $height; if (pathinfo($file, PATHINFO_EXTENSION) === "\x77\x65\x62\160") { goto snkA3; } array_push($fileList->default, $obj); goto joZqi; snkA3: array_push($fileList->webp, $obj); joZqi: lHlso: TWP_7: } goto N3hUo; N3hUo: U4BOb: if (!(strpos($path, "\x2f") === 0)) { goto K3Ytj; } $path = substr($path, 1); K3Ytj: $fullPath = PFAD_ROOT . $path; $origin = new \stdClass(); $origin->path = Shop::getUrl() . "\x2f" . $path; list($width, $height) = \getimagesize($fullPath); $origin->width = $width; $origin->height = $height; goto gJKOd; IxRl4: if (!empty($path)) { goto QEnNa; } return; QEnNa: $path = urldecode($path); $fileName = pathinfo($path, PATHINFO_FILENAME); $dir = pathinfo($path, PATHINFO_DIRNAME); if (!($dir[0] === "\x2f")) { goto ITdMW; } $dir = substr($dir, 1); ITdMW: if ($dir . "\x2f" === STORAGE_OPC) { goto oOB0B; } goto rQYv3; jS2Uj: } function getOPCImageSrcSetString($srcSet, $scaling = 0) { $output = null; $scaled = null; foreach ($srcSet as $file) { $scaled = ceil($file->width * (1 - $scaling)); if (is_null($output)) { goto dIwe7; } $output .= "\54\x20"; dIwe7: if (empty($file->path)) { goto Agahc; } $output .= $file->path . "\x20" . $scaled . "\x77"; Agahc: OFPab: } cek3z: return $output; } function imageSizeFromSrcset($srcsetAttr) { $sizeSets = explode("\x2c", $srcsetAttr); $sizeSets = array_reverse($sizeSets); foreach ($sizeSets as $item) { $imgUrl = explode("\40", trim($item))[0]; $size = imageSize($imgUrl); if (empty($size)) { goto UHd0G; } return $size; UHd0G: VVevE: } YNOPr: } function imageSize($imageUrl) { goto dsOJ_; ODf1I: goto VoAKo; BgHvN: $width = str_replace("\160\x78", '', (string) $xmlattributes->width); $height = str_replace("\160\x78", '', (string) $xmlattributes->height); VoAKo: QXObS: $size = new \StdClass(); $size->width = $width; $size->height = $height; return $size; goto pWLUT; dsOJ_: $imagePath = PFAD_ROOT . str_replace(Shop::getURL() . "\57", '', $imageUrl); if (!is_file($imagePath)) { goto hwfVr; } if (pathinfo($imagePath, PATHINFO_EXTENSION) === "\x73\166\x67") { goto vHzNx; } list($width, $height) = \getimagesize($imagePath); goto QXObS; hwfVr: $imageUrl = str_replace(Shop::getURL() . "\x2f", '', $imageUrl); $path = mb_strpos($imageUrl, PFAD_BILDER) === 0 ? PFAD_ROOT . $imageUrl : $imageUrl; $req = Product::toRequest($path); if (is_object($req)) { goto dOO9_; } goto zYnTB; ce5Gh: $max_height = $size["\150\x65\x69\147\x68\x74"]; $old_width = $width; $old_height = $height; $scale = min($max_width / $old_width, $max_height / $old_height); $width = ceil($scale * $old_width); $height = ceil($scale * $old_height); goto QXObS; vHzNx: $svg = file_get_contents($imagePath); $xmlget = simplexml_load_string($svg); goto Qm309; Qm309: $xmlattributes = $xmlget->attributes(); if (!empty($xmlattributes->width)) { goto BgHvN; } if (!empty($xmlattributes->viewBox)) { goto NXFLb; } return false; goto ST2VK; NXFLb: $vbox = explode("\x20", (string) $xmlattributes->viewBox); $width = $vbox[2]; $height = $vbox[3]; ST2VK: goto ODf1I; zYnTB: return null; dOO9_: $settings = Image::getSettings(); $refImage = $req->getRaw(); if (!($refImage === null)) { goto QKw7_; } return null; QKw7_: list($width, $height, $type, $attr) = \getimagesize($refImage); $size = $settings["\163\x69\172\145"][$req->getSizeType()]; $max_width = $size["\x77\151\x64\164\x68"]; goto ce5Gh; pWLUT: } function base64_encode_image($imageUrl) { if (!\JTL\Media\Image::hasWebPSupport()) { goto b07WU; } $imageUrl = preg_replace("\x2f\134\56\x28\x3f\x69\51\50\x6a\x70\x67\174\x70\156\147\x29\57", "\x2e\167\145\142\160", $imageUrl); b07WU: $imagePath = \PFAD_ROOT . str_replace(Shop::getURL() . "\57", '', $imageUrl); if (file_exists($imagePath)) { goto Pfw4y; } return; Pfw4y: $ext = pathinfo($imagePath, \PATHINFO_EXTENSION); $im = file_get_contents($imagePath); return "\x64\141\x74\x61\x3a\x69\155\x61\x67\x65\x2f{$ext}\73\x62\x61\x73\145\66\x34\x2c" . base64_encode($im); }