<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Shop; define("\x53\105\x52\x56\105\x52\137\101\x50\111\137\x4b\x45\131", "\x41\x49\172\141\x53\x79\101\x30\157\x39\x4f\x55\x72\63\151\63\x4c\x45\115\163\151\x76\x53\106\x39\x68\x36\66\117\67\67\x73\x30\147\160\x52\65\130\163"); function getTokens($pushLang) { $registrationIds = []; $token_data = Shop::Container()->getDB()->query("\x53\x45\114\x45\103\124\40\52\40\x46\x52\x4f\115\x20\x78\x70\x6c\165\147\151\156\x5f\x61\x64\x6d\x6f\x72\162\151\163\137\x70\x72\x6f\137\160\x75\x73\x68\x5f\x6e\157\x74\x69\x66\x69\143\141\164\151\x6f\156\x5f\x74\157\x6b\145\156\x20\x57\110\105\122\x45\40\154\x61\x6e\x67\x20\75\x20\x27{$pushLang}\47", 2); foreach ($token_data as $token) { $registrationIds[] = $token->token; fXZ88: } QDLxw: return $registrationIds; } function admSendPushMessage($data) { goto z5VcS; Bq4pB: $response = json_decode($response, true); $results = $response["\x72\145\163\165\x6c\x74\x73"]; $notRegistered = []; $toReturn["\163\165\x63\143\145\163\163"] = $response["\163\165\143\x63\x65\163\x73"]; $toReturn["\x66\141\151\x6c\x75\x72\145"] = $response["\146\x61\151\154\x75\x72\x65"] - count($notRegistered); return $toReturn; KzSrB: goto k8bRp; z5VcS: $shopUrl = Shop::getURL(); $pushTitle = $data["\164\151\x74\x6c\x65"]; $pushBody = $data["\x62\157\x64\x79"]; $pushIcon = $shopUrl . $data["\151\x63\x6f\156"]; $pushImage = $shopUrl . $data["\151\x6d\x61\x67\145"]; $pushUrl = $data["\x75\162\x6c"]; $pushLang = $data["\x6c\x61\156\x67"]; $registrationIds = getTokens($pushLang); if ($registrationIds != []) { goto JJKm2; } return false; goto Y89y_; Y89y_: goto KzSrB; JJKm2: $header = ["\101\x75\x74\150\x6f\x72\x69\x7a\141\164\x69\157\x6e\x3a\40\x4b\145\x79\x3d" . SERVER_API_KEY, "\103\x6f\x6e\164\145\x6e\x74\x2d\124\x79\x70\145\x3a\40\x41\160\x70\x6c\x69\x63\x61\164\x69\157\156\57\152\163\x6f\x6e"]; $notification = ["\x74\x69\164\x6c\x65" => $pushTitle, "\x62\x6f\x64\x79" => $pushBody, "\x69\143\157\x6e" => $pushIcon, "\x63\x6c\x69\143\x6b\x5f\141\143\x74\x69\157\x6e" => $pushUrl, "\151\155\141\147\x65" => $pushImage]; $payload = ["\x72\145\x67\x69\x73\164\x72\x61\164\x69\157\x6e\x5f\x69\144\x73" => $registrationIds, "\144\x61\164\x61" => $notification]; $curl = curl_init(); curl_setopt_array($curl, array(CURLOPT_URL => "\x68\164\x74\x70\x73\72\57\57\146\x63\x6d\56\147\157\157\x67\x6c\x65\x61\160\x69\x73\56\x63\x6f\155\57\x66\143\x6d\57\x73\145\156\x64", CURLOPT_RETURNTRANSFER => true, CURLOPT_CUSTOMREQUEST => "\x50\x4f\123\x54", CURLOPT_POSTFIELDS => json_encode($payload), CURLOPT_HTTPHEADER => $header)); $response = curl_exec($curl); $err = curl_error($curl); curl_close($curl); goto Bq4pB; k8bRp: }