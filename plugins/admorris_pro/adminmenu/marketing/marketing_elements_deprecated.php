<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\DB\ReturnType; use JTL\Shop; use JTL\IO\IOError; use Plugin\admorris_pro\Utils\TypeConverter; function admGetElements($categoryID) { $data = Shop::Container()->getDB()->query("\123\105\x4c\105\103\124\x20\52\40\x46\122\117\115\x20\170\x70\154\165\x67\151\x6e\x5f\141\144\155\157\x72\x72\151\163\x5f\160\162\157\137\x65\154\x65\155\145\156\x74\x73\40\127\x48\x45\122\x45\x20\143\141\x74\145\x67\x6f\162\171\x49\x44\40\75\x20{$categoryID}\x20\117\x52\x44\105\x52\40\102\131\40\40\140\x78\160\x6c\165\x67\x69\156\137\141\x64\155\157\162\x72\151\163\x5f\x70\x72\x6f\137\x65\154\x65\x6d\145\156\x74\163\140\x2e\140\160\162\x69\157\162\151\164\171\140\40\x44\x45\123\x43\40", 2); foreach ($data as $key => $element) { $element->active = TypeConverter::convertIntegerToBool($element->active); $element->startTime = TypeConverter::dateTimeStringToIso($element->startTime); $element->endTime = TypeConverter::dateTimeStringToIso($element->endTime); iiR2Z: } PBU7z: return $data; } function admSaveElements($data) { $data = $data; $startDate = strtotime($data["\163\164\141\162\x74\x54\x69\x6d\145"]); $startDate = date("\131\x2d\x6d\x2d\x64\x20\110\72\x69\72\x73", $startDate); $endDate = strtotime($data["\x65\x6e\144\x54\151\x6d\x65"]); $endDate = date("\131\55\x6d\55\x64\x20\110\72\x69\72\163", $endDate); $content = TypeConverter::encode_entities($data["\x63\x6f\156\x74\145\156\164"]); $active = TypeConverter::convertBoolToInteger($data["\141\143\x74\x69\166\145"]); $query = "\xa\x20\x20\x20\40\122\x45\120\114\101\103\105\x20\111\116\124\117\40\170\x70\x6c\165\147\x69\x6e\137\x61\144\x6d\x6f\x72\x72\151\163\137\x70\x72\157\137\x65\154\145\155\145\x6e\x74\x73\x20\12\x20\x20\x20\x20\x20\40\x56\x41\x4c\125\105\x53\x20\50\xa\40\x20\x20\40\x20\40\x20\x20\x3a\x69\x64\54\12\x20\40\x20\x20\x20\x20\x20\x20\72\160\x72\151\x6f\x72\151\x74\x79\54\40\12\x20\x20\x20\40\x20\40\40\40\x3a\143\x61\164\x65\147\157\162\x79\x49\104\54\40\12\x20\40\40\40\x20\40\x20\x20\72\156\141\155\x65\x2c\x20\12\x20\40\x20\x20\x20\x20\40\40\x3a\141\x63\164\151\166\145\54\40\xa\40\x20\x20\x20\40\40\40\40\x3a\164\x65\155\x70\x6c\x61\x74\x65\x2c\12\x20\x20\40\x20\40\40\40\x20\x3a\163\x74\x61\162\x74\x44\x61\164\x65\54\x20\12\40\40\40\x20\x20\40\40\40\72\x65\156\144\104\x61\164\x65\x2c\xa\x20\x20\x20\x20\x20\x20\40\x20\72\163\145\x6c\x65\143\164\157\x72\x2c\40\xa\40\x20\x20\40\x20\x20\40\x20\72\x73\145\x6c\x65\x63\x74\157\x72\124\171\x70\x65\x2c\40\12\40\x20\40\40\x20\40\x20\x20\x3a\164\162\x69\x67\x67\145\x72\106\x69\x6c\164\145\x72\x4f\x70\145\x72\x61\164\157\x72\54\x20\12\40\40\40\x20\40\x20\40\x20\x3a\143\x6f\156\x74\145\x6e\164\12\x20\40\40\40\40\40\x29"; $preparationArr = ["\x69\144" => $data["\x69\x64"], "\160\162\151\157\x72\151\x74\x79" => $data["\160\162\x69\x6f\162\151\x74\x79"], "\143\141\x74\145\x67\x6f\162\x79\x49\x44" => $data["\143\141\164\x65\147\157\162\x79\x49\104"], "\x6e\x61\x6d\145" => $data["\156\141\x6d\145"], "\141\x63\164\x69\x76\145" => $active, "\x74\145\155\160\x6c\141\x74\x65" => $data["\x74\145\x6d\x70\x6c\x61\x74\145"], "\163\164\x61\162\164\x44\x61\x74\x65" => $startDate, "\x65\x6e\144\x44\141\x74\x65" => $endDate, "\x73\145\154\145\x63\x74\x6f\x72" => $data["\163\x65\154\145\143\164\157\x72"], "\x73\x65\154\x65\143\x74\x6f\162\x54\x79\160\x65" => $data["\x73\x65\154\145\x63\164\157\162\124\x79\160\x65"], "\164\x72\x69\x67\x67\145\x72\106\151\x6c\164\145\162\117\160\145\x72\x61\164\x6f\x72" => $data["\x74\x72\151\147\147\x65\x72\x46\x69\x6c\164\x65\162\x4f\x70\x65\162\141\164\x6f\x72"], "\143\x6f\156\x74\x65\x6e\164" => $content]; $response = Shop::Container()->getDB()->getAffectedRows($query, $preparationArr); if (!($response > 0)) { goto I2hUF; } return true; I2hUF: return false; } function admAddElement($id) { $id = $id; $elementId = Shop::Container()->getDB()->query("\111\116\123\x45\x52\124\40\111\116\124\117\40\x60\170\x70\154\x75\x67\151\x6e\137\x61\144\x6d\x6f\162\x72\x69\x73\x5f\160\162\157\137\145\x6c\x65\155\x65\x6e\164\163\x60\40\x28\xa\x20\40\x20\40\40\40\x20\40\140\151\144\140\x20\x2c\12\40\x20\x20\40\x20\40\40\x20\140\x70\x72\x69\x6f\162\151\164\x79\140\x20\x2c\xa\40\x20\x20\40\x20\x20\40\x20\140\143\x61\164\145\x67\x6f\x72\x79\111\x44\140\x20\x2c\xa\x20\40\x20\40\40\40\x20\40\x60\156\x61\155\x65\x60\40\x2c\12\40\40\x20\40\x20\40\x20\40\140\x61\143\x74\x69\x76\145\x60\x20\54\xa\x20\x20\40\x20\40\40\40\40\x60\x74\145\x6d\160\154\141\x74\x65\140\40\x2c\xa\x20\x20\40\x20\40\40\40\x20\140\163\x74\x61\x72\x74\124\151\x6d\145\x60\x20\x2c\12\x20\x20\x20\40\40\40\x20\40\140\145\x6e\x64\124\x69\155\x65\140\x20\x2c\xa\x20\40\x20\40\x20\x20\40\40\140\163\145\x6c\145\x63\164\x6f\162\140\x20\54\xa\x20\40\40\x20\x20\40\40\x20\x60\163\x65\154\x65\x63\x74\157\x72\x54\171\160\145\140\x20\54\xa\40\40\x20\40\40\40\40\40\140\x74\x72\x69\147\147\145\162\106\x69\x6c\x74\145\162\117\160\145\162\141\x74\157\x72\x60\x20\54\12\x20\40\x20\40\40\x20\x20\x20\140\x63\157\156\x74\145\x6e\164\140\12\40\40\x20\40\x20\x20\x20\40\x29\xa\40\x20\40\x20\x20\x20\40\x20\x56\x41\x4c\x55\105\x53\x20\x28\xa\40\x20\x20\40\40\x20\x20\40\116\125\114\x4c\x20\x2c\40\x20\47\x30\47\x2c\40\40\x27{$id}\x27\54\x20\x20\x27\116\145\165\145\x73\x20\x45\x6c\x65\155\145\156\164\x27\54\x20\x20\x27\x30\47\x2c\x20\40\x27\x63\x6f\x64\x65\47\x2c\40\40\x27\x32\60\61\71\x2d\x30\61\55\60\x31\40\60\61\x3a\60\x31\x3a\60\x31\47\54\x20\x20\x27\62\60\63\x30\x2d\x30\x31\x2d\60\61\x20\x30\x31\x3a\60\61\x3a\60\61\47\x2c\x20\40\47\x62\x6f\x64\x79\x27\x2c\x20\40\47\x61\160\x70\145\x6e\x64\47\x2c\40\40\x27\x61\156\x64\47\x2c\40\116\x55\x4c\x4c\12\40\40\40\40\40\40\40\40\51\x3b", ReturnType::LAST_INSERTED_ID); header("\x43\157\156\x74\x65\x6e\164\55\164\171\160\x65\x3a\x20\x61\x70\160\x6c\151\143\x61\164\151\157\x6e\x2f\152\163\157\156"); return $elementId; } function admDeleteElement($data) { $data = $data; Shop::Container()->getDB()->delete("\x78\160\154\x75\x67\151\156\x5f\141\x64\x6d\x6f\162\x72\x69\x73\x5f\x70\162\157\x5f\x65\154\x65\155\x65\156\164\163", "\x69\x64", (int) $data); Shop::Container()->getDB()->delete("\x78\160\x6c\165\147\151\x6e\x5f\141\144\155\x6f\162\162\151\x73\x5f\x70\162\x6f\137\145\154\145\155\145\x6e\x74\163\x5f\x74\162\x69\x67\x67\x65\162\x5f\x66\x69\x6c\164\x65\162", "\x65\x6c\145\155\x65\156\x74\111\144", (int) $data); header("\x43\x6f\156\x74\145\156\x74\55\x74\171\x70\x65\72\40\141\x70\160\x6c\x69\143\x61\x74\x69\157\x6e\57\x6a\163\157\x6e"); return true; } function admCopyElement($data) { $element = Shop::Container()->getDB()->select("\x78\160\x6c\165\x67\151\x6e\x5f\x61\x64\155\x6f\x72\x72\151\163\x5f\160\162\157\137\145\x6c\145\155\145\156\x74\163", "\151\x64", $data); $element->id = ''; $newID = Shop::Container()->getDB()->insert("\x78\160\154\x75\147\x69\x6e\137\141\x64\x6d\157\x72\162\151\x73\x5f\x70\162\x6f\137\145\x6c\145\x6d\x65\156\164\163", $element); $elementFilterData = Shop::Container()->getDB()->selectAll("\x78\160\154\165\147\x69\x6e\x5f\141\x64\155\x6f\162\x72\151\163\137\x70\x72\x6f\137\x65\x6c\x65\155\145\156\x74\x73\137\164\x72\151\147\147\x65\x72\137\146\151\x6c\x74\145\x72", "\x65\x6c\145\x6d\x65\x6e\x74\x49\x64", $data); foreach ($elementFilterData as $key => $elementFilter) { $elementFilterData[$key]->id = ''; $elementFilterData[$key]->elementId = $newID; $result = Shop::Container()->getDB()->insert("\x78\x70\x6c\x75\147\x69\156\137\x61\x64\x6d\157\x72\x72\151\163\137\x70\x72\157\137\145\154\x65\x6d\x65\156\164\163\137\164\162\151\x67\x67\x65\x72\x5f\x66\x69\154\x74\x65\162", $elementFilterData[$key]); KBDjn: } fow0V: header("\103\x6f\156\x74\145\156\x74\x2d\x74\x79\160\x65\x3a\40\x61\x70\x70\154\x69\x63\x61\164\151\157\x6e\57\152\163\x6f\x6e"); if ($newID != '') { goto WdpQE; } return false; goto VzC4Y; WdpQE: return true; VzC4Y: } function admImportElements() { if (!($_FILES == null || count($_FILES) == 0)) { goto sVT6U; } return new IOError("\x4e\x6f\x20\146\151\154\x65\x73\40\x75\x70\154\x6f\x61\144\145\144\x2e", 200); sVT6U: $selectedCategory = null; if (!($_POST["\x64\141\164\141"] && $_POST["\x64\141\164\x61"] != '')) { goto qMLf3; } $data = json_decode($_POST["\144\x61\164\x61"]); if (!($data->selectedCategory != null)) { goto B92v6; } $selectedCategory = $data->selectedCategory; B92v6: qMLf3: foreach ($_FILES as $element) { goto xobp2; xobp2: if (!($element["\145\x72\x72\157\162"] != UPLOAD_ERR_OK)) { goto F93wH; } return false; F93wH: $tmpFilePath = $element["\x74\155\x70\x5f\x6e\x61\x6d\145"]; if (file_exists($tmpFilePath)) { goto ABfbL; } return false; ABfbL: $content = file_get_contents($element["\x74\155\x70\x5f\156\141\x6d\145"]); $element = json_decode($content); if (!($element->triggerFilterOperator == null)) { goto nhfdH; } goto Ua4zn; ywdmW: HJZi2: zadfX: goto RWw8E; Ua4zn: return new IOError("\x53\157\155\145\40\146\x69\x6c\145\x73\40\x61\x72\x65\x20\156\157\164\40\166\141\x6c\151\x64\40\145\x6c\145\155\x65\x6e\164\x73\40\146\151\154\x65\163\x2e", 200); nhfdH: $elementFilterData = $element->elementFilterData; unset($element->elementFilterData); if (!($selectedCategory != null)) { goto AkEty; } $element->categoryID = $selectedCategory; AkEty: $element->id = ''; $newID = Shop::Container()->getDB()->insert("\x78\160\x6c\165\147\151\156\x5f\x61\x64\x6d\x6f\162\x72\x69\163\x5f\160\x72\157\x5f\x65\x6c\145\x6d\x65\x6e\164\x73", $element); foreach ($elementFilterData as $elementFilter) { $elementFilter->id = ''; $elementFilter->elementId = $newID; $result = Shop::Container()->getDB()->insert("\170\x70\x6c\165\x67\151\x6e\137\141\x64\155\x6f\x72\162\x69\163\x5f\x70\162\x6f\x5f\x65\154\145\x6d\145\x6e\164\163\x5f\x74\162\x69\147\x67\145\162\137\146\x69\x6c\x74\x65\162", $elementFilter); OEEd4: } goto ywdmW; RWw8E: } oVole: header("\103\x6f\x6e\x74\x65\156\164\x2d\x74\171\160\x65\x3a\x20\x61\160\x70\154\151\x63\141\164\151\157\x6e\57\152\x73\157\x6e"); if ($newID != '') { goto WprGc; } return false; goto gAfUQ; WprGc: return true; gAfUQ: } function admExportElement($id) { $element = Shop::Container()->getDB()->select("\x78\160\x6c\x75\147\x69\x6e\137\x61\x64\155\x6f\x72\x72\x69\x73\137\160\x72\x6f\x5f\x65\154\x65\155\145\x6e\164\x73", "\151\144", $id); $elementFilterData = Shop::Container()->getDB()->selectAll("\170\160\x6c\x75\x67\x69\156\137\141\144\x6d\157\x72\x72\151\x73\137\x70\x72\x6f\137\x65\154\x65\155\145\156\164\x73\x5f\164\162\x69\x67\x67\x65\162\137\146\x69\154\x74\145\x72", "\x65\x6c\145\155\x65\156\164\111\x64", $id); $element->elementFilterData = $elementFilterData; $json = json_encode($element); if (!($json != null)) { goto wchAp; } return $json; wchAp: return false; } function admExportAllElements() { $elements = Shop::Container()->getDB()->query("\123\105\114\x45\103\x54\40\52\40\x46\122\117\x4d\40\170\160\154\165\x67\x69\x6e\x5f\x61\x64\155\157\162\162\151\163\137\160\162\157\x5f\x65\x6c\x65\155\145\156\x74\x73\40\x4f\x52\104\105\122\x20\x42\x59\x20\x60\x69\144\140", 2); foreach ($elements as $key => $element) { $elementFilterData = Shop::Container()->getDB()->selectAll("\x78\160\154\165\147\x69\x6e\137\x61\144\x6d\x6f\162\162\151\x73\137\160\x72\157\x5f\x65\154\x65\155\x65\x6e\164\x73\x5f\164\162\x69\147\x67\x65\x72\137\x66\151\154\164\x65\162", "\145\x6c\145\x6d\x65\156\x74\111\x64", $element->id); $elements[$key]->elementFilterData = $elementFilterData; dOH5j: } FFtey: $json = json_encode($elements); if (!($json != null)) { goto bNUtu; } return $json; bNUtu: return false; } function admUpdateActiveElement($data) { $active = TypeConverter::convertBoolToInteger($data["\x61\x63\x74\x69\166\145"]); $query = "\xa\x20\x20\x20\40\125\x50\x44\x41\x54\x45\40\x78\x70\x6c\165\147\x69\x6e\137\x61\x64\x6d\157\162\162\151\163\137\x70\x72\157\137\x65\x6c\145\155\145\x6e\x74\x73\40\xa\x20\40\40\40\x53\105\x54\x20\141\x63\164\x69\x76\x65\x20\x3d\x20\72\141\x63\x74\151\x76\x65\xa\40\40\x20\x20\x57\110\105\x52\x45\x20\x69\144\40\75\x20\72\x69\144"; $preparationArr = ["\x69\144" => $data["\x69\x64"], "\x61\143\164\x69\x76\x65" => $active]; $response = Shop::Container()->getDB()->getAffectedRows($query, $preparationArr); if (!($response > 0)) { goto Ph9tZ; } return true; Ph9tZ: return false; } function admCreateElementCategory($data) { $data["\151\144"] = ''; $newID = Shop::Container()->getDB()->insert("\170\x70\154\165\x67\151\x6e\x5f\141\x64\x6d\x6f\x72\162\151\x73\x5f\160\x72\x6f\x5f\145\x6c\x65\155\145\156\164\x73\137\x63\141\164\145\147\157\162\x79", (object) $data); header("\x43\157\156\x74\x65\156\x74\x2d\164\171\x70\145\x3a\x20\x61\160\x70\154\x69\x63\141\164\x69\x6f\156\57\x6a\163\x6f\x6e"); if ($newID != '') { goto GwL44; } return false; goto ASVaI; GwL44: return true; ASVaI: } function admGetElementCategories() { $data = Shop::Container()->getDB()->query("\123\105\x4c\x45\103\124\x20\x2a\x20\x46\122\x4f\x4d\x20\x78\x70\154\165\147\151\x6e\137\141\x64\155\x6f\x72\x72\x69\163\x5f\160\162\157\x5f\145\154\145\x6d\x65\156\164\163\137\143\x61\164\145\147\157\162\171", 2); foreach ($data as $key => $category) { $data[$key]->categoryData = admGetElements($category->id); J1Q7a: } EtksI: $response = json_encode($data); header("\x43\157\156\164\x65\x6e\164\x2d\x74\x79\x70\x65\x3a\40\141\160\160\154\x69\143\141\164\151\157\156\x2f\x6a\x73\x6f\156"); return $response; } function admDeleteElementCategory($data) { $data = $data; Shop::Container()->getDB()->delete("\x78\x70\x6c\165\x67\x69\156\137\x61\144\x6d\x6f\162\162\151\163\137\160\x72\x6f\137\145\x6c\145\x6d\x65\156\164\x73\x5f\143\141\x74\145\147\157\x72\171", "\151\144", (int) $data); Shop::Container()->getDB()->query("\125\120\x44\x41\x54\105\40\x78\160\x6c\x75\x67\151\x6e\137\141\x64\x6d\157\x72\x72\151\163\x5f\160\x72\x6f\137\x65\154\145\155\x65\156\164\x73\40\x53\105\x54\40\x63\141\164\x65\147\157\162\x79\111\104\x20\75\x20\x31\x20\127\x48\x45\122\105\x20\143\x61\x74\x65\x67\157\x72\171\111\104\x20\75\40{$data}", 3); header("\x43\x6f\x6e\164\x65\x6e\164\x2d\x74\x79\x70\145\x3a\40\141\160\160\x6c\x69\x63\x61\164\x69\x6f\156\x2f\x6a\x73\157\156"); return true; } function admUpdateElementCategoryName($data) { $data = $data; $obj = new \stdClass(); $obj->id = $data["\151\x64"]; $obj->name = $data["\156\x61\155\x65"]; $db = Shop::Container()->getDB(); header("\103\157\x6e\164\145\156\164\55\164\171\160\145\72\x20\x61\x70\160\x6c\151\143\x61\x74\151\157\x6e\57\x6a\163\157\x6e"); $result = $db->update("\x78\x70\x6c\165\147\x69\156\137\141\144\155\x6f\162\162\x69\163\x5f\x70\x72\157\137\145\154\145\x6d\x65\x6e\164\163\x5f\143\x61\164\145\147\x6f\x72\171", "\x69\144", $data["\151\x64"], $obj); if ($result) { goto EJoLm; } return false; goto cWk1Z; EJoLm: return true; cWk1Z: } function admToggleElementCategoryActive($data) { $data = $data; $obj = new \stdClass(); $obj->id = $data["\x69\144"]; $obj->active = $data["\141\143\x74\151\x76\145"]; $db = Shop::Container()->getDB(); header("\x43\157\x6e\164\x65\156\x74\x2d\164\171\160\x65\x3a\x20\141\160\x70\154\x69\x63\x61\164\x69\x6f\156\x2f\152\x73\157\156"); $result = $db->update("\170\160\154\165\x67\151\x6e\137\x61\144\155\157\162\x72\151\163\137\x70\162\x6f\x5f\145\154\x65\x6d\145\156\164\163\x5f\x63\x61\164\x65\147\157\162\171", "\151\144", $data["\x69\144"], $obj); if ($result) { goto S01q4; } return false; goto lPl_v; S01q4: return true; lPl_v: } function admGetElementFilter($data) { $data = $data; $data = Shop::Container()->getDB()->query("\123\105\114\105\103\x54\40\x2a\x20\x46\x52\117\x4d\x20\x78\x70\154\x75\x67\x69\x6e\x5f\x61\144\x6d\157\162\x72\151\x73\137\x70\x72\x6f\x5f\145\154\145\155\145\156\164\163\137\x74\162\151\147\x67\x65\162\137\146\x69\x6c\164\x65\162\40\127\x48\105\122\105\x20\x65\154\x65\155\x65\156\x74\111\144\40\x3d\x20{$data}", 2); $response = json_encode($data); header("\103\x6f\156\x74\145\156\x74\x2d\164\x79\x70\145\72\40\141\160\160\x6c\151\x63\x61\164\x69\157\x6e\57\x6a\163\x6f\x6e"); return $response; } function admSaveElementFilter($data) { $data = $data; Shop::Container()->getDB()->query("\12\40\x20\40\40\x52\x45\x50\x4c\x41\x43\105\x20\111\116\x54\117\x20\170\x70\x6c\x75\x67\151\x6e\x5f\x61\x64\155\x6f\162\x72\151\163\x5f\x70\x72\x6f\137\x65\x6c\x65\x6d\x65\x6e\x74\163\137\164\162\151\x67\147\x65\x72\x5f\x66\x69\154\164\x65\162\40\12\x20\x20\x20\x20\x20\40\40\x20\x56\x41\114\125\x45\x53\40\x28\12\x22\42\x2c\40\xa\x22" . $data["\x69\144"] . "\x22\x2c\x20\xa\x22" . $data["\x74\x72\x69\147\x67\145\162\x46\151\154\x74\x65\162\x54\171\160\x65"] . "\x22\x2c\x20\xa\42" . $data["\164\162\x69\x67\147\145\162\106\x69\154\164\145\162\x56\141\154\165\x65"] . "\x22\xa\40\x20\x20\x20\40\x20\x20\x20\51\xa\x20\40\40\40\x20\40\x20\x20", 3); header("\x43\157\156\164\x65\x6e\164\55\x74\x79\160\145\72\x20\141\x70\160\x6c\151\x63\141\164\151\157\156\57\152\x73\157\156"); return true; } function admDeleteElementFilter($data) { $data = $data; Shop::Container()->getDB()->delete("\170\x70\x6c\165\x67\x69\156\137\x61\144\x6d\x6f\x72\162\x69\x73\x5f\160\x72\x6f\137\x65\x6c\145\155\145\x6e\x74\163\x5f\164\x72\x69\x67\147\145\162\137\146\151\154\164\145\x72", "\151\x64", (int) $data); header("\103\x6f\156\164\x65\156\164\55\164\171\x70\145\x3a\x20\141\160\x70\154\x69\x63\x61\x74\x69\157\156\57\x6a\x73\x6f\156"); return true; }