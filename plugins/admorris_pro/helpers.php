<?php
/*   __________________________________________________
    |  Copyright by admorris.pro  |
    |__________________________________________________|
*/
 namespace Plugin\admorris_pro; use JTL\Plugin\PluginInterface; use JTL\Services\Container; use JTL\Session\Frontend; use JTL\Shop; use JTL\Helpers\Text; use stdClass; function container() : Container { return Shop::Container(); } function getSetting(string $settingName, PluginInterface $plugin) : string { return $plugin->getConfig()->getValue("\141\x64\x6d\x6f\x72\x72\151\163\x5f\160\x72\x6f\137" . $settingName); } function getSettingsGroup(string $groupName, PluginInterface $plugin) { return fn($settingName) => getSetting($groupName . "\x5f" . $settingName, $plugin); } function getTranslation($name, PluginInterface $plugin) : string { return $plugin->getLocalization()->getTranslation("\141\144\155\x6f\x72\162\151\x73\137\160\162\x6f\137" . $name); } function getTranslationGroup($groupName, PluginInterface $plugin) { return fn($name) => getTranslation($groupName . "\137" . $name, $plugin); } function isTemplateActive() { static $active = null; if (!is_null($active)) { goto RVae2; } $template = Shop::Container()->getTemplateService()->getActiveTemplate(); if ($template->getName() == "\x61\x64\x6d\x6f\162\x72\x69\163\40\x50\x72\157" || $template->getName() == "\x61\144\155\x6f\162\x72\x69\x73\40\120\162\157\x20\x43\x68\x69\x6c\144" || !empty($template->getParent()) && $template->getParent() == "\x61\144\x6d\157\x72\x72\151\x73\137\x70\x72\157") { goto X2_wf; } $active = false; goto lrodS; X2_wf: $active = true; lrodS: RVae2: return $active; } function localizeNumberFormat($number, int $decimals = 2) { $currency = Frontend::getCurrency(); return \number_format($number, $decimals, $currency->getDecimalSeparator(), $currency->getThousandsSeparator()); } function groupBy($key, $data) { $result = array(); foreach ($data as $val) { $value = (array) $val; if (array_key_exists($key, $value)) { goto o6XEZ; } $result[''][] = $value; goto MM62C; o6XEZ: $result[$value[$key]][] = $value; MM62C: zhqiZ: } NoLA2: return $result; } function getManufacturers($selHerst = '') { $selected = Text::parseSSK($selHerst); $hersteller_arr = array_values((new \JTL\Helpers\Manufacturer())->getManufacturers()); foreach ($hersteller_arr as $i => $hersteller) { $hersteller_arr[$i] = new stdClass(); $hersteller_arr[$i]->kHersteller = $hersteller->getId(); $hersteller_arr[$i]->cName = $hersteller->getName(); $hersteller_arr[$i]->selected = in_array($hersteller_arr[$i]->kHersteller, $selected) ? 1 : 0; YCq9j: } xVo2y: return $hersteller_arr; } function getCategories($selKats = '', $kKategorie = 0, $tiefe = 0) { goto u5dd2; u5dd2: $selected = Text::parseSSK($selKats); $arr = []; $kats = Shop::Container()->getDB()->selectAll("\x74\153\141\x74\145\x67\x6f\162\151\145", "\153\117\x62\145\x72\113\141\x74\145\147\157\x72\151\145", (int) $kKategorie, "\x6b\113\141\x74\x65\147\157\x72\x69\x65\x2c\x20\x63\116\x61\155\145"); $kCount = count($kats); $o = 0; je0is: if (!($o < $kCount)) { goto pXwO2; } $i = 0; h1S0t: if (!($i < $tiefe)) { goto YG1R5; } goto jZlxD; jEyJA: $arr = array_merge($arr, getCategories($selKats, $kats[$o]->kKategorie, $tiefe + 1)); xWTLq: $o++; goto je0is; pXwO2: return $arr; goto ZxnUB; jZlxD: $kats[$o]->cName = "\x2d\55" . $kats[$o]->cName; nDb2a: $i++; goto h1S0t; YG1R5: $kats[$o]->selected = 0; if (!in_array($kats[$o]->kKategorie, $selected)) { goto aU_rj; } $kats[$o]->selected = 1; aU_rj: $arr[] = $kats[$o]; goto jEyJA; ZxnUB: } function cssSelector($settingName, $content, $logError = true) { goto YjDVZ; YjDVZ: $plugin = Shop::get("\x6f\160\x6c\x75\x67\x69\x6e\x5f\x61\x64\x6d\x6f\162\x72\x69\163\137\160\162\157"); $selector = "\x61\144\x6d\157\162\x72\151\163\137\160\x72\x6f\137\x65\170\160\145\162\164\137\163\145\164\x74\151\156\147\x73\137" . $settingName . "\137\143\163\163\x5f\163\x65\x6c\x65\143\x74\157\162"; $selector = $plugin->getConfig()->getValue($selector); $selectorType = "\141\144\x6d\x6f\x72\162\151\163\137\x70\x72\x6f\137\145\x78\x70\x65\x72\164\x5f\x73\145\x74\164\151\x6e\x67\x73\x5f" . $settingName . "\137\143\163\x73\137\x73\145\154\x65\143\x74\157\162\137\164\171\160\145"; $selectorType = $plugin->getConfig()->getValue($selectorType); $el = pq($selector); if (!($el->length === 0 && $logError)) { goto trUdO; } Shop::Container()->getLogService()->debug("\x41\144\155\x6f\x72\162\151\x73\x20\120\162\157\72\x20\103\x53\123\x20\x53\x65\x6c\x65\143\164\157\162\x20" . $selector . "\40\x6e\x6f\x74\x20\x66\157\165\156\144\40\146\x6f\162\x20\123\145\164\x74\x69\156\147\40" . $settingName); return; trUdO: goto HBfeC; fzTug: lh22f: goto saBLV; GrVOA: $el->before($content); saBLV: goto vwRtZ; OPc6r: $el->prepend($content); vwRtZ: goto nX4yI; goto ypZ9Y; HBfeC: if ($selectorType == "\141\160\x70\x65\156\144") { goto yEj_K; } if ($selectorType == "\x70\x72\145\x70\145\156\144") { goto OPc6r; } if ($selectorType == "\142\145\146\157\x72\x65") { goto GrVOA; } if ($selectorType == "\x61\146\164\x65\162") { goto Hb0x6; } if (!($selectorType == "\x72\x65\x70\x6c\141\x63\145\x57\151\164\150")) { goto vf43M; } $el->replaceWith($content); vf43M: goto lh22f; Hb0x6: $el->after($content); goto fzTug; ypZ9Y: yEj_K: $el->append($content); nX4yI: goto oPpR4; oPpR4: } function minifyCss($string = '') { $comments = "\40\x20\50\x3f\163\170\51\xa\x20\x20\x20\40\43\x20\144\x6f\156\x27\164\x20\x63\x68\141\156\147\x65\40\x61\x6e\171\164\x68\151\x6e\x67\40\x69\x6e\163\151\144\x65\x20\x6f\x66\40\161\x75\x6f\x74\145\x73\12\40\40\x20\40\50\40\42\x28\x3f\72\133\136\x22\x5c\x5c\135\53\53\174\x5c\x5c\56\x29\52\x2b\42\40\x7c\40\x27\x28\x3f\x3a\133\136\47\134\x5c\x5d\x2b\x2b\x7c\134\x5c\56\51\52\53\47\40\x29\12\40\40\x7c\12\x20\40\x20\40\43\x20\143\x6f\x6d\x6d\x65\156\x74\163\12\x20\40\40\x20\57\134\x2a\x20\x28\x3f\76\40\x2e\x2a\77\40\x5c\52\57\x20\x29"; $everything_else = "\40\x20\x28\x3f\163\151\x78\51\xa\x20\40\40\x20\43\40\x64\157\x6e\x27\164\x20\x63\x68\141\156\x67\x65\40\141\x6e\x79\164\x68\x69\x6e\147\40\x69\156\163\151\144\x65\x20\157\146\40\x71\x75\x6f\164\145\163\12\40\40\40\40\x28\40\x22\x28\77\x3a\x5b\x5e\42\134\x5c\135\53\x2b\174\134\134\56\x29\x2a\53\x22\40\x7c\x20\47\50\x3f\72\x5b\136\47\x5c\134\135\x2b\x2b\174\x5c\134\x2e\x29\x2a\53\47\x20\x29\xa\x20\40\174\xa\40\40\x20\40\x23\40\163\160\x61\143\145\x73\x20\x62\145\x66\157\x72\145\40\141\x6e\144\40\141\x66\164\x65\x72\x20\73\x20\x61\x6e\144\40\175\12\40\x20\40\x20\x5c\163\x2a\53\40\x3b\40\x5c\163\x2a\x2b\x20\50\40\x7d\x20\x29\40\x5c\x73\52\x2b\xa\x20\40\174\12\40\40\x20\x20\43\40\141\x6c\154\x20\x73\x70\x61\143\145\x73\40\x61\162\157\x75\156\144\x20\x6d\145\164\141\40\x63\x68\141\x72\x73\57\157\x70\x65\162\x61\164\157\x72\x73\x20\50\x65\170\x63\x6c\x75\x64\151\156\147\x20\53\x20\x61\x6e\144\x20\x2d\x29\12\x20\40\40\x20\134\163\x2a\x2b\x20\50\x20\x5b\52\x24\176\x5e\x7c\x5d\x3f\53\75\x20\x7c\x20\133\x7b\x7d\x3b\54\x3e\176\135\x20\x7c\x20\41\151\x6d\x70\157\162\x74\x61\156\x74\134\x62\x20\x29\x20\x5c\163\x2a\x2b\12\x20\40\174\12\40\40\40\x20\43\x20\x61\154\154\x20\163\160\x61\143\145\163\40\x61\162\x6f\x75\156\144\40\x2b\x20\141\x6e\144\x20\55\x20\50\x69\156\x20\x73\145\154\145\143\164\x6f\162\x73\40\157\156\154\x79\41\51\xa\40\x20\40\x20\x5c\x73\x2a\50\133\53\x2d\x5d\51\x5c\163\52\50\77\x3d\x5b\x5e\175\x5d\52\173\51\xa\x20\x20\174\12\x20\40\x20\40\43\40\163\160\141\x63\145\x73\x20\162\151\x67\x68\164\40\157\146\x20\x28\40\x5b\40\72\12\x20\40\40\x20\50\x20\x5b\133\50\72\135\40\x29\40\134\x73\53\x2b\12\x20\40\174\12\x20\40\40\x20\x23\40\x73\x70\x61\143\x65\163\40\154\x65\x66\x74\40\x6f\146\40\x29\40\135\xa\x20\40\40\40\134\x73\x2b\53\40\50\40\x5b\x5d\51\135\x20\51\12\x20\40\174\xa\x20\x20\x20\40\43\x20\x73\x70\141\x63\145\x73\x20\x6c\x65\x66\164\x20\50\x61\156\144\40\x72\x69\x67\x68\x74\x29\40\x6f\146\40\x3a\40\50\142\165\164\x20\x6e\x6f\x74\x20\151\156\40\x73\x65\154\145\143\x74\x6f\x72\x73\51\41\12\40\x20\x20\x20\x5c\x73\53\50\72\51\50\77\x21\x5b\x5e\134\175\x5d\52\134\x7b\51\12\x20\40\174\12\40\x20\x20\x20\x23\x20\163\x70\141\x63\145\x73\x20\x61\164\x20\x62\x65\x67\x69\156\x6e\x69\x6e\147\x2f\145\x6e\x64\x20\x6f\x66\40\x73\x74\x72\x69\156\x67\xa\x20\x20\x20\40\136\40\x5c\163\53\x2b\x20\x7c\x20\x5c\x73\53\x2b\40\x5c\x7a\12\x20\40\x7c\xa\40\x20\40\40\x23\40\144\x6f\165\142\x6c\x65\40\x73\x70\x61\143\145\x73\40\164\157\x20\163\151\156\x67\154\x65\xa\x20\x20\40\40\50\x5c\163\x29\x5c\163\x2b"; $search_patterns = array("\45{$comments}\x25", "\x25{$everything_else}\x25"); $replace_patterns = array("\x24\61", "\x24\61\44\x32\x24\63\44\64\44\65\x24\x36\x24\x37\44\70"); return preg_replace($search_patterns, $replace_patterns, $string); }