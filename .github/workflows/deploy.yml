name: Deploy to Netcup

on:
  workflow_dispatch:
  schedule:
    - cron: '0 2 * * *' # TÃ¤glich um 02:00 Uhr nachts

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Enable Maintenance Mode
        run: |
          curl -s "https://mctrade24.com/maintenance_toggle.php?mode=on&token=mctrade_deploy_token_2026" || true

      - name: Sync files via SSH/Rsync
        run: |
          sudo apt-get update && sudo apt-get install -y sshpass
          
          sshpass -p "${{ secrets.FTP_PASSWORD }}" rsync -avz --chmod=Du=rwx,Dg=rwx,Do=rx,Fu=rw,Fg=rw,Fo=r -e "ssh -o StrictHostKeyChecking=no -p 22" \
            --exclude='.git*' \
            --exclude='node_modules' \
            --exclude='templates_c' \
            --exclude='media/image/storage' \
            --exclude='bilder' \
            --exclude='mediafiles' \
            --exclude='includes/config.JTL-Shop.ini.php' \
            --exclude='install' \
            ./ ${{ secrets.FTP_USERNAME }}@${{ secrets.FTP_SERVER }}:httpdocs/

      - name: Disable Maintenance Mode
        run: |
          curl -s "https://mctrade24.com/maintenance_toggle.php?mode=off&token=mctrade_deploy_token_2026" || true
